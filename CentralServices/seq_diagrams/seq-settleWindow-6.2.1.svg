<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="947.4px" preserveAspectRatio="none" style="width:1055px;height:947px;" version="1.1" viewBox="0 0 1055 947" width="1055.4px" zoomAndPan="magnify"><defs><filter height="300%" id="f1j0y0t7y2c8qn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.2000000476837158"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.4000000953674316" dy="2.4000000953674316" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="8.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249.6" x="403.5" y="14.1211">6.1.2. closeSettlementWindow POST: /settlementWindows</text><rect fill="#FFB6C1" height="920.6754" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="67.2" x="17.4" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48.6" x="26.7" y="28.234">Central HUB</text><rect fill="#90EE90" height="920.6754" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="503.7" x="265.5" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="480.15" y="28.234">Settlement Service</text><rect fill="#FFFFE0" height="920.6754" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="68.4" x="900" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="901.8" y="28.234">Central Services</text><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="17.5863" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="312" y="185.0766"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="17.5863" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="312" y="611.1621"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="75.7453" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="312" y="734.0121"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="408.4992" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="465.6" y="202.6629"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="499.1766" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="729.6" y="234.8356"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="931.2" y="276.0082"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="931.2" y="385.1262"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="931.2" y="501.0715"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="786.7032" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1041" x="7.8" y="92.5723"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="663.2262" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1029" x="13.8" y="211.8492"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="332.7539" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="350.4" x="686.4" y="244.0219"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="231" x="692.4" y="332.5535"/><rect fill="#FFFFFF" height="162.6363" style="stroke: none; stroke-width: 0.6000000238418579;" width="1029" x="13.8" y="712.4391"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="51" x2="51" y1="82.3723" y2="889.4754"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="314.7" x2="314.7" y1="82.3723" y2="889.4754"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="468.3" x2="468.3" y1="82.3723" y2="889.4754"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="732.6" x2="732.6" y1="82.3723" y2="889.4754"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="934.2" x2="934.2" y1="82.3723" y2="889.4754"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="19.8" y="80.6004">Hub Employee</text><ellipse cx="51" cy="38.2793" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M51,43.0793 L51,59.2793 M43.2,47.8793 L58.8,47.8793 M51,59.2793 L43.2,68.2793 M51,59.2793 L58.8,68.2793 " fill="none" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="19.8" y="896.9965">Hub Employee</text><ellipse cx="51" cy="904.7684" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M51,909.5684 L51,925.7684 M43.2,914.3684 L58.8,914.3684 M51,925.7684 L43.2,934.7684 M51,925.7684 L58.8,934.7684 " fill="none" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="267.9" y="80.6004">Settlement Service API</text><path d="M302.7,55.6793 L302.7,70.0793 M302.7,62.8793 L312.9,62.8793 " fill="none" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="320.1" cy="62.8793" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="267.9" y="896.9965">Settlement Service API</text><path d="M302.7,901.1684 L302.7,915.5684 M302.7,908.3684 L312.9,908.3684 " fill="none" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="320.1" cy="908.3684" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="427.5" y="80.6004">Settlement Window</text><ellipse cx="468.6" cy="62.8793" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="466.2,55.6793,469.8,52.6793,468.6,55.6793,469.8,58.6793,466.2,55.6793" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="427.5" y="896.9965">Settlement Window</text><ellipse cx="468.6" cy="908.3684" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="466.2,901.1684,469.8,898.1684,468.6,901.1684,469.8,904.1684,466.2,901.1684" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="698.4" y="80.6004">Settlement DAO</text><ellipse cx="732.6" cy="62.8793" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="725.4" x2="739.8" y1="71.2793" y2="71.2793"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="698.4" y="896.9965">Settlement DAO</text><ellipse cx="732.6" cy="908.3684" fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="725.4" x2="739.8" y1="916.7684" y2="916.7684"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="905.4" y="80.6004">Central Store</text><path d="M923.4,50.8793 C923.4,44.8793 934.2,44.8793 934.2,44.8793 C934.2,44.8793 945,44.8793 945,50.8793 L945,66.4793 C945,72.4793 934.2,72.4793 934.2,72.4793 C934.2,72.4793 923.4,72.4793 923.4,66.4793 L923.4,50.8793 " fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M923.4,50.8793 C923.4,56.8793 934.2,56.8793 934.2,56.8793 C934.2,56.8793 945,56.8793 945,50.8793 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="905.4" y="896.9965">Central Store</text><path d="M923.4,904.7684 C923.4,898.7684 934.2,898.7684 934.2,898.7684 C934.2,898.7684 945,898.7684 945,904.7684 L945,920.3684 C945,926.3684 934.2,926.3684 934.2,926.3684 C934.2,926.3684 923.4,926.3684 923.4,920.3684 L923.4,904.7684 " fill="#FEFECE" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M923.4,904.7684 C923.4,910.7684 934.2,910.7684 934.2,910.7684 C934.2,910.7684 945,910.7684 945,904.7684 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="17.5863" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="312" y="185.0766"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="17.5863" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="312" y="611.1621"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="75.7453" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="312" y="734.0121"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="408.4992" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="465.6" y="202.6629"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="499.1766" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="729.6" y="234.8356"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="931.2" y="276.0082"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="931.2" y="385.1262"/><rect fill="#FFFFFF" filter="url(#f1j0y0t7y2c8qn)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="931.2" y="501.0715"/><path d="M7.8,92.5723 L189.6,92.5723 L189.6,96.7723 L183.6,102.7723 L7.8,102.7723 L7.8,92.5723 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="786.7032" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1041" x="7.8" y="92.5723"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154.8" x="16.8" y="100.7133">Request closure of Settlement Window</text><path d="M54,105.9586 L54,166.5586 L199.8,166.5586 L199.8,111.9586 L193.8,105.9586 L54,105.9586 " fill="#FFFF00" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M193.8,105.9586 L193.8,111.9586 L199.8,111.9586 L193.8,105.9586 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="124.2" x="57.6" y="116.4996">POST:: '/settlementWindows/{id}'</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="60" y="125.6859"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="57.6" y="134.8723">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="62.4" x="62.4" y="144.0586">"state": "closed",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="128.4" x="62.4" y="153.2449">"reason": "motivation for closure."</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="57.6" y="162.4313">}</text><polygon fill="#A80036" points="304.8,182.6766,310.8,185.0766,304.8,187.4766,307.2,185.0766" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="51" x2="308.4" y1="185.0766" y2="185.0766"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="55.2" y="182.4176">1</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="241.8" x="63" y="182.4176">API call Settlement Service to close specified settlement window</text><polygon fill="#A80036" points="458.4,200.2629,464.4,202.6629,458.4,205.0629,460.8,202.6629" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="315" x2="462" y1="202.6629" y2="202.6629"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="319.2" y="200.0039">2</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="94.8" x="327" y="200.0039">Close settlement window</text><path d="M13.8,211.8492 L51,211.8492 L51,216.0492 L45,222.0492 L13.8,222.0492 L13.8,211.8492 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="663.2262" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1029" x="13.8" y="211.8492"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.2" x="22.8" y="219.9902">alt</text><polygon fill="#A80036" points="722.4,232.4356,728.4,234.8356,722.4,237.2356,724.8,234.8356" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="471.6" x2="726" y1="234.8356" y2="234.8356"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="475.8" y="232.1766">3</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="238.8" x="483.6" y="232.1766">Close settlementWindow&lt;id&gt; and open new settlementWindow</text><path d="M686.4,244.0219 L785.4,244.0219 L785.4,248.2219 L779.4,254.2219 L686.4,254.2219 L686.4,244.0219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="332.7539" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="350.4" x="686.4" y="244.0219"/><text fill="#0000FF" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="695.4" y="252.1629">DB TRANSACTION</text><polygon fill="#A80036" points="924,273.6082,930,276.0082,924,278.4082,926.4,276.0082" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="735.6" x2="927.6" y1="276.0082" y2="276.0082"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="739.8" y="268.9424">4</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="171" x="747.6" y="264.3492">Get state for settlementWindow&lt;id&gt; from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="747.6" y="273.5356">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="793.8" y="273.5356">2001</text><polygon fill="#FFFFE0" filter="url(#f1j0y0t7y2c8qn)" points="874.8,302.1809,993.6,302.1809,999.6,313.5809,993.6,324.9809,874.8,324.9809,868.8,313.5809,874.8,302.1809" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="876" y="312.1219">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="116.4" x="876" y="321.3082">settlementWindowStateChange</text><path d="M692.4,332.5535 L808.2,332.5535 L808.2,336.7535 L802.2,342.7535 L692.4,342.7535 L692.4,332.5535 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="231" x="692.4" y="332.5535"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88.8" x="701.4" y="340.6945">Validate window state</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="735.6" x2="760.8" y1="355.7262" y2="355.7262"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="760.8" x2="760.8" y1="355.7262" y2="363.5262"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="736.2" x2="760.8" y1="363.5262" y2="363.5262"/><polygon fill="#A80036" points="742.2,361.1262,736.2,363.5262,742.2,365.9262,739.8,363.5262" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="739.8" y="352.8809">5</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="168.6" x="747.6" y="352.8809">Validate settlementWindowStateId == 'OPEN'</text><polygon fill="#A80036" points="924,382.7262,930,385.1262,924,387.5262,926.4,385.1262" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="735.6" x2="927.6" y1="385.1262" y2="385.1262"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="739.8" y="382.4672">6</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="169.8" x="747.6" y="382.4672">Insert settlementWindowStateId == 'CLOSED'</text><path d="M837.6,411.1125 L837.6,426.1125 L1028.4,426.1125 L1028.4,417.1125 L1022.4,411.1125 L837.6,411.1125 " fill="#FFB6C1" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M1022.4,411.1125 L1022.4,417.1125 L1028.4,417.1125 L1022.4,411.1125 " fill="#FFB6C1" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="18" x="841.2" y="421.6535">Lock</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="861.6" y="421.6535">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="29.4" x="990" y="421.6535">for read</text><polygon fill="#FFFFE0" filter="url(#f1j0y0t7y2c8qn)" points="874.8,434.6988,993.6,434.6988,999.6,446.0988,993.6,457.4988,874.8,457.4988,868.8,446.0988,874.8,434.6988" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="876" y="444.6399">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="116.4" x="876" y="453.8262">settlementWindowStateChange</text><polygon fill="#A80036" points="924,498.6715,930,501.0715,924,503.4715,926.4,501.0715" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="735.6" x2="927.6" y1="501.0715" y2="501.0715"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="739.8" y="484.592">7</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="113.4" x="747.6" y="470.8125">Create new settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="750" y="479.9988">state == 'open'</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="148.8" x="750" y="489.1852">reason == 'motivation for new Window'</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="747.6" y="498.3715">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="793.8" y="498.3715">2001</text><polygon fill="#FFFFE0" filter="url(#f1j0y0t7y2c8qn)" points="874.8,527.0168,993.6,527.0168,999.6,538.4168,993.6,549.8168,874.8,549.8168,868.8,538.4168,874.8,527.0168" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="876" y="536.9578">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="116.4" x="876" y="546.1442">settlementWindowStateChange</text><path d="M849,556.1895 L849,571.1895 L1016.4,571.1895 L1016.4,562.1895 L1010.4,556.1895 L849,556.1895 " fill="#FFB6C1" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M1010.4,556.1895 L1010.4,562.1895 L1016.4,562.1895 L1010.4,556.1895 " fill="#FFB6C1" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="26.4" x="852.6" y="566.7305">Unlock</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="881.4" y="566.7305">settlementWindowStateChange</text><polygon fill="#A80036" points="478.2,591.1758,472.2,593.5758,478.2,595.9758,475.8,593.5758" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="474.6" x2="729" y1="593.5758" y2="593.5758"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="481.8" y="590.9168">8</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="176.4" x="489.6" y="590.9168">Successful update for settlementWindow to DB</text><polygon fill="#A80036" points="324.6,608.7621,318.6,611.1621,324.6,613.5621,322.2,611.1621" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="321" x2="468" y1="611.1621" y2="611.1621"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="328.2" y="608.5031">9</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="128.4" x="336" y="608.5031">Operation successfully completed</text><polygon fill="#A80036" points="57.6,626.3485,51.6,628.7485,57.6,631.1485,55.2,628.7485" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="54" x2="314.4" y1="628.7485" y2="628.7485"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="61.2" y="626.0895">10</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="74.4" y="626.0895">Return results</text><path d="M204,636.7348 L204,706.9348 L309.6,706.9348 L309.6,642.7348 L303.6,636.7348 L204,636.7348 " fill="#FFFF00" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M303.6,636.7348 L303.6,642.7348 L309.6,642.7348 L303.6,636.7348 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="207.6" y="647.2758">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="212.4" y="656.4621">"id": 0,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="66.6" x="212.4" y="665.6485">"reason": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="60" x="212.4" y="674.8348">"state": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="212.4" y="684.0211">"createdDate": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="88.2" x="212.4" y="693.2074">"changedDate": "string"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="207.6" y="702.3938">}</text><line style="stroke: #000000; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="13.8" x2="1042.8" y1="713.0391" y2="713.0391"/><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="16.8" y="719.42">[</text><text fill="#FF0000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="19.2" y="719.42">Settlement Window not found or Settlement Window not 'open'</text><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="229.2" y="719.42">]</text><polygon fill="#A80036" points="324.6,731.6121,318.6,734.0121,324.6,736.4121,322.2,734.0121" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="321" x2="732" y1="734.0121" y2="734.0121"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="328.2" y="731.3532">11</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="170.4" x="341.4" y="731.3532">settlement window not found - return ERROR</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="318" x2="343.2" y1="751.7848" y2="751.7848"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="343.2" x2="343.2" y1="751.7848" y2="759.5848"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="318.6" x2="343.2" y1="759.5848" y2="759.5848"/><polygon fill="#A80036" points="324.6,757.1848,318.6,759.5848,324.6,761.9848,322.2,759.5848" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="322.2" y="748.9395">12</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="63.6" x="335.4" y="748.9395">Update Event log</text><path d="M321,767.3848 L321,791.3848 L445.2,791.3848 L445.2,773.3848 L439.2,767.3848 L321,767.3848 " fill="#ADD8E6" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M439.2,767.3848 L439.2,773.3848 L445.2,773.3848 L439.2,767.3848 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="82.2" x="324.6" y="777.9258">Log ERROR Messages.</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="324.6" y="787.1121">Update Event log with ERROR.</text><polygon fill="#A80036" points="57.6,807.3575,51.6,809.7575,57.6,812.1575,55.2,809.7575" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="54" x2="314.4" y1="809.7575" y2="809.7575"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="61.2" y="807.0985">13</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="51.6" x="74.4" y="807.0985">Return ERROR</text><path d="M133.2,817.7438 L133.2,869.3438 L309.6,869.3438 L309.6,823.7438 L303.6,817.7438 L133.2,817.7438 " fill="#FFFF00" filter="url(#f1j0y0t7y2c8qn)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M303.6,817.7438 L303.6,823.7438 L309.6,823.7438 L303.6,817.7438 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="136.8" y="828.2848">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="41.4" x="141.6" y="837.4711">"status": 0,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="159" x="141.6" y="846.6575">"code": "MISSING_REQUIRED_PARAMETER",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="72" x="141.6" y="855.8438">"message": "string"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="136.8" y="865.0301">}</text><!--
@startuml
title 6.1.2. closeSettlementWindow POST: /settlementWindows

autonumber



actor "Hub Employee" as OPERATOR

boundary "Settlement Service API" as SSAPI
control "Settlement Window" as SETTLEWINDOW
entity "Settlement DAO" as SETTLE_DAO

database "Central Store" as DB

box "Central HUB" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLEWINDOW
    participant SETTLE_DAO
end box

box "Central Services" #LightYellow
    participant DB
end box


group Request closure of Settlement Window
    note right of OPERATOR #Yellow
        POST:: '/settlementWindows/{id}'

        {
          "state": "closed",
          "reason": "motivation for closure."
        }
    end note
    OPERATOR -> SSAPI: API call Settlement Service to close specified settlement window
    activate SSAPI
    SSAPI -> SETTLEWINDOW: Close settlement window
    deactivate SSAPI
    activate SETTLEWINDOW
    alt
        SETTLEWINDOW -> SETTLE_DAO: Close settlementWindow<id> and open new settlementWindow
        activate SETTLE_DAO
        group <color #blue>DB TRANSACTION</color>
            SETTLE_DAO -> DB: Get state for settlementWindow<id> from DB \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
            hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
            end hnote
            deactivate DB
            group Validate window state
                SETTLE_DAO <- -> SETTLE_DAO: Validate settlementWindowStateId == 'OPEN'
            end
                SETTLE_DAO -> DB: Insert settlementWindowStateId == 'CLOSED'
                note over DB #Lightpink
                Lock **settlementWindowStateChange** for read
                end note
            activate DB
                hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
                end hnote
            deactivate DB

            SETTLE_DAO -> DB: Create new settlementWindow \n state == 'open'\n reason == 'motivation for new Window' \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
                hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
                end hnote
            deactivate DB
                note over DB #Lightpink
                Unlock **settlementWindowStateChange**
                end note
        end
        SETTLEWINDOW <- SETTLE_DAO: Successful update for settlementWindow to DB
    SSAPI <- SETTLEWINDOW: Operation successfully completed
    deactivate SETTLEWINDOW
    activate SSAPI
    OPERATOR <- SSAPI: Return results
        note left of SSAPI #Yellow
        {
          "id": 0,
          "reason": "string",
          "state": "string",
          "createdDate": "string",
          "changedDate": "string"
        }
        end note
    deactivate SSAPI
    else <color #FF0000><b>Settlement Window not found or Settlement Window not 'open'</b></color>

    SETTLE_DAO -> SSAPI: settlement window not found - return ERROR
    deactivate SETTLE_DAO
    activate SSAPI
    SSAPI -> SSAPI: Update Event log
    note right of SSAPI #LightBlue
        Log ERROR Messages.
        Update Event log with ERROR.
    end note
    OPERATOR <- SSAPI: Return ERROR
    note left of SSAPI #Yellow
        {
          "status": 0,
          "code": "MISSING_REQUIRED_PARAMETER",
          "message": "string"
        }
    end note
    deactivate SSAPI
    end
end
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>