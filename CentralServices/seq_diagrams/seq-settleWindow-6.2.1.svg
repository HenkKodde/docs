<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1200.8px" preserveAspectRatio="none" style="width:1451px;height:1200px;" version="1.1" viewBox="0 0 1451 1200" width="1451.2px" zoomAndPan="magnify"><defs><filter height="300%" id="f15a3mno5hh3r0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332.8" x="560" y="18.8281">6.1.2. closeSettlementWindow POST: /settlementWindows</text><rect fill="#FFB6C1" height="1164.6703" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="89.6" x="23.2" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="35.6" y="37.6453">Central HUB</text><rect fill="#90EE90" height="1164.6703" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="671.6" x="354" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99.2" x="640.2" y="37.6453">Settlement Service</text><rect fill="#FFFFE0" height="1164.6703" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="198.4" x="1174.4" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="1230.4" y="37.6453">Central Services</text><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="23.4484" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="416" y="246.7688"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="23.4484" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="416" y="751.9859"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="100.9938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="416" y="915.786"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="481.7688" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="620.8" y="270.2172"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="602.6719" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="972.8" y="313.1141"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1327.2" y="368.0109"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1327.2" y="513.5016"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1327.2" y="636.6469"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="986.0406" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1432" x="10.4" y="123.4297"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="821.4047" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1416" x="18.4" y="282.4656"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="380.775" style="stroke: #000000; stroke-width: 1.600000023841858;" width="511.2" x="915.2" y="325.3625"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="308" x="923.2" y="443.4047"/><rect fill="#FFFFFF" height="216.8484" style="stroke: none; stroke-width: 0.800000011920929;" width="1416" x="18.4" y="887.0219"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="68" x2="68" y1="109.8297" y2="1123.0703"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="419.6" x2="419.6" y1="109.8297" y2="1123.0703"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="624.4" x2="624.4" y1="109.8297" y2="1123.0703"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="976.8" x2="976.8" y1="109.8297" y2="1123.0703"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1231.2" x2="1231.2" y1="109.8297" y2="1123.0703"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1331.2" x2="1331.2" y1="109.8297" y2="1123.0703"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="78.4" x="26.4" y="107.4672">Hub Employee</text><ellipse cx="68" cy="51.0391" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="6.4" ry="6.4" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><path d="M68,57.4391 L68,79.0391 M57.6,63.8391 L78.4,63.8391 M68,79.0391 L57.6,91.0391 M68,79.0391 L78.4,91.0391 " fill="none" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="78.4" x="26.4" y="1133.0985">Hub Employee</text><ellipse cx="68" cy="1143.461" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="6.4" ry="6.4" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><path d="M68,1149.861 L68,1171.461 M57.6,1156.261 L78.4,1156.261 M68,1171.461 L57.6,1183.461 M68,1171.461 L78.4,1183.461 " fill="none" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="120.8" x="357.2" y="107.4672">Settlement Service API</text><path d="M403.6,74.2391 L403.6,93.4391 M403.6,83.8391 L417.2,83.8391 " fill="none" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="426.8" cy="83.8391" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="120.8" x="357.2" y="1133.0985">Settlement Service API</text><path d="M403.6,1138.661 L403.6,1157.861 M403.6,1148.261 L417.2,1148.261 " fill="none" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="426.8" cy="1148.261" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="570" y="107.4672">Settlement Window</text><ellipse cx="624.8" cy="83.8391" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="621.6,74.2391,626.4,70.2391,624.8,74.2391,626.4,78.2391,621.6,74.2391" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="570" y="1133.0985">Settlement Window</text><ellipse cx="624.8" cy="1148.261" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="621.6,1138.661,626.4,1134.661,624.8,1138.661,626.4,1142.661,621.6,1138.661" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="931.2" y="107.4672">Settlement DAO</text><ellipse cx="976.8" cy="83.8391" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><line style="stroke: #A80036; stroke-width: 1.600000023841858;" x1="967.2" x2="986.4" y1="95.0391" y2="95.0391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="931.2" y="1133.0985">Settlement DAO</text><ellipse cx="976.8" cy="1148.261" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><line style="stroke: #A80036; stroke-width: 1.600000023841858;" x1="967.2" x2="986.4" y1="1159.461" y2="1159.461"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="102.4" x="1177.6" y="107.4672">Central Service API</text><path d="M1214.8,74.2391 L1214.8,93.4391 M1214.8,83.8391 L1228.4,83.8391 " fill="none" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="1238" cy="83.8391" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="102.4" x="1177.6" y="1133.0985">Central Service API</text><path d="M1214.8,1138.661 L1214.8,1157.861 M1214.8,1148.261 L1228.4,1148.261 " fill="none" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="1238" cy="1148.261" fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="72" x="1292.8" y="107.4672">Central Store</text><path d="M1316.8,67.8391 C1316.8,59.8391 1331.2,59.8391 1331.2,59.8391 C1331.2,59.8391 1345.6,59.8391 1345.6,67.8391 L1345.6,88.6391 C1345.6,96.6391 1331.2,96.6391 1331.2,96.6391 C1331.2,96.6391 1316.8,96.6391 1316.8,88.6391 L1316.8,67.8391 " fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M1316.8,67.8391 C1316.8,75.8391 1331.2,75.8391 1331.2,75.8391 C1331.2,75.8391 1345.6,75.8391 1345.6,67.8391 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="72" x="1292.8" y="1133.0985">Central Store</text><path d="M1316.8,1143.461 C1316.8,1135.461 1331.2,1135.461 1331.2,1135.461 C1331.2,1135.461 1345.6,1135.461 1345.6,1143.461 L1345.6,1164.261 C1345.6,1172.261 1331.2,1172.261 1331.2,1172.261 C1331.2,1172.261 1316.8,1172.261 1316.8,1164.261 L1316.8,1143.461 " fill="#FEFECE" filter="url(#f15a3mno5hh3r0)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M1316.8,1143.461 C1316.8,1151.461 1331.2,1151.461 1331.2,1151.461 C1331.2,1151.461 1345.6,1151.461 1345.6,1143.461 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="23.4484" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="416" y="246.7688"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="23.4484" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="416" y="751.9859"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="100.9938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="416" y="915.786"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="481.7688" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="620.8" y="270.2172"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="602.6719" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="972.8" y="313.1141"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1327.2" y="368.0109"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1327.2" y="513.5016"/><rect fill="#FFFFFF" filter="url(#f15a3mno5hh3r0)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1327.2" y="636.6469"/><path d="M10.4,123.4297 L252.8,123.4297 L252.8,129.0297 L244.8,137.0297 L10.4,137.0297 L10.4,123.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="986.0406" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1432" x="10.4" y="123.4297"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="206.4" x="22.4" y="134.2844">Request closure of Settlement Window</text><path d="M72,141.2781 L72,222.0781 L266.4,222.0781 L266.4,149.2781 L258.4,141.2781 L72,141.2781 " fill="#FFFF00" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M258.4,141.2781 L258.4,149.2781 L266.4,149.2781 L258.4,141.2781 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="165.6" x="76.8" y="155.3328">POST:: '/settlementWindows/{id}'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="80" y="167.5813"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="76.8" y="179.8297">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="83.2" x="83.2" y="192.0781">"state": "closed",</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="171.2" x="83.2" y="204.3266">"reason": "motivation for closure."</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="76.8" y="216.575">}</text><polygon fill="#A80036" points="406.4,243.5688,414.4,246.7688,406.4,249.9688,409.6,246.7688" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="68" x2="411.2" y1="246.7688" y2="246.7688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="73.6" y="243.2234">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="322.4" x="84" y="243.2234">API call Settlement Service to close specified settlement window</text><polygon fill="#A80036" points="611.2,267.0172,619.2,270.2172,611.2,273.4172,614.4,270.2172" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="420" x2="616" y1="270.2172" y2="270.2172"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="425.6" y="266.6719">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="126.4" x="436" y="266.6719">Close settlement window</text><path d="M18.4,282.4656 L68,282.4656 L68,288.0656 L60,296.0656 L18.4,296.0656 L18.4,282.4656 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="821.4047" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1416" x="18.4" y="282.4656"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="30.4" y="293.3203">alt</text><polygon fill="#A80036" points="963.2,309.9141,971.2,313.1141,963.2,316.3141,966.4,313.1141" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="628.8" x2="968" y1="313.1141" y2="313.1141"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="634.4" y="309.5688">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="318.4" x="644.8" y="309.5688">Close settlementWindow&lt;id&gt; and open new settlementWindow</text><path d="M915.2,325.3625 L1047.2,325.3625 L1047.2,330.9625 L1039.2,338.9625 L915.2,338.9625 L915.2,325.3625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="380.775" style="stroke: #000000; stroke-width: 1.600000023841858;" width="511.2" x="915.2" y="325.3625"/><text fill="#0000FF" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="927.2" y="336.2172">DB TRANSACTION</text><polygon fill="#A80036" points="1317.6,364.8109,1325.6,368.0109,1317.6,371.2109,1320.8,368.0109" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="980.8" x2="1322.4" y1="368.0109" y2="368.0109"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="986.4" y="358.5898">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="228" x="996.8" y="352.4656">Get state for settlementWindow&lt;id&gt; from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="996.8" y="364.7141">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="1058.4" y="364.7141">2001</text><polygon fill="#FFFFE0" filter="url(#f15a3mno5hh3r0)" points="1252,402.9078,1410.4,402.9078,1418.4,418.1078,1410.4,433.3078,1252,433.3078,1244,418.1078,1252,402.9078" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="92.8" x="1253.6" y="416.1625">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="155.2" x="1253.6" y="428.4109">settlementWindowStateChange</text><path d="M923.2,443.4047 L1077.6,443.4047 L1077.6,449.0047 L1069.6,457.0047 L923.2,457.0047 L923.2,443.4047 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="308" x="923.2" y="443.4047"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118.4" x="935.2" y="454.2594">Validate window state</text><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="980.8" x2="1014.4" y1="474.3016" y2="474.3016"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="1014.4" x2="1014.4" y1="474.3016" y2="484.7016"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="981.6" x2="1014.4" y1="484.7016" y2="484.7016"/><polygon fill="#A80036" points="989.6,481.5016,981.6,484.7016,989.6,487.9016,986.4,484.7016" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="986.4" y="470.5078">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="224.8" x="996.8" y="470.5078">Validate settlementWindowStateId == 'OPEN'</text><polygon fill="#A80036" points="1317.6,510.3016,1325.6,513.5016,1317.6,516.7016,1320.8,513.5016" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="980.8" x2="1322.4" y1="513.5016" y2="513.5016"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="986.4" y="509.9563">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="226.4" x="996.8" y="509.9563">Insert settlementWindowStateId == 'CLOSED'</text><polygon fill="#FFFFE0" filter="url(#f15a3mno5hh3r0)" points="1252,548.15,1410.4,548.15,1418.4,563.35,1410.4,578.55,1252,578.55,1244,563.35,1252,548.15" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="92.8" x="1253.6" y="561.4047">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="155.2" x="1253.6" y="573.6531">settlementWindowStateChange</text><polygon fill="#A80036" points="1317.6,633.4469,1325.6,636.6469,1317.6,639.8469,1320.8,636.6469" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="980.8" x2="1322.4" y1="636.6469" y2="636.6469"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="986.4" y="614.6742">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="151.2" x="996.8" y="596.3016">Create new settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="76.8" x="1000" y="608.55">state == 'open'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="198.4" x="1000" y="620.7984">reason == 'motivation for new Window'</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="996.8" y="633.0469">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="1058.4" y="633.0469">2001</text><polygon fill="#FFFFE0" filter="url(#f15a3mno5hh3r0)" points="1252,671.2406,1410.4,671.2406,1418.4,686.4406,1410.4,701.6406,1252,701.6406,1244,686.4406,1252,671.2406" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="92.8" x="1253.6" y="684.4953">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="155.2" x="1253.6" y="696.7438">settlementWindowStateChange</text><polygon fill="#A80036" points="637.6,725.3375,629.6,728.5375,637.6,731.7375,634.4,728.5375" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="632.8" x2="972" y1="728.5375" y2="728.5375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="642.4" y="724.9922">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="235.2" x="652.8" y="724.9922">Successful update for settlementWindow to DB</text><polygon fill="#A80036" points="432.8,748.7859,424.8,751.9859,432.8,755.1859,429.6,751.9859" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="428" x2="624" y1="751.9859" y2="751.9859"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="437.6" y="748.4406">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="171.2" x="448" y="748.4406">Operation successfully completed</text><polygon fill="#A80036" points="76.8,772.2344,68.8,775.4344,76.8,778.6344,73.6,775.4344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="72" x2="419.2" y1="775.4344" y2="775.4344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="81.6" y="771.8891">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="99.2" y="771.8891">Return results</text><path d="M272,786.0828 L272,879.6828 L412.8,879.6828 L412.8,794.0828 L404.8,786.0828 L272,786.0828 " fill="#FFFF00" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M404.8,786.0828 L404.8,794.0828 L412.8,794.0828 L404.8,786.0828 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="276.8" y="800.1375">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="33.6" x="283.2" y="812.3859">"id": 0,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="88.8" x="283.2" y="824.6344">"reason": "string",</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="80" x="283.2" y="836.8828">"state": "string",</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="115.2" x="283.2" y="849.1313">"createdDate": "string",</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="117.6" x="283.2" y="861.3797">"changedDate": "string"</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="276.8" y="873.6281">}</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="18.4" x2="1434.4" y1="887.8219" y2="887.8219"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="22.4" y="896.3297">[</text><text fill="#FF0000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="280" x="25.6" y="896.3297">Settlement Window not found or Settlement Window not 'open'</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="305.6" y="896.3297">]</text><polygon fill="#A80036" points="432.8,912.586,424.8,915.786,432.8,918.986,429.6,915.786" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="428" x2="976" y1="915.786" y2="915.786"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="437.6" y="912.2406">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="227.2" x="455.2" y="912.2406">settlement window not found - return ERROR</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="424" x2="457.6" y1="939.4828" y2="939.4828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="457.6" x2="457.6" y1="939.4828" y2="949.8828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="424.8" x2="457.6" y1="949.8828" y2="949.8828"/><polygon fill="#A80036" points="432.8,946.6828,424.8,949.8828,432.8,953.0828,429.6,949.8828" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="429.6" y="935.6891">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="84.8" x="447.2" y="935.6891">Update Event log</text><path d="M428,960.2828 L428,992.2828 L593.6,992.2828 L593.6,968.2828 L585.6,960.2828 L428,960.2828 " fill="#ADD8E6" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M585.6,960.2828 L585.6,968.2828 L593.6,968.2828 L585.6,960.2828 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="109.6" x="432.8" y="974.3375">Log ERROR Messages.</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="148.8" x="432.8" y="986.586">Update Event log with ERROR.</text><polygon fill="#A80036" points="76.8,1013.5797,68.8,1016.7797,76.8,1019.9797,73.6,1016.7797" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="72" x2="419.2" y1="1016.7797" y2="1016.7797"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="81.6" y="1013.2344">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="68.8" x="99.2" y="1013.2344">Return ERROR</text><path d="M177.6,1027.4281 L177.6,1096.2281 L412.8,1096.2281 L412.8,1035.4281 L404.8,1027.4281 L177.6,1027.4281 " fill="#FFFF00" filter="url(#f15a3mno5hh3r0)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M404.8,1027.4281 L404.8,1035.4281 L412.8,1035.4281 L404.8,1027.4281 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="182.4" y="1041.4828">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="55.2" x="188.8" y="1053.7313">"status": 0,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="212" x="188.8" y="1065.9797">"code": "MISSING_REQUIRED_PARAMETER",</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="96" x="188.8" y="1078.2281">"message": "string"</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="182.4" y="1090.4766">}</text><!--
@startuml
title 6.1.2. closeSettlementWindow POST: /settlementWindows

autonumber



actor "Hub Employee" as OPERATOR

boundary "Settlement Service API" as SSAPI
control "Settlement Window" as SETTLEWINDOW
entity "Settlement DAO" as SETTLE_DAO

boundary "Central Service API" as CSAPI
database "Central Store" as DB

box "Central HUB" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLEWINDOW
    participant SETTLE_DAO
end box

box "Central Services" #LightYellow
    participant CSAPI
    participant DB
end box


group Request closure of Settlement Window
    note right of OPERATOR #Yellow
        POST:: '/settlementWindows/{id}'

        {
          "state": "closed",
          "reason": "motivation for closure."
        }
    end note
    OPERATOR -> SSAPI: API call Settlement Service to close specified settlement window
    activate SSAPI
    SSAPI -> SETTLEWINDOW: Close settlement window
    deactivate SSAPI
    activate SETTLEWINDOW
    alt
        SETTLEWINDOW -> SETTLE_DAO: Close settlementWindow<id> and open new settlementWindow
        activate SETTLE_DAO
        group <color #blue>DB TRANSACTION</color>
            SETTLE_DAO -> DB: Get state for settlementWindow<id> from DB \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
            hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
            end hnote
            deactivate DB
            group Validate window state
                SETTLE_DAO <- -> SETTLE_DAO: Validate settlementWindowStateId == 'OPEN'
            end
                SETTLE_DAO -> DB: Insert settlementWindowStateId == 'CLOSED'
            activate DB
                hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
                end hnote
            deactivate DB

            SETTLE_DAO -> DB: Create new settlementWindow \n state == 'open'\n reason == 'motivation for new Window' \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
                hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
                end hnote
            deactivate DB
        end
        SETTLEWINDOW <- SETTLE_DAO: Successful update for settlementWindow to DB
    SSAPI <- SETTLEWINDOW: Operation successfully completed
    deactivate SETTLEWINDOW
    activate SSAPI
    OPERATOR <- SSAPI: Return results
        note left of SSAPI #Yellow
        {
          "id": 0,
          "reason": "string",
          "state": "string",
          "createdDate": "string",
          "changedDate": "string"
        }
        end note
    deactivate SSAPI
    else <color #FF0000><b>Settlement Window not found or Settlement Window not 'open'</b></color>

    SETTLE_DAO -> SSAPI: settlement window not found - return ERROR
    deactivate SETTLE_DAO
    activate SSAPI
    SSAPI -> SSAPI: Update Event log
    note right of SSAPI #LightBlue
        Log ERROR Messages.
        Update Event log with ERROR.
    end note
    OPERATOR <- SSAPI: Return ERROR
    note left of SSAPI #Yellow
        {
          "status": 0,
          "code": "MISSING_REQUIRED_PARAMETER",
          "message": "string"
        }
    end note
    deactivate SSAPI
    end
end
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>