<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="9335px" preserveAspectRatio="none" style="width:1552px;height:9335px;" version="1.1" viewBox="0 0 1552 9335" width="1552px" zoomAndPan="magnify"><defs><filter height="300%" id="f9nl3glcxqp03" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="342" x="605.5" y="23.5352">6.2.5. Acknowledgement of Settlement Transfer</text><rect fill="#FFB6C1" height="9289.5645" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="107" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="122.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="9289.5645" style="stroke: #A80036; stroke-width: 1.0;" width="636.5" x="263.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="519.75" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="9289.5645" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="1146" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="1149" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="9081.2773" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="158" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="8551.6504" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="341" y="660.9141"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="243.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="705.5352"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="366.2109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="993.8828"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="320.2793" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="1404.7148"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="228.416" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="1769.6152"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="59.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="7334.8379"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="59.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="7911.8242"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="59.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="8220.7949"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="734.8457"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="307.5898" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="1023.1934"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="261.6582" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="1434.0254"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="169.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="1798.9258"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="7364.1484"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="7941.1348"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="8250.1055"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="9066.2773" style="stroke: #000000; stroke-width: 2.0;" width="1527" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="646.9844" style="stroke: #000000; stroke-width: 2.0;" width="656.5" x="257.5" y="3405.1855"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="165.1523" style="stroke: #000000; stroke-width: 2.0;" width="351" x="346" y="3798.3965"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="351" x="346" y="3855.0176"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="351" x="346" y="3909.2832"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="179.1055" style="stroke: #000000; stroke-width: 2.0;" width="297" x="346" y="4188.1016"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="504.7422" style="stroke: #000000; stroke-width: 2.0;" width="534" x="336" y="4503.1387"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="165.1523" style="stroke: #000000; stroke-width: 2.0;" width="369" x="346" y="4796.418"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="369" x="346" y="4853.0391"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="369" x="346" y="4907.3047"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="1871.125" style="stroke: #000000; stroke-width: 2.0;" width="797.5" x="237.5" y="5371.4707"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="1712.2617" style="stroke: #000000; stroke-width: 2.0;" width="777.5" x="247.5" y="5523.334"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="1599.3301" style="stroke: #000000; stroke-width: 2.0;" width="757.5" x="257.5" y="5629.2656"/><rect fill="#FFFFFF" height="249.6816" style="stroke: none; stroke-width: 1.0;" width="757.5" x="257.5" y="5820.0605"/><rect fill="#FFFFFF" height="341.5449" style="stroke: none; stroke-width: 1.0;" width="757.5" x="257.5" y="6069.7422"/><rect fill="#FFFFFF" height="580.582" style="stroke: none; stroke-width: 1.0;" width="757.5" x="257.5" y="6411.2871"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="148.4844" style="stroke: #000000; stroke-width: 2.0;" width="510" x="346" y="6836.3848"/><rect fill="#FFFFFF" height="236.7266" style="stroke: none; stroke-width: 1.0;" width="757.5" x="257.5" y="6991.8691"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="1071.8203" style="stroke: #000000; stroke-width: 2.0;" width="1121.5" x="247.5" y="7256.5957"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="154.5527" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="257.5" y="7280.9063"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="562.9863" style="stroke: #000000; stroke-width: 2.0;" width="1064.5" x="257.5" y="7449.459"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="293.8809" style="stroke: #000000; stroke-width: 2.0;" width="616" x="326" y="7574.3223"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="207.9492" style="stroke: #000000; stroke-width: 2.0;" width="596" x="336" y="7653.2539"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="126.418" style="stroke: #000000; stroke-width: 2.0;" width="540" x="346" y="7688.4746"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="294.9707" style="stroke: #000000; stroke-width: 2.0;" width="1039.5" x="257.5" y="8026.4453"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="126.418" style="stroke: #000000; stroke-width: 2.0;" width="494" x="346" y="8050.7559"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="163" x2="163" y1="137.2871" y2="9237.5645"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="9237.5645"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="839" x2="839" y1="137.2871" y2="9237.5645"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1203" x2="1203" y1="137.2871" y2="9237.5645"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="111" y="134.334">Hub Employee</text><ellipse cx="163" cy="63.7988" fill="#FEFECE" filter="url(#f9nl3glcxqp03)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M163,71.7988 L163,98.7988 M150,79.7988 L176,79.7988 M163,98.7988 L150,113.7988 M163,98.7988 L176,113.7988 " fill="none" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="111" y="9250.0996">Hub Employee</text><ellipse cx="163" cy="9263.0527" fill="#FEFECE" filter="url(#f9nl3glcxqp03)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M163,9271.0527 L163,9298.0527 M150,9279.0527 L176,9279.0527 M163,9298.0527 L150,9313.0527 M163,9298.0527 L176,9313.0527 " fill="none" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="267.5" y="134.334">Settlement Service API</text><path d="M325.5,92.7988 L325.5,116.7988 M325.5,104.7988 L342.5,104.7988 " fill="none" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="104.7988" fill="#FEFECE" filter="url(#f9nl3glcxqp03)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="267.5" y="9250.0996">Settlement Service API</text><path d="M325.5,9257.0527 L325.5,9281.0527 M325.5,9269.0527 L342.5,9269.0527 " fill="none" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="9269.0527" fill="#FEFECE" filter="url(#f9nl3glcxqp03)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="782" y="134.334">Settlement DAO</text><ellipse cx="839" cy="104.7988" fill="#FEFECE" filter="url(#f9nl3glcxqp03)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="827" x2="851" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="782" y="9250.0996">Settlement DAO</text><ellipse cx="839" cy="9269.0527" fill="#FEFECE" filter="url(#f9nl3glcxqp03)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="827" x2="851" y1="9283.0527" y2="9283.0527"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1155" y="134.334">Central Store</text><path d="M1185,84.7988 C1185,74.7988 1203,74.7988 1203,74.7988 C1203,74.7988 1221,74.7988 1221,84.7988 L1221,110.7988 C1221,120.7988 1203,120.7988 1203,120.7988 C1203,120.7988 1185,120.7988 1185,110.7988 L1185,84.7988 " fill="#FEFECE" filter="url(#f9nl3glcxqp03)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1185,84.7988 C1185,94.7988 1203,94.7988 1203,94.7988 C1203,94.7988 1221,94.7988 1221,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1155" y="9250.0996">Central Store</text><path d="M1185,9263.0527 C1185,9253.0527 1203,9253.0527 1203,9253.0527 C1203,9253.0527 1221,9253.0527 1221,9263.0527 L1221,9289.0527 C1221,9299.0527 1203,9299.0527 1203,9299.0527 C1203,9299.0527 1185,9299.0527 1185,9289.0527 L1185,9263.0527 " fill="#FEFECE" filter="url(#f9nl3glcxqp03)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1185,9263.0527 C1185,9273.0527 1203,9273.0527 1203,9273.0527 C1203,9273.0527 1221,9273.0527 1221,9263.0527 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="9081.2773" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="158" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="8551.6504" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="341" y="660.9141"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="243.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="705.5352"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="366.2109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="993.8828"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="320.2793" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="1404.7148"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="228.416" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="1769.6152"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="59.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="7334.8379"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="59.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="7911.8242"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="59.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="834" y="8220.7949"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="734.8457"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="307.5898" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="1023.1934"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="261.6582" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="1434.0254"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="169.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="1798.9258"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="7364.1484"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="7941.1348"/><rect fill="#FFFFFF" filter="url(#f9nl3glcxqp03)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1198" y="8250.1055"/><path d="M13,154.2871 L339,154.2871 L339,161.2871 L329,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="9066.2773" style="stroke: #000000; stroke-width: 2.0;" width="1527" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="281" x="28" y="167.8555">Acknowledgement of Settlement Transfer</text><path d="M173,176.5977 L173,630.5977 L481,630.5977 L481,186.5977 L471,176.5977 L173,176.5977 " fill="#FFFF00" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M471,176.5977 L471,186.5977 L481,186.5977 L471,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="179" y="194.166">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="195" y="209.4766">"participants": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="211" y="224.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="227" y="240.0977">"id": 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="227" y="255.4082">"accounts" : [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="243" y="270.7188">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="259" y="286.0293">"id": 1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="259" y="301.3398">"state": "PENDING_SETTLEMENT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="259" y="316.6504">"reason": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="243" y="331.9609">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="243" y="347.2715">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="259" y="362.582">"id": 2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="259" y="377.8926">"state": "SETTLED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="259" y="393.2031">"reason": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="243" y="408.5137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="227" y="423.8242">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="211" y="439.1348">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="211" y="454.4453">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="227" y="469.7559">"id": 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="227" y="485.0664">"accounts" : [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="243" y="500.377">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="259" y="515.6875">"id": 3,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="259" y="530.998">"state": "NOT_SETTLED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="259" y="546.3086">"reason": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="243" y="561.6191">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="227" y="576.9297">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="211" y="592.2402">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="195" y="607.5508">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="179" y="622.8613">}</text><polygon fill="#A80036" points="329,656.9141,339,660.9141,329,664.9141,333,660.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="335" y1="660.9141" y2="660.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="175" y="656.1719">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="188" y="656.1719">PUT - /settlement/{id}</text><polygon fill="#A80036" points="822,701.5352,832,705.5352,822,709.5352,826,705.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="705.5352" y2="705.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="358" y="693.1377">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="371" y="685.4824">Retrive full information for settlement</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="371" y="700.793">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="448" y="700.793">2001</text><polygon fill="#A80036" points="1186,730.8457,1196,734.8457,1186,738.8457,1190,734.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="734.8457" y2="734.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="851" y="730.1035">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="864" y="730.1035">Select from DB</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="968,747.8457,1437,747.8457,1447,819.8457,1437,892.8457,968,892.8457,958,819.8457,968,747.8457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="465" x="970" y="764.4141">SELECT s.settlementId, ssc.settlementStateId, ssc.reason, ssc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="970" y="779.7246">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="1010" y="779.7246">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="1086" y="779.7246">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="970" y="795.0352">LEFT JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="1035" y="795.0352">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="1196" y="795.0352">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="970" y="810.3457">ON ssc.settlementId = s.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="970" y="825.6563">AND ssc.settelementStateChangeId = (</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="986" y="840.9668">SELECT MAX(ssc1.settelementStateChangeId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="986" y="856.2773">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="1026" y="856.2773">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="1187" y="856.2773">ssc1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="986" y="871.5879">WHERE ssc1.settlementId = {id})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="970" y="886.8984">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="855,915.9512,845,919.9512,855,923.9512,851,919.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="849" x2="1202" y1="919.9512" y2="919.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="861" y="915.209">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="874" y="915.209">Return data</text><polygon fill="#A80036" points="362,945.2617,352,949.2617,362,953.2617,358,949.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="356" x2="838" y1="949.2617" y2="949.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="368" y="944.5195">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="381" y="944.5195">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="426" y="944.5195">settlementData</text><polygon fill="#A80036" points="822,989.8828,832,993.8828,822,997.8828,826,993.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="993.8828" y2="993.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="358" y="981.4854">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="371" y="973.8301">Retrive full information for settlement accounts</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="371" y="989.1406">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="448" y="989.1406">2001</text><polygon fill="#A80036" points="1186,1019.1934,1196,1023.1934,1186,1027.1934,1190,1023.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="1023.1934" y2="1023.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="851" y="1018.4512">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="864" y="1018.4512">Select from DB</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="888,1036.1934,1518,1036.1934,1528,1170.1934,1518,1304.1934,888,1304.1934,878,1170.1934,888,1036.1934" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="570" x="890" y="1052.7617">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, spcsc.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="568" x="922" y="1068.0723">spcsc.createdDate, spc.netAmount, pc.currencyId, spc.settlementParticipantCurrencyId AS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1494" y="1068.0723">key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="890" y="1083.3828">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="930" y="1083.3828">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1141" y="1083.3828">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="890" y="1098.6934">JOIN (SELECT spcsc1.settlementParticipantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="954" y="1114.0039">MAX(spcsc1.settlementParticipantCurrencyStateChangeId) AS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="307" x="954" y="1129.3145">maxSettlementParticipantCurrencyStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="922" y="1144.625">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="962" y="1144.625">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="1173" y="1144.625">spc1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="922" y="1159.9355">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="954" y="1159.9355">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="1250" y="1159.9355">spcsc1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="528" x="922" y="1175.2461">ON spcsc1.settlementParticipantCurrencyId = spc1.settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="922" y="1190.5566">WHERE spc1.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="922" y="1205.8672">GROUP BY spcsc1.settlementParticipantCurrencyId) spcs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="890" y="1221.1777">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="922" y="1221.1777">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1218" y="1221.1777">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="890" y="1236.4883">ON spcsc.settlementParticipantCurrencyStateChangeId =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="906" y="1251.7988">spcs.maxSettlementParticipantCurrencyStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="890" y="1267.1094">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="922" y="1267.1094">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="1062" y="1267.1094">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="890" y="1282.4199">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="890" y="1297.7305">WHERE spc.settlementId = {id}</text><polygon fill="#A80036" points="855,1326.7832,845,1330.7832,855,1334.7832,851,1330.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="849" x2="1202" y1="1330.7832" y2="1330.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="861" y="1326.041">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="874" y="1326.041">Return data</text><polygon fill="#A80036" points="362,1356.0938,352,1360.0938,362,1364.0938,358,1360.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="356" x2="838" y1="1360.0938" y2="1360.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="368" y="1355.3516">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="381" y="1355.3516">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="426" y="1355.3516">settlementAccountsList</text><polygon fill="#A80036" points="822,1400.7148,832,1404.7148,822,1408.7148,826,1404.7148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="1404.7148" y2="1404.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="1392.3174">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="380" y="1384.6621">Retrive full information for settlement windows</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="380" y="1399.9727">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="457" y="1399.9727">2001</text><polygon fill="#A80036" points="1186,1430.0254,1196,1434.0254,1186,1438.0254,1190,1434.0254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="1434.0254" y2="1434.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="851" y="1429.2832">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="873" y="1429.2832">Select from DB</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="885,1447.0254,1520,1447.0254,1530,1558.0254,1520,1669.0254,885,1669.0254,875,1558.0254,885,1447.0254" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="631" x="887" y="1463.5938">SELECT ssw.settlementWindowId, sswsc.settlementWindowStateId, sswsc.reason, sswsc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="887" y="1478.9043">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="927" y="1478.9043">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1128" y="1478.9043">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="583" x="887" y="1494.2148">JOIN (SELECT sswsc1.settlementWindowId, MAX(sswsc1.settlementWindowStateChangeId) AS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="951" y="1509.5254">maxSettlementWindowStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="919" y="1524.8359">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="282" x="959" y="1524.8359">settlementSettlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1245" y="1524.8359">sswsc1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="919" y="1540.1465">WHERE sswsc1.settlementWindowId IN (</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="935" y="1555.457">SELECT ssw1.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="935" y="1570.7676">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="975" y="1570.7676">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1176" y="1570.7676">ssw1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="935" y="1586.0781">WHERE ssw1.settlementId = {id})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="919" y="1601.3887">GROUP BY sswsc1.settlementWindowId) ssws</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="361" x="887" y="1616.6992">ON ssws.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="887" y="1632.0098">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="282" x="919" y="1632.0098">settlementSettlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="1205" y="1632.0098">sswsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="558" x="887" y="1647.3203">ON sswsc.settlementWindowStateChangeId = ssws.maxSettlementWindowStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="887" y="1662.6309">WHERE ssw.settlementId = {id}</text><polygon fill="#A80036" points="855,1691.6836,845,1695.6836,855,1699.6836,851,1695.6836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="849" x2="1202" y1="1695.6836" y2="1695.6836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="861" y="1690.9414">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="883" y="1690.9414">Return data</text><polygon fill="#A80036" points="362,1720.9941,352,1724.9941,362,1728.9941,358,1724.9941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="356" x2="838" y1="1724.9941" y2="1724.9941"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="368" y="1720.252">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="390" y="1720.252">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="435" y="1720.252">windowsList</text><polygon fill="#A80036" points="822,1765.6152,832,1769.6152,822,1773.6152,826,1769.6152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="1769.6152" y2="1769.6152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="1757.2178">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="380" y="1749.5625">Retrive full information for settlement windows accounts</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="380" y="1764.873">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="457" y="1764.873">2001</text><polygon fill="#A80036" points="1186,1794.9258,1196,1798.9258,1186,1802.9258,1190,1798.9258" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="1798.9258" y2="1798.9258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="851" y="1794.1836">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="873" y="1794.1836">Select from DB</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="1009,1811.9258,1396,1811.9258,1406,1876.9258,1396,1941.9258,1009,1941.9258,999,1876.9258,1009,1811.9258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="366" x="1011" y="1828.4941">SELECT ssw.settlementWindowId, tp.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1011" y="1843.8047">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="1051" y="1843.8047">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1252" y="1843.8047">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1011" y="1859.1152">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="1043" y="1859.1152">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10" x="1169" y="1859.1152">tf</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="1011" y="1874.4258">ON tf.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1011" y="1889.7363">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="1043" y="1889.7363">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="1174" y="1889.7363">tp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1011" y="1905.0469">ON tp.transferId = tf.transferId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="1011" y="1920.3574">WHERE settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="383" x="1011" y="1935.668">GROUP BY ssw.settlementWindowId, tp.participantCurrencyId</text><polygon fill="#A80036" points="855,1964.7207,845,1968.7207,855,1972.7207,851,1968.7207" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="849" x2="1202" y1="1968.7207" y2="1968.7207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="861" y="1963.9785">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="883" y="1963.9785">Return data</text><polygon fill="#A80036" points="362,1994.0313,352,1998.0313,362,2002.0313,358,1998.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="356" x2="838" y1="1998.0313" y2="1998.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="368" y="1993.2891">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="390" y="1993.2891">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="435" y="1993.2891">windowsAccountsList</text><path d="M356,2011.0313 L356,3062.0313 L1127,3062.0313 L1127,2021.0313 L1117,2011.0313 L356,2011.0313 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1117,2011.0313 L1117,2021.0313 L1127,2021.0313 L1117,2011.0313 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="362" y="2028.5996">Available raw datasets from DB:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="362" y="2043.9102">settlementData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="423" x="469" y="2043.9102">contains information about settlement and its current state/reason</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="362" y="2059.2207">settlementAccountsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="524" y="2059.2207">holds information about all accounts and their current state/reason</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="362" y="2074.5313">windowsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="449" y="2074.5313">has information about all windows and their current state/reason</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="362" y="2089.8418">windowsAccountsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="511" y="2089.8418">has information about all accounts and windows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="2105.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="362" y="2120.4629">Local variables and objects:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="362" y="2135.7734">settlementAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="496" y="2135.7734">: { // (derived from</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="618" y="2135.7734">settlementAccountsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="767" y="2135.7734">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="567" x="378" y="2151.084">pendingSettlementCount: &lt;integer&gt;, // count of accounts in PENDING_SETTLEMENT state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="378" y="2166.3945">settledCount: &lt;integer&gt;, // count of accounts in SETTLED state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="378" y="2181.7051">notSettledCount: &lt;integer&gt; // count of accounts in NOT_SETTLED state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="2197.0156">}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="156" x="362" y="2212.3262">settlementAccountsInit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="427" x="522" y="2212.3262">copy of previous object to be preserved for comparission at the end</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="362" y="2227.6367">allParticipants</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="4" x="458" y="2227.6367">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="466" y="2227.6367">{ // same as participants response object with initial data &amp; key (derived from</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="959" y="2227.6367">settlementAccountsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1108" y="2227.6367">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="471" x="378" y="2242.9473">participantId_key: { // number used to access the object in array-like style</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="394" y="2258.2578">id: participantId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="394" y="2273.5684">accounts: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527" x="410" y="2288.8789">participantCurrencyId_key: { // number used to access the object in array-like style</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="426" y="2304.1895">id: participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="426" y="2319.5">state: settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="426" y="2334.8105">reason: reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="426" y="2350.1211">createdDate: createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="426" y="2365.4316">netSettlementAmount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="442" y="2380.7422">amount: netAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="442" y="2396.0527">currency: currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="426" y="2411.3633">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="410" y="2426.6738">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="394" y="2441.9844">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="2457.2949">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="2472.6055">}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="362" y="2487.916">allAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="440" y="2487.916">: { // same as previous but accessed by account id (derived from</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="850" y="2487.916">settlementAccountsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="999" y="2487.916">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527" x="378" y="2503.2266">participantCurrencyId_key: { // number used to access the object in array-like style</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="394" y="2518.5371">id: participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="394" y="2533.8477">state: settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="394" y="2549.1582">reason: reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="394" y="2564.4688">createdDate: createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="394" y="2579.7793">netSettlementAmount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="410" y="2595.0898">amount: netAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="410" y="2610.4004">currency: currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="394" y="2625.7109">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="468" x="394" y="2641.0215">participantId: participantId, // could be used to reconstruct allParticipants</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="394" y="2656.332">key:</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="424" y="2656.332">key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="430" x="450" y="2656.332">// will be used to insert new state for settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="2671.6426">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="2686.9531">}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="362" y="2702.2637">allWindows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="506" x="438" y="2702.2637">: { // same as settlementWindows response object with initial data (derived from</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="948" y="2702.2637">windowsList</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1026" y="2702.2637">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="519" x="378" y="2717.5742">settlementWindowId_key: { // number used to access the object in array-like style</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="394" y="2732.8848">id: settlementWindowId, // same as key value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="394" y="2748.1953">state: settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="394" y="2763.5059">reason: reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="394" y="2778.8164">createdDate: createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="2794.127">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="2809.4375">}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="362" y="2824.748">windowsAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="483" y="2824.748">: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="519" x="378" y="2840.0586">settlementWindowId_key: { // number used to access the object in array-like style</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="394" y="2855.3691">id: settlementWindowId // same as key value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="567" x="394" y="2870.6797">pendingSettlementCount: &lt;integer&gt;, // count of accounts in PENDING_SETTLEMENT state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="394" y="2885.9902">settledCount: &lt;integer&gt;, // count of accounts in SETTLED state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="394" y="2901.3008">notSettledCount: &lt;integer&gt; // count of accounts in NOT_SETTLED state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="2916.6113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="2931.9219">}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="362" y="2947.2324">windowsAccountsInit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="427" x="509" y="2947.2324">copy of previous object to be preserved for comparission at the end</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="362" y="2962.543">accountsWindows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="482" y="2962.543">: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527" x="378" y="2977.8535">participantCurrencyId_key: { // number used to access the object in array-like style</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="394" y="2993.1641">id: participantCurrencyId, // same as key value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="448" x="394" y="3008.4746">windows: [] // array of windows to which the account settlement spans</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="3023.7852">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="3039.0957">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="362" y="3054.4063">let</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="382" y="3054.4063">transactionTimestamp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="538" y="3054.4063">= now()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="3132.7695" y2="3132.7695"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="3132.7695" y2="3145.7695"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="3145.7695" y2="3145.7695"/><polygon fill="#A80036" points="362,3141.7695,352,3145.7695,362,3149.7695,358,3145.7695" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="3120.3721">18</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="380" y="3112.7168">Acquire DB lock</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="490" y="3112.7168">on settlementParticipantCurrencyStateChange,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380" y="3128.0273">settlementWindowStateChange and settlementStateChange</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="3200.0801" y2="3200.0801"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="3200.0801" y2="3213.0801"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="3213.0801" y2="3213.0801"/><polygon fill="#A80036" points="362,3209.0801,352,3213.0801,362,3217.0801,358,3213.0801" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="3195.3379">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="380" y="3195.3379">Declare and initialize variables</text><path d="M356,3226.0801 L356,3389.0801 L659,3389.0801 L659,3236.0801 L649,3226.0801 L356,3226.0801 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M649,3226.0801 L649,3236.0801 L659,3236.0801 L649,3226.0801 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="362" y="3243.6484">let settlementAccounts = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="378" y="3258.959">pendingSettlementAccounts: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="378" y="3274.2695">settledAccounts: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="378" y="3289.5801">notSettledAccounts: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="3304.8906">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="362" y="3320.2012">let allParticipants = {} // declare sparse array</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="362" y="3335.5117">let allAccounts = {} // declare sparse array</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="362" y="3350.8223">let pid // participantId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="362" y="3366.1328">let aid // accountId (participantCurrencyId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="362" y="3381.4434">let state</text><path d="M257.5,3405.1855 L331.5,3405.1855 L331.5,3412.1855 L321.5,3422.1855 L257.5,3422.1855 L257.5,3405.1855 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="646.9844" style="stroke: #000000; stroke-width: 2.0;" width="656.5" x="257.5" y="3405.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="272.5" y="3418.7539">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="193" x="346.5" y="3417.8203">[settlementAccountsList as record]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="3443.8066" y2="3443.8066"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="3443.8066" y2="3456.8066"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="3456.8066" y2="3456.8066"/><polygon fill="#A80036" points="362,3452.8066,352,3456.8066,362,3460.8066,358,3456.8066" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="3439.0645">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="380" y="3439.0645">Populate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="438" y="3439.0645">allAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="520" y="3439.0645">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="547" y="3439.0645">allParticipants</text><path d="M356,3469.8066 L356,3739.8066 L900,3739.8066 L900,3479.8066 L890,3469.8066 L356,3469.8066 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M890,3469.8066 L890,3479.8066 L900,3479.8066 L890,3469.8066 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="362" y="3487.375">pid = record.participantId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="362" y="3502.6855">aid = record.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="362" y="3517.9961">state = record.settlementStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="3533.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="362" y="3548.6172">allAccounts[aid] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="378" y="3563.9277">id: aid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="378" y="3579.2383">state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="378" y="3594.5488">reason: record.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="378" y="3609.8594">createDate: record.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="378" y="3625.1699">netSettlementAmount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="394" y="3640.4805">amount: record.netAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="394" y="3655.791">currency: record.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="378" y="3671.1016">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="378" y="3686.4121">key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="3701.7227">}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="523" x="362" y="3717.0332">allParticipants[pid] = allParticipants[pid] ? allParticipants[pid] : {id: pid, accounts: {}}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="324" x="362" y="3732.3438">allParticipants[pid].accounts[aid] = allAccounts[aid]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="3770.3965" y2="3770.3965"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="3770.3965" y2="3783.3965"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="3783.3965" y2="3783.3965"/><polygon fill="#A80036" points="362,3779.3965,352,3783.3965,362,3787.3965,358,3783.3965" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="3765.6543">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="380" y="3765.6543">Populate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="438" y="3765.6543">settlementAccounts</text><path d="M346,3798.3965 L408,3798.3965 L408,3805.3965 L398,3815.3965 L346,3815.3965 L346,3798.3965 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="165.1523" style="stroke: #000000; stroke-width: 2.0;" width="351" x="346" y="3798.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="361" y="3811.9648">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="423" y="3811.0313">[state == 'PENDING_SETTLEMENT']</text><path d="M356,3820.707 L356,3845.707 L683,3845.707 L683,3830.707 L673,3820.707 L356,3820.707 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M673,3820.707 L673,3830.707 L683,3830.707 L673,3820.707 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="362" y="3838.2754">settlementAccounts.pendingSettlementCount++</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="346" x2="697" y1="3856.0176" y2="3856.0176"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="351" y="3866.6523">[state == 'SETTLED']</text><path d="M356,3874.9727 L356,3899.9727 L608,3899.9727 L608,3884.9727 L598,3874.9727 L356,3874.9727 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M598,3874.9727 L598,3884.9727 L608,3884.9727 L598,3874.9727 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="362" y="3892.541">settlementAccounts.settledCount++</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="346" x2="697" y1="3910.2832" y2="3910.2832"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="351" y="3920.918">[state == 'NOT_SETTLED']</text><path d="M356,3929.2383 L356,3954.2383 L629,3954.2383 L629,3939.2383 L619,3929.2383 L356,3929.2383 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M619,3929.2383 L619,3939.2383 L629,3939.2383 L619,3929.2383 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="362" y="3946.8066">settlementAccounts.notSettledCount++</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="3991.8594" y2="3991.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="3991.8594" y2="4004.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="4004.8594" y2="4004.8594"/><polygon fill="#A80036" points="362,4000.8594,352,4004.8594,362,4008.8594,358,4004.8594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="3987.1172">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="380" y="3987.1172">Make a copy of settlementAccounts</text><path d="M356,4017.8594 L356,4042.8594 L778,4042.8594 L778,4027.8594 L768,4017.8594 L356,4017.8594 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M768,4017.8594 L768,4027.8594 L778,4027.8594 L768,4017.8594 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="401" x="362" y="4035.4277">settlementAccountsInit = Object.assign({}, settlementAccounts)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="4105.4805" y2="4105.4805"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="4105.4805" y2="4118.4805"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="4118.4805" y2="4118.4805"/><polygon fill="#A80036" points="362,4114.4805,352,4118.4805,362,4122.4805,358,4118.4805" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="4100.7383">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="380" y="4100.7383">Declare and populate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="517" y="4100.7383">allWindows</text><path d="M356,4131.4805 L356,4171.4805 L641,4171.4805 L641,4141.4805 L631,4131.4805 L356,4131.4805 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M631,4131.4805 L631,4141.4805 L641,4141.4805 L631,4131.4805 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="362" y="4149.0488">let allWindows = {} // declare sparse array</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="362" y="4164.3594">let wid // settlementWindowId</text><path d="M346,4188.1016 L420,4188.1016 L420,4195.1016 L410,4205.1016 L346,4205.1016 L346,4188.1016 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="179.1055" style="stroke: #000000; stroke-width: 2.0;" width="297" x="346" y="4188.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="361" y="4201.6699">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="435" y="4200.7363">[windowsList as record]</text><path d="M356,4210.4121 L356,4357.4121 L629,4357.4121 L629,4220.4121 L619,4210.4121 L356,4210.4121 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M619,4210.4121 L619,4220.4121 L629,4220.4121 L619,4210.4121 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="362" y="4227.9805">wid = record.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="362" y="4243.291">state = record.settlementWindowStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="4258.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="362" y="4273.9121">allWindows[wid] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="378" y="4289.2227">id: wid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="378" y="4304.5332">state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="378" y="4319.8438">reason: record.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="378" y="4335.1543">createDate: record.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="4350.4648">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="4420.5176" y2="4420.5176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="4420.5176" y2="4433.5176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="4433.5176" y2="4433.5176"/><polygon fill="#A80036" points="362,4429.5176,352,4433.5176,362,4437.5176,358,4433.5176" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="4415.7754">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="380" y="4415.7754">Declare and populate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="517" y="4415.7754">windowsAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="642" y="4415.7754">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="669" y="4415.7754">windowsAccounts</text><path d="M356,4446.5176 L356,4486.5176 L684,4486.5176 L684,4456.5176 L674,4446.5176 L356,4446.5176 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,4446.5176 L674,4456.5176 L684,4456.5176 L674,4446.5176 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="307" x="362" y="4464.0859">let windowsAccounts = {} // declare sparse array</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="362" y="4479.3965">let accountsWindows = {} // declare sparse array</text><path d="M336,4503.1387 L410,4503.1387 L410,4510.1387 L400,4520.1387 L336,4520.1387 L336,4503.1387 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="504.7422" style="stroke: #000000; stroke-width: 2.0;" width="534" x="336" y="4503.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="351" y="4516.707">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="425" y="4515.7734">[windowsAccountsList as record]</text><path d="M356,4525.4492 L356,4779.4492 L856,4779.4492 L856,4535.4492 L846,4525.4492 L356,4525.4492 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M846,4525.4492 L846,4535.4492 L856,4535.4492 L846,4525.4492 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="362" y="4543.0176">wid = record.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="362" y="4558.3281">aid = record.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="362" y="4573.6387">state = allAccounts[aid]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="4588.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="467" x="362" y="4604.2598">accountsWindows[aid] = accountsWindows[aid] ? accountsWindows[aid] : {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="378" y="4619.5703">id: aid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="378" y="4634.8809">windows: []</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="4650.1914">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="362" y="4665.502">accountsWindows[aid].windows.push(wid)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="4680.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="362" y="4696.123">windowsAccounts[wid] = windowsAccounts[wid] ? windowsAccounts[wid] : {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="378" y="4711.4336">id: wid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="378" y="4726.7441">pendingSettlementCount: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="378" y="4742.0547">settledCount: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="378" y="4757.3652">notSettledCount: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="4772.6758">}</text><path d="M346,4796.418 L408,4796.418 L408,4803.418 L398,4813.418 L346,4813.418 L346,4796.418 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="165.1523" style="stroke: #000000; stroke-width: 2.0;" width="369" x="346" y="4796.418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="361" y="4809.9863">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="423" y="4809.0527">[state == 'PENDING_SETTLEMENT']</text><path d="M356,4818.7285 L356,4843.7285 L701,4843.7285 L701,4828.7285 L691,4818.7285 L356,4818.7285 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M691,4818.7285 L691,4828.7285 L701,4828.7285 L691,4818.7285 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="362" y="4836.2969">windowsAccounts[wid].pendingSettlementCount++</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="346" x2="715" y1="4854.0391" y2="4854.0391"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="351" y="4864.6738">[state == 'SETTLED']</text><path d="M356,4872.9941 L356,4897.9941 L626,4897.9941 L626,4882.9941 L616,4872.9941 L356,4872.9941 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M616,4872.9941 L616,4882.9941 L626,4882.9941 L616,4872.9941 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="362" y="4890.5625">windowsAccounts[wid].settledCount++</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="346" x2="715" y1="4908.3047" y2="4908.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="351" y="4918.9395">[state == 'NOT_SETTLED']</text><path d="M356,4927.2598 L356,4952.2598 L647,4952.2598 L647,4937.2598 L637,4927.2598 L356,4927.2598 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M637,4927.2598 L637,4937.2598 L647,4937.2598 L637,4927.2598 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="362" y="4944.8281">windowsAccounts[wid].notSettledCount++</text><path d="M356,4973.5703 L356,4998.5703 L754,4998.5703 L754,4983.5703 L744,4973.5703 L356,4973.5703 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M744,4973.5703 L744,4983.5703 L754,4983.5703 L744,4973.5703 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="362" y="4991.1387">windowsAccountsInit = Object.assign({}, windowsAccounts)</text><path d="M356,5044.8809 L356,5329.8809 L1050,5329.8809 L1050,5054.8809 L1040,5044.8809 L356,5044.8809 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1040,5044.8809 L1040,5054.8809 L1050,5054.8809 L1040,5044.8809 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="362" y="5062.4492">Available objects after the setup:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="362" y="5077.7598">settlementAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="500" y="5077.7598">is used for tracing settlement state and state transition allowance</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="362" y="5093.0703">allParticipants</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="462" y="5093.0703">is used for tracing participant/account state and state transition</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="362" y="5108.3809">allAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="444" y="5108.3809">is helper object, same as previous, providing direct access to account by id</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="362" y="5123.6914">allWindows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="442" y="5123.6914">has window information for all windows in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="362" y="5139.002">windowsAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="466" x="487" y="5139.002">is used for tracing settlement window state and state transition allowance</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="362" y="5154.3125">accountsWindows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="486" y="5154.3125">is helper object to show the list of windows to which settlement account spans</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="5169.623"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="362" y="5184.9336">Now we are ready to process the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="570" y="5184.9336">payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="624" y="5184.9336">:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="362" y="5200.2441">participants</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="588" x="447" y="5200.2441">= [] // part of the response object that lists the affected participants and respective accounts</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="362" y="5215.5547">affectedWindows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="481" y="5215.5547">= [] // array of the affected windows</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="362" y="5230.8652">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="658" y="5230.8652">= [] // array to collect inserts to the table</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="362" y="5246.1758">processedAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="471" x="497" y="5246.1758">= [] // array to log processed accounts and restrict subsequent processing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="362" y="5261.4863">let</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="382" y="5261.4863">pi</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="399" y="5261.4863">// declare participant index</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="362" y="5276.7969">let</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="5276.7969">ai</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="398" y="5276.7969">// declare account index</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="362" y="5292.1074">let</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="382" y="5292.1074">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="460" y="5292.1074">-- declare pointer to current participant in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="100" x="756" y="5292.1074">response object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="362" y="5307.418">let</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="382" y="5307.418">participantPayload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="513" y="5307.418">-- declare pointer to current participant in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="92" x="809" y="5307.418">payload object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="362" y="5322.7285">let</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="382" y="5322.7285">accountPayload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="492" y="5322.7285">-- declare pointer to current account in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="92" x="770" y="5322.7285">payload object</text><path d="M237.5,5371.4707 L311.5,5371.4707 L311.5,5378.4707 L301.5,5388.4707 L237.5,5388.4707 L237.5,5371.4707 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1871.125" style="stroke: #000000; stroke-width: 2.0;" width="797.5" x="237.5" y="5371.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="252.5" y="5385.0391">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="326.5" y="5384.1055">[let p IN payload.participants]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="5410.0918" y2="5410.0918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="5410.0918" y2="5423.0918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="5423.0918" y2="5423.0918"/><polygon fill="#A80036" points="362,5419.0918,352,5423.0918,362,5427.0918,358,5423.0918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="5405.3496">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="380" y="5405.3496">Loop payload for each</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="523" y="5405.3496">participantPayload</text><path d="M356,5436.0918 L356,5507.0918 L736,5507.0918 L736,5446.0918 L726,5436.0918 L356,5436.0918 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M726,5436.0918 L726,5446.0918 L736,5446.0918 L726,5436.0918 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="362" y="5453.6602">participantPayload = payload.participants[p]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="362" y="5468.9707">participants.push({id: participantPayload.id, accounts: []})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="362" y="5484.2813">pi = participants.length - 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="362" y="5499.5918">participant = participants[pi]</text><path d="M247.5,5523.334 L321.5,5523.334 L321.5,5530.334 L311.5,5540.334 L247.5,5540.334 L247.5,5523.334 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1712.2617" style="stroke: #000000; stroke-width: 2.0;" width="777.5" x="247.5" y="5523.334"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="262.5" y="5536.9023">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="336.5" y="5535.9688">[let a IN participantPayload.accounts]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="5561.9551" y2="5561.9551"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="5561.9551" y2="5574.9551"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="5574.9551" y2="5574.9551"/><polygon fill="#A80036" points="362,5570.9551,352,5574.9551,362,5578.9551,358,5574.9551" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="5557.2129">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="380" y="5557.2129">Loop payload for each</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="523" y="5557.2129">accountPayload</text><path d="M356,5587.9551 L356,5612.9551 L685,5612.9551 L685,5597.9551 L675,5587.9551 L356,5587.9551 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M675,5587.9551 L675,5597.9551 L685,5597.9551 L675,5587.9551 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="362" y="5605.5234">accountPayload = participantPayload.accounts[a]</text><path d="M257.5,5629.2656 L319.5,5629.2656 L319.5,5636.2656 L309.5,5646.2656 L257.5,5646.2656 L257.5,5629.2656 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1599.3301" style="stroke: #000000; stroke-width: 2.0;" width="757.5" x="257.5" y="5629.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="272.5" y="5642.834">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="334.5" y="5641.9004">[allAccounts[accountPayload.id] == undefined]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="5667.8867" y2="5667.8867"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="5667.8867" y2="5680.8867"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="5680.8867" y2="5680.8867"/><polygon fill="#A80036" points="362,5676.8867,352,5680.8867,362,5684.8867,358,5680.8867" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="5663.1445">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="380" y="5663.1445">If the account doesn't match the settlement</text><path d="M356,5693.8867 L356,5810.8867 L644,5810.8867 L644,5703.8867 L634,5693.8867 L356,5693.8867 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M634,5693.8867 L634,5703.8867 L644,5703.8867 L634,5693.8867 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="362" y="5711.4551">participant.accounts.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="378" y="5726.7656">id: accountPayload.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="378" y="5742.0762">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="394" y="5757.3867">errorCode: &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="394" y="5772.6973">errorDescription: 'Account not found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="5788.0078">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="5803.3184">})</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="257.5" x2="1015" y1="5821.0605" y2="5821.0605"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="270" x="262.5" y="5831.6953">[processedAccounts.indexOf(accountPayload.id)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="5856.3262" y2="5856.3262"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="5856.3262" y2="5869.3262"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="5869.3262" y2="5869.3262"/><polygon fill="#A80036" points="362,5865.3262,352,5869.3262,362,5873.3262,358,5869.3262" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="5851.584">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="380" y="5851.584">If the account has been previosly processed (duplicated in the payload)</text><path d="M356,5882.3262 L356,6060.3262 L875,6060.3262 L875,5892.3262 L865,5882.3262 L356,5882.3262 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M865,5882.3262 L865,5892.3262 L875,5892.3262 L865,5882.3262 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="362" y="5899.8945">participant.accounts.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="378" y="5915.2051">id: accountPayload.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="378" y="5930.5156">state: allAccounts[accountPayload.id].state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="378" y="5945.8262">reason: allAccounts[accountPayload.id].reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="378" y="5961.1367">createdDate: allAccounts[accountPayload.id].createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482" x="378" y="5976.4473">netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="378" y="5991.7578">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="394" y="6007.0684">errorCode: &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="394" y="6022.3789">errorDescription: 'Account already processed once'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="6037.6895">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="6053">})</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="257.5" x2="1015" y1="6070.7422" y2="6070.7422"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="371" x="262.5" y="6081.377">[allAccounts[account.id].state == accountPayload.state // allowed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="6106.0078" y2="6106.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="6106.0078" y2="6119.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="6119.0078" y2="6119.0078"/><polygon fill="#A80036" points="362,6115.0078,352,6119.0078,362,6123.0078,358,6119.0078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="6101.2656">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="380" y="6101.2656">All same-state reason insert is allowed (state preserved)</text><path d="M356,6132.0078 L356,6402.0078 L1001,6402.0078 L1001,6142.0078 L991,6132.0078 L356,6132.0078 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M991,6132.0078 L991,6142.0078 L1001,6142.0078 L991,6132.0078 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="362" y="6149.5762">processedAccounts.push(accountPayload.id)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="362" y="6164.8867">participant.accounts.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="378" y="6180.1973">id: accountPayload.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="378" y="6195.5078">state: accountPayload.state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="378" y="6210.8184">reason: accountPayload.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="378" y="6226.1289">createdDate: transactionTimestamp,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482" x="378" y="6241.4395">netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="6256.75">})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="362" y="6272.0605">settlementParticipantCurrencyStateChange.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="436" x="378" y="6287.3711">settlementParticipantCurrencyId: allAccounts[accountPayload.id].key,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="378" y="6302.6816">settlementStateId: accountPayload.state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="378" y="6317.9922">reason: accountPayload.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="6333.3027">})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="362" y="6348.6133">allAccounts[accountPayload.id].reason = accountPayload.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="362" y="6363.9238">allAccounts[accountPayload.id].createdDate = currentTimestamp</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="620" x="362" y="6379.2344">allParticipants[participantPayload.id].accounts[accountPayload.id].reason = accountPayload.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="624" x="362" y="6394.5449">allParticipants[participantPayload.id].accounts[accountPayload.id].createdDate = currentTimestamp</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="257.5" x2="1015" y1="6412.2871" y2="6412.2871"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="616" x="262.5" y="6422.9219">[allAccounts[account.id].state == 'PENDING_SETTLEMENT' &amp;&amp; accountPayload.state == 'SETTLED' // allowed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="6447.5527" y2="6447.5527"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="6447.5527" y2="6460.5527"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="6460.5527" y2="6460.5527"/><polygon fill="#A80036" points="362,6456.5527,352,6460.5527,362,6464.5527,358,6460.5527" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="6442.8105">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="380" y="6442.8105">True settlement acknowledgement</text><path d="M356,6473.5527 L356,6819.5527 L1001,6819.5527 L1001,6483.5527 L991,6473.5527 L356,6473.5527 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M991,6473.5527 L991,6483.5527 L1001,6483.5527 L991,6473.5527 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="362" y="6491.1211">processedAccounts.push(accountPayload.id)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="362" y="6506.4316">participant.accounts.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="378" y="6521.7422">id: accountPayload.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="378" y="6537.0527">state: accountPayload.state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="378" y="6552.3633">reason: accountPayload.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="378" y="6567.6738">createdDate: transactionTimestamp,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482" x="378" y="6582.9844">netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="6598.2949">})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="362" y="6613.6055">settlementParticipantCurrencyStateChange.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="436" x="378" y="6628.916">settlementParticipantCurrencyId: allAccounts[accountPayload.id].key,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="378" y="6644.2266">settlementStateId: accountPayload.state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="378" y="6659.5371">reason: accountPayload.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="6674.8477">})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="362" y="6690.1582">settlementAccounts.pendingSettlementCount--</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="362" y="6705.4688">settlementAccounts.settledCount++</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="382" x="362" y="6720.7793">allAccounts[accountPayload.id].state = accountPayload.state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="362" y="6736.0898">allAccounts[accountPayload.id].reason = accountPayload.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="362" y="6751.4004">allAccounts[accountPayload.id].createdDate = currentTimestamp</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="598" x="362" y="6766.7109">allParticipants[participantPayload.id].accounts[accountPayload.id].state = accountPayload.state</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="620" x="362" y="6782.0215">allParticipants[participantPayload.id].accounts[accountPayload.id].reason = accountPayload.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="624" x="362" y="6797.332">allParticipants[participantPayload.id].accounts[accountPayload.id].createdDate = currentTimestamp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="362" y="6812.6426">let settlementWindowId</text><path d="M346,6836.3848 L420,6836.3848 L420,6843.3848 L410,6853.3848 L346,6853.3848 L346,6836.3848 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="148.4844" style="stroke: #000000; stroke-width: 2.0;" width="510" x="346" y="6836.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="361" y="6849.9531">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="320" x="435" y="6849.0195">[let aw IN accountsWindows[accountPayload.id].windows]</text><path d="M356,6858.6953 L356,6975.6953 L842,6975.6953 L842,6868.6953 L832,6858.6953 L356,6858.6953 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M832,6858.6953 L832,6868.6953 L842,6868.6953 L832,6858.6953 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="465" x="362" y="6876.2637">settlementWindowId = accountsWindows[accountPayload.id].windows[aw]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="362" y="6891.5742">windowsAccounts[settlementWindowId].pendingSettlementCount--</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="362" y="6906.8848">windowsAccounts[settlementWindowId].settledCount++</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="366" y="6922.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="362" y="6937.5059">if (affectedWindows.indexOf(settlementWindowId) &lt; 0) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="378" y="6952.8164">affectedWindows.push(settlementWindowId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="362" y="6968.127">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="257.5" x2="1015" y1="6992.8691" y2="6992.8691"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="7015.1797" y2="7015.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="7015.1797" y2="7028.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="7028.1797" y2="7028.1797"/><polygon fill="#A80036" points="362,7024.1797,352,7028.1797,362,7032.1797,358,7028.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="7010.4375">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="380" y="7010.4375">All other state transitions are not permitted</text><path d="M356,7041.1797 L356,7219.1797 L875,7219.1797 L875,7051.1797 L865,7041.1797 L356,7041.1797 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M865,7041.1797 L865,7051.1797 L875,7051.1797 L865,7041.1797 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="362" y="7058.748">participant.accounts.push({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="378" y="7074.0586">id: accountPayload.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="378" y="7089.3691">state: allAccounts[accountPayload.id].state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="378" y="7104.6797">reason: allAccounts[accountPayload.id].reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="378" y="7119.9902">createdDate: allAccounts[accountPayload.id].createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482" x="378" y="7135.3008">netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="378" y="7150.6113">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="394" y="7165.9219">errorCode: &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="394" y="7181.2324">errorDescription: 'State change not allowed'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="378" y="7196.543">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="362" y="7211.8535">})</text><path d="M247.5,7256.5957 L412.5,7256.5957 L412.5,7263.5957 L402.5,7273.5957 L247.5,7273.5957 L247.5,7256.5957 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1071.8203" style="stroke: #000000; stroke-width: 2.0;" width="1121.5" x="247.5" y="7256.5957"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="262.5" y="7270.1641">DB TRANSACTION</text><path d="M257.5,7280.9063 L670.5,7280.9063 L670.5,7287.9063 L660.5,7297.9063 L257.5,7297.9063 L257.5,7280.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="154.5527" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="257.5" y="7280.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="368" x="272.5" y="7294.4746">Bulk insert settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="822,7330.8379,832,7334.8379,822,7338.8379,826,7334.8379" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="7334.8379" y2="7334.8379"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="7322.4404">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="380" y="7314.7852">Change settlement participant currency states</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="380" y="7330.0957">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="457" y="7330.0957">2001</text><polygon fill="#A80036" points="1186,7360.1484,1196,7364.1484,1186,7368.1484,1190,7364.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="7364.1484" y2="7364.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="851" y="7359.4063">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="873" y="7359.4063">Insert settlementParticipantCurrencyStateChange</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="1067,7407.1484,1339,7407.1484,1349,7418.1484,1339,7430.1484,1067,7430.1484,1057,7418.1484,1067,7407.1484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1069" y="7423.7168">settlementParticipantCurrencyStateChange</text><path d="M257.5,7449.459 L642.5,7449.459 L642.5,7456.459 L632.5,7466.459 L257.5,7466.459 L257.5,7449.459 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="562.9863" style="stroke: #000000; stroke-width: 2.0;" width="1064.5" x="257.5" y="7449.459"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="340" x="272.5" y="7463.0273">Prepare and insert settlementWindowStateChange</text><path d="M356,7471.7695 L356,7557.7695 L668,7557.7695 L668,7481.7695 L658,7471.7695 L356,7471.7695 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M658,7471.7695 L658,7481.7695 L668,7481.7695 L658,7471.7695 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="362" y="7489.3379">let settlementWindowStateChange = []</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="291" x="362" y="7504.6484">let settlementWindows = [] // response object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="362" y="7519.959">let windowAccountsInit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="362" y="7535.2695">let windowAccounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="362" y="7550.5801">let windowState</text><path d="M326,7574.3223 L400,7574.3223 L400,7581.3223 L390,7591.3223 L326,7591.3223 L326,7574.3223 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="293.8809" style="stroke: #000000; stroke-width: 2.0;" width="616" x="326" y="7574.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="341" y="7587.8906">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="156" x="415" y="7586.957">[let aw IN affectedWindows]</text><path d="M356,7596.6328 L356,7636.6328 L791,7636.6328 L791,7606.6328 L781,7596.6328 L356,7596.6328 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M781,7596.6328 L781,7606.6328 L791,7606.6328 L781,7596.6328 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="362" y="7614.2012">windowAccountsInit = windowAccountsInit[affectedWindows[aw]]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="362" y="7629.5117">windowAccounts = windowsAccounts[affectedWindows[aw]]</text><path d="M336,7653.2539 L403,7653.2539 L403,7660.2539 L393,7670.2539 L336,7670.2539 L336,7653.2539 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="207.9492" style="stroke: #000000; stroke-width: 2.0;" width="596" x="336" y="7653.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="351" y="7666.8223">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="509" x="418" y="7665.8887">[windowAccounts.pendingSettlementCount != windowAccountsInit.pendingSettlementCount</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="389" x="418" y="7678.8438">|| windowAccounts.settledCount != windowAccountsInit.settledCount]</text><path d="M346,7688.4746 L413,7688.4746 L413,7695.4746 L403,7705.4746 L346,7705.4746 L346,7688.4746 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="126.418" style="stroke: #000000; stroke-width: 2.0;" width="540" x="346" y="7688.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="361" y="7702.043">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="270" x="428" y="7701.1094">[windowAccounts.pendingSettlementCount == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="238" x="428" y="7714.0645">&amp;&amp; windowAccounts.notSettledCount == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="428" y="7727.0195">&amp;&amp; windowAccounts.settledCound &gt; 0]</text><path d="M356,7734.6504 L356,7805.6504 L872,7805.6504 L872,7744.6504 L862,7734.6504 L356,7734.6504 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M862,7734.6504 L862,7744.6504 L872,7744.6504 L862,7734.6504 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="362" y="7752.2188">allWindows[affectedWindows[aw]].state = 'SETTLED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="495" x="362" y="7767.5293">allWindows[affectedWindows[aw]].reason = 'All setlement accounts are settled'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="423" x="362" y="7782.8398">allWindows[affectedWindows[aw]].createdDate = currentTimestamp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="448" x="362" y="7798.1504">settlementWindowStateChange.push(allWindows[affectedWindows[aw]])</text><path d="M356,7826.8926 L356,7851.8926 L754,7851.8926 L754,7836.8926 L744,7826.8926 L356,7826.8926 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M744,7826.8926 L744,7836.8926 L754,7836.8926 L744,7826.8926 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="362" y="7844.4609">settlementWindows.push(allWindows[affectedWindows[aw]])</text><polygon fill="#A80036" points="822,7907.8242,832,7911.8242,822,7915.8242,826,7911.8242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="7911.8242" y2="7911.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="7899.4268">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="380" y="7891.7715">Change settlement windows states</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="380" y="7907.082">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="457" y="7907.082">2001</text><polygon fill="#A80036" points="1186,7937.1348,1196,7941.1348,1186,7945.1348,1190,7941.1348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="7941.1348" y2="7941.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="851" y="7936.3926">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="873" y="7936.3926">Insert settlementWindowStateChange</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="1104,7984.1348,1302,7984.1348,1312,7995.1348,1302,8007.1348,1104,8007.1348,1094,7995.1348,1104,7984.1348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1106" y="8000.7031">settlementWindowStateChange</text><path d="M257.5,8026.4453 L589.5,8026.4453 L589.5,8033.4453 L579.5,8043.4453 L257.5,8043.4453 L257.5,8026.4453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="294.9707" style="stroke: #000000; stroke-width: 2.0;" width="1039.5" x="257.5" y="8026.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="287" x="272.5" y="8040.0137">Prepare and insert settlementStateChange</text><path d="M346,8050.7559 L413,8050.7559 L413,8057.7559 L403,8067.7559 L346,8067.7559 L346,8050.7559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="126.418" style="stroke: #000000; stroke-width: 2.0;" width="494" x="346" y="8050.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="361" y="8064.3242">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="407" x="428" y="8063.3906">[settlementAccounts.settledCount != settlementAccountsInit.settledCount</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="301" x="428" y="8076.3457">&amp;&amp; settlementAccounts.pendingSettlementCount == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="257" x="428" y="8089.3008">&amp;&amp; settlementAccounts.notSettledCount == 0]</text><path d="M356,8096.9316 L356,8167.9316 L757,8167.9316 L757,8106.9316 L747,8096.9316 L356,8096.9316 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M747,8096.9316 L747,8106.9316 L757,8106.9316 L747,8096.9316 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="362" y="8114.5">settlementData.state = 'SETTLED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="362" y="8129.8105">settlementData.reason = 'All setlement accounts are settled'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="362" y="8145.1211">settlementData.createdDate = currentTimestamp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="362" y="8160.4316">settlementStateChange.push(settlementData)</text><polygon fill="#A80036" points="822,8216.7949,832,8220.7949,822,8224.7949,826,8220.7949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="828" y1="8220.7949" y2="8220.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="8208.3975">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="380" y="8200.7422">Change settlement state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="380" y="8216.0527">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="457" y="8216.0527">2001</text><polygon fill="#A80036" points="1186,8246.1055,1196,8250.1055,1186,8254.1055,1190,8250.1055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="1192" y1="8250.1055" y2="8250.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="851" y="8245.3633">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="873" y="8245.3633">Insert settlementStateChange</text><polygon fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" points="1128,8293.1055,1277,8293.1055,1287,8304.1055,1277,8316.1055,1128,8316.1055,1118,8304.1055,1128,8293.1055" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1130" y="8309.6738">settlementStateChange</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="351" x2="393" y1="8372.0371" y2="8372.0371"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="8372.0371" y2="8385.0371"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="352" x2="393" y1="8385.0371" y2="8385.0371"/><polygon fill="#A80036" points="362,8381.0371,352,8385.0371,362,8389.0371,358,8385.0371" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="358" y="8359.6396">38</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="380" y="8351.9844">Release DB lock</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="489" y="8351.9844">on settlementParticipantCurrencyStateChange,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380" y="8367.2949">settlementWindowStateChange and settlementStateChange</text><path d="M40,8398.0371 L40,9020.0371 L332,9020.0371 L332,8408.0371 L322,8398.0371 L40,8398.0371 " fill="#D3D3D3" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M322,8398.0371 L322,8408.0371 L332,8408.0371 L322,8398.0371 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="46" y="8415.6055">Samples:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="46" y="8430.916">"</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="51" y="8430.916">settlementWindows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="183" y="8430.916">": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="8446.2266">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="78" y="8461.5371">"id": 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="78" y="8476.8477">"state": &lt;enum&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="78" y="8492.1582">"reason": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="78" y="8507.4688">"createdDate": &lt;date&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="8522.7793">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="46" y="8538.0898">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="46" y="8553.4004">"</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="51" y="8553.4004">participants</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="132" y="8553.4004">": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="8568.7109">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="78" y="8584.0215">"id": 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="78" y="8599.332">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="8614.6426">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="110" y="8629.9531">"id": 1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="110" y="8645.2637">"state": "SETTLED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="110" y="8660.5742">"reason": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="110" y="8675.8848">"createdDate": &lt;date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="110" y="8691.1953">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="126" y="8706.5059">"amount": 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="126" y="8721.8164">"currency": &lt;enum&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="8737.127">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="8752.4375">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="8767.748">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="110" y="8783.0586">"id": 2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="110" y="8798.3691">"state": "PENDING_SETTLEMENT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="110" y="8813.6797">"reason": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="110" y="8828.9902">"createdDate": &lt;date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="110" y="8844.3008">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="126" y="8859.6113">"amount": 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="126" y="8874.9219">"currency": &lt;enum&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="110" y="8890.2324">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="110" y="8905.543">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="126" y="8920.8535">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="126" y="8936.1641">"errorDescription": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="8951.4746">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="8966.7852">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="8982.0957">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="8997.4063">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="46" y="9012.7168">]</text><path d="M23,9034.459 L23,9181.459 L332,9181.459 L332,9044.459 L322,9034.459 L23,9034.459 " fill="#FFFFE0" filter="url(#f9nl3glcxqp03)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M322,9034.459 L322,9044.459 L332,9044.459 L322,9034.459 " fill="#FFFFE0" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="29" y="9052.0273">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="37" y="9067.3379">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="45" y="9082.6484">"id": {id},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="45" y="9097.959">"state": settlementData.state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="45" y="9113.2695">"createdDate": settlementData.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="45" y="9128.5801">"settlementWindows": settlementWindows,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="45" y="9143.8906">"participants": participants</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="37" y="9159.2012">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="29" y="9174.5117">]</text><polygon fill="#A80036" points="179,9208.5645,169,9212.5645,179,9216.5645,175,9212.5645" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="173" x2="345" y1="9212.5645" y2="9212.5645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="185" y="9207.8223">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="207" y="9207.8223">Return response</text><!--
@startuml
title 6.2.5. Acknowledgement of Settlement Transfer
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Acknowledgement of Settlement Transfer
    activate OPERATOR
    note right of OPERATOR #yellow
        {
            "participants": [
                {
                    "id": 1
                    "accounts" : [
                        {
                            "id": 1,
                            "state": "PENDING_SETTLEMENT",
                            "reason": <string>
                        },
                        {
                            "id": 2,
                            "state": "SETTLED",
                            "reason": <string>
                        }
                    ]
                },
                {
                    "id": 2
                    "accounts" : [
                        {
                            "id": 3,
                            "state": "NOT_SETTLED",
                            "reason": <string>
                        }
                    ]
                }
            ]
        }
    end note

    OPERATOR -> SSAPI: PUT - /settlement/{id}
    activate SSAPI
    SSAPI -> SETTLE_DAO: Retrive full information for settlement\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Select from DB
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId, ssc.reason, ssc.createdDate
        FROM **settlement** s
        LEFT JOIN **settlementStateChange** ssc
        ON ssc.settlementId = s.settlementId
        AND ssc.settelementStateChangeId = (
            SELECT MAX(ssc1.settelementStateChangeId)
            FROM **settlementStateChange** ssc1
            WHERE ssc1.settlementId = {id})
        WHERE s.settlementId = {id}
    end hnote
    SETTLE_DAO <- - DB: Return data
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlementData**
    deactivate SETTLE_DAO

    SSAPI -> SETTLE_DAO: Retrive full information for settlement accounts\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Select from DB
    activate DB
    hnote over DB #lightyellow
        SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, spcsc.reason,
                spcsc.createdDate, spc.netAmount, pc.currencyId, spc.settlementParticipantCurrencyId AS <color #0000FF>key</color>
        FROM **settlementParticipantCurrency** spc
        JOIN (SELECT spcsc1.settlementParticipantCurrencyId, 
                        MAX(spcsc1.settlementParticipantCurrencyStateChangeId) AS
                        maxSettlementParticipantCurrencyStateChangeId
                FROM **settlementParticipantCurrency** spc1
                JOIN **settlementParticipantCurrencyStateChange** spcsc1
                ON spcsc1.settlementParticipantCurrencyId = spc1.settlementParticipantCurrencyId
                WHERE spc1.settlementId = {id}
                GROUP BY spcsc1.settlementParticipantCurrencyId) spcs
        JOIN **settlementParticipantCurrencyStateChange** spcsc
        ON spcsc.settlementParticipantCurrencyStateChangeId =
            spcs.maxSettlementParticipantCurrencyStateChangeId
        JOIN **participantCurrency** pc
        ON pc.participantCurrencyId = spc.participantCurrencyId
        WHERE spc.settlementId = {id}
    end hnote
    SETTLE_DAO <- - DB: Return data
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlementAccountsList**
    deactivate SETTLE_DAO

    SSAPI -> SETTLE_DAO: Retrive full information for settlement windows\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Select from DB
    activate DB
    hnote over DB #lightyellow
        SELECT ssw.settlementWindowId, sswsc.settlementWindowStateId, sswsc.reason, sswsc.createdDate
        FROM **settlementSettlementWindow** ssw
        JOIN (SELECT sswsc1.settlementWindowId, MAX(sswsc1.settlementWindowStateChangeId) AS
                        maxSettlementWindowStateChangeId
                FROM **settlementSettlementWindowStateChange** sswsc1
                WHERE sswsc1.settlementWindowId IN (
                    SELECT ssw1.settlementWindowId
                    FROM **settlementSettlementWindow** ssw1
                    WHERE ssw1.settlementId = {id})
                GROUP BY sswsc1.settlementWindowId) ssws
        ON ssws.settlementWindowId = ssw.settlementWindowId
        JOIN **settlementSettlementWindowStateChange** sswsc
        ON sswsc.settlementWindowStateChangeId = ssws.maxSettlementWindowStateChangeId
        WHERE ssw.settlementId = {id}
    end hnote
    SETTLE_DAO <- - DB: Return data
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **windowsList**
    deactivate SETTLE_DAO

    SSAPI -> SETTLE_DAO: Retrive full information for settlement windows accounts\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Select from DB
    activate DB
    hnote over DB #lightyellow
        SELECT ssw.settlementWindowId, tp.participantCurrencyId
        FROM **settlementSettlementWindow** ssw
        JOIN **transferFulfilment** tf
        ON tf.settlementWindowId = ssw.settlementWindowId
        JOIN **transferParticipant** tp
        ON tp.transferId = tf.transferId
        WHERE settlementId = {id}
        GROUP BY ssw.settlementWindowId, tp.participantCurrencyId
    end hnote
    SETTLE_DAO <- - DB: Return data
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **windowsAccountsList**
    deactivate SETTLE_DAO

    note right of SSAPI #lightgray
        Available raw datasets from DB:
        **settlementData** contains information about settlement and its current state/reason
        **settlementAccountsList** holds information about all accounts and their current state/reason
        **windowsList** has information about all windows and their current state/reason
        **windowsAccountsList** has information about all accounts and windows

        Local variables and objects:
        **settlementAccounts**: { // (derived from <color 0000FF>settlementAccountsList</color>)
            pendingSettlementCount: <integer>, // count of accounts in PENDING_SETTLEMENT state
            settledCount: <integer>, // count of accounts in SETTLED state
            notSettledCount: <integer> // count of accounts in NOT_SETTLED state
        }
        **settlementAccountsInit** copy of previous object to be preserved for comparission at the end
        //**allParticipants**:// { // same as participants response object with initial data & key (derived from <color 0000FF>settlementAccountsList</color>)
            participantId_key: { // number used to access the object in array-like style
                id: participantId,
                accounts: {
                    participantCurrencyId_key: { // number used to access the object in array-like style
                        id: participantCurrencyId,
                        state: settlementStateId,
                        reason: reason,
                        createdDate: createdDate,
                        netSettlementAmount: {
                            amount: netAmount,
                            currency: currencyId
                        }
                    }
                }
            }
        }
        **allAccounts**: { // same as previous but accessed by account id (derived from <color 0000FF>settlementAccountsList</color>)
            participantCurrencyId_key: { // number used to access the object in array-like style
                id: participantCurrencyId,
                state: settlementStateId,
                reason: reason,
                createdDate: createdDate,
                netSettlementAmount: {
                    amount: netAmount,
                    currency: currencyId
                },
                participantId: participantId, // could be used to reconstruct allParticipants
                key: <color 0000FF>key</color> // will be used to insert new state for settlementParticipantCurrency
            }
        }
        **allWindows**: { // same as settlementWindows response object with initial data (derived from <color 0000FF>windowsList</color>)
            settlementWindowId_key: { // number used to access the object in array-like style
                id: settlementWindowId, // same as key value
                state: settlementWindowStateId, 
                reason: reason, 
                createdDate: createdDate
            }
        }
        **windowsAccounts**: {
            settlementWindowId_key: { // number used to access the object in array-like style
                id: settlementWindowId // same as key value
                pendingSettlementCount: <integer>, // count of accounts in PENDING_SETTLEMENT state
                settledCount: <integer>, // count of accounts in SETTLED state
                notSettledCount: <integer> // count of accounts in NOT_SETTLED state
            }
        }
        **windowsAccountsInit** copy of previous object to be preserved for comparission at the end
        **accountsWindows**: {
            participantCurrencyId_key: { // number used to access the object in array-like style
                id: participantCurrencyId, // same as key value
                windows: [] // array of windows to which the account settlement spans
            }
        }
        let **transactionTimestamp** = now()
    end note
    |||
    SSAPI -> SSAPI: <color FF0000>**Acquire DB lock**</color> on settlementParticipantCurrencyStateChange,\nsettlementWindowStateChange and settlementStateChange
    |||
    SSAPI -> SSAPI: Declare and initialize variables
    note right of SSAPI #lightgray
        let settlementAccounts = {
            pendingSettlementAccounts: 0,
            settledAccounts: 0,
            notSettledAccounts: 0,
        }
        let allParticipants = {} // declare sparse array
        let allAccounts = {} // declare sparse array
        let pid // participantId
        let aid // accountId (participantCurrencyId)
        let state
    end note

    loop settlementAccountsList as record
        SSAPI -> SSAPI: Populate **allAccounts** and **allParticipants**
        note right of SSAPI #lightgray
            pid = record.participantId
            aid = record.participantCurrencyId
            state = record.settlementStateId

            allAccounts[aid] = {
                id: aid,
                state,
                reason: record.reason,
                createDate: record.createdDate,
                netSettlementAmount: {
                    amount: record.netAmount,
                    currency: record.currencyId
                },
                key
            }
            //allParticipants[pid] = allParticipants[pid] ? allParticipants[pid] : {id: pid, accounts: {}}//
            //allParticipants[pid].accounts[aid] = allAccounts[aid]//
        end note

        SSAPI -> SSAPI: Populate **settlementAccounts**
        alt state == 'PENDING_SETTLEMENT'
            note right of SSAPI #lightgray
                settlementAccounts.pendingSettlementCount++
            end note
        else state == 'SETTLED'
            note right of SSAPI #lightgray
                settlementAccounts.settledCount++
            end note
        else state == 'NOT_SETTLED'
            note right of SSAPI #lightgray
                settlementAccounts.notSettledCount++
            end note
        end

        SSAPI -> SSAPI: Make a copy of settlementAccounts
        note right of SSAPI #lightgray
            settlementAccountsInit = Object.assign({}, settlementAccounts)
        end note
    end
    |||
    SSAPI -> SSAPI: Declare and populate **allWindows**
    note right of SSAPI #lightgray
        let allWindows = {} // declare sparse array
        let wid // settlementWindowId
    end note
    loop windowsList as record
        note right of SSAPI #lightgray
            wid = record.settlementWindowId
            state = record.settlementWindowStateId

            allWindows[wid] = {
                id: wid,
                state,
                reason: record.reason,
                createDate: record.createdDate
            }
        end note
    end 
    |||
    SSAPI -> SSAPI: Declare and populate **windowsAccounts** and **windowsAccounts**
    note right of SSAPI #lightgray
        let windowsAccounts = {} // declare sparse array
        let accountsWindows = {} // declare sparse array
    end note
    loop windowsAccountsList as record
        note right of SSAPI #lightgray
            wid = record.settlementWindowId
            aid = record.participantCurrencyId
            state = allAccounts[aid]

            accountsWindows[aid] = accountsWindows[aid] ? accountsWindows[aid] : {
                id: aid,
                windows: []
            }
            accountsWindows[aid].windows.push(wid)

            windowsAccounts[wid] = windowsAccounts[wid] ? windowsAccounts[wid] : {
                id: wid, 
                pendingSettlementCount: 0,
                settledCount: 0,
                notSettledCount: 0
            }
        end note
        alt state == 'PENDING_SETTLEMENT'
            note right of SSAPI #lightgray
                windowsAccounts[wid].pendingSettlementCount++
            end note
        else state == 'SETTLED'
            note right of SSAPI #lightgray
                windowsAccounts[wid].settledCount++
            end note
        else state == 'NOT_SETTLED'
            note right of SSAPI #lightgray
                windowsAccounts[wid].notSettledCount++
            end note
        end
        note right of SSAPI #lightgray
            windowsAccountsInit = Object.assign({}, windowsAccounts)
        end note
    end 
    |||
    note right of SSAPI #lightgray
        Available objects after the setup:
        **settlementAccounts** is used for tracing settlement state and state transition allowance
        **allParticipants** is used for tracing participant/account state and state transition
        **allAccounts** is helper object, same as previous, providing direct access to account by id
        **allWindows** has window information for all windows in the settlement
        **windowsAccounts** is used for tracing settlement window state and state transition allowance
        **accountsWindows** is helper object to show the list of windows to which settlement account spans

        Now we are ready to process the **payload**:
        **participants** = [] // part of the response object that lists the affected participants and respective accounts
        **affectedWindows** = [] // array of the affected windows
        **settlementParticipantCurrencyStateChange** = [] // array to collect inserts to the table
        **processedAccounts** = [] // array to log processed accounts and restrict subsequent processing
        let **pi** // declare participant index
        let **ai** // declare account index
        let **participant** - - declare pointer to current participant in the //response object//
        let **participantPayload** - - declare pointer to current participant in the //payload object//
        let **accountPayload** - - declare pointer to current account in the //payload object//
    end note
    |||
    loop let p IN payload.participants
        SSAPI -> SSAPI: Loop payload for each **participantPayload**
        note right of SSAPI #lightgray
            participantPayload = payload.participants[p]
            participants.push({id: participantPayload.id, accounts: []})
            pi = participants.length - 1
            participant = participants[pi]
        end note

        loop let a IN participantPayload.accounts
            SSAPI -> SSAPI: Loop payload for each **accountPayload**
            note right of SSAPI #lightgray
                accountPayload = participantPayload.accounts[a]
            end note
            alt allAccounts[accountPayload.id] == undefined
                SSAPI -> SSAPI: If the account doesn't match the settlement
                note right of SSAPI #lightgray
                    participant.accounts.push({
                        id: accountPayload.id,
                        errorInformation: {
                            errorCode: <integer>,
                            errorDescription: 'Account not found'
                        }
                    })
                end note
            else processedAccounts.indexOf(accountPayload.id)
                SSAPI -> SSAPI: If the account has been previosly processed (duplicated in the payload)
                note right of SSAPI #lightgray
                    participant.accounts.push({
                        id: accountPayload.id,
                        state: allAccounts[accountPayload.id].state,
                        reason: allAccounts[accountPayload.id].reason,
                        createdDate: allAccounts[accountPayload.id].createdDate,
                        netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
                        errorInformation: {
                            errorCode: <integer>,
                            errorDescription: 'Account already processed once'
                        }
                    })
                end note
            else allAccounts[account.id].state == accountPayload.state // allowed
                SSAPI -> SSAPI: All same-state reason insert is allowed (state preserved)
                note right of SSAPI #lightgray
                    processedAccounts.push(accountPayload.id)
                    participant.accounts.push({
                        id: accountPayload.id,
                        state: accountPayload.state,
                        reason: accountPayload.reason,
                        createdDate: transactionTimestamp,
                        netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
                    })
                    settlementParticipantCurrencyStateChange.push({
                        settlementParticipantCurrencyId: allAccounts[accountPayload.id].key,
                        settlementStateId: accountPayload.state,
                        reason: accountPayload.reason
                    })
                    allAccounts[accountPayload.id].reason = accountPayload.reason
                    allAccounts[accountPayload.id].createdDate = currentTimestamp
                    //allParticipants[participantPayload.id].accounts[accountPayload.id].reason = accountPayload.reason//
                    //allParticipants[participantPayload.id].accounts[accountPayload.id].createdDate = currentTimestamp//
                end note
            else allAccounts[account.id].state == 'PENDING_SETTLEMENT' && accountPayload.state == 'SETTLED' // allowed
                SSAPI -> SSAPI: True settlement acknowledgement
                note right of SSAPI #lightgray
                    processedAccounts.push(accountPayload.id)
                    participant.accounts.push({
                        id: accountPayload.id,
                        state: accountPayload.state,
                        reason: accountPayload.reason,
                        createdDate: transactionTimestamp,
                        netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
                    })
                    settlementParticipantCurrencyStateChange.push({
                        settlementParticipantCurrencyId: allAccounts[accountPayload.id].key,
                        settlementStateId: accountPayload.state,
                        reason: accountPayload.reason
                    })
                    settlementAccounts.pendingSettlementCount- -
                    settlementAccounts.settledCount++
                    allAccounts[accountPayload.id].state = accountPayload.state
                    allAccounts[accountPayload.id].reason = accountPayload.reason
                    allAccounts[accountPayload.id].createdDate = currentTimestamp
                    //allParticipants[participantPayload.id].accounts[accountPayload.id].state = accountPayload.state//
                    //allParticipants[participantPayload.id].accounts[accountPayload.id].reason = accountPayload.reason//
                    //allParticipants[participantPayload.id].accounts[accountPayload.id].createdDate = currentTimestamp//
                    let settlementWindowId
                end note
                loop let aw IN accountsWindows[accountPayload.id].windows
                    note right of SSAPI #lightgray
                        settlementWindowId = accountsWindows[accountPayload.id].windows[aw]
                        windowsAccounts[settlementWindowId].pendingSettlementCount- -
                        windowsAccounts[settlementWindowId].settledCount++

                        if (affectedWindows.indexOf(settlementWindowId) < 0) {
                            affectedWindows.push(settlementWindowId)
                        }
                    end note
                end
            else
                SSAPI -> SSAPI: All other state transitions are not permitted
                note right of SSAPI #lightgray
                    participant.accounts.push({
                        id: accountPayload.id,
                        state: allAccounts[accountPayload.id].state,
                        reason: allAccounts[accountPayload.id].reason,
                        createdDate: allAccounts[accountPayload.id].createdDate,
                        netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
                        errorInformation: {
                            errorCode: <integer>,
                            errorDescription: 'State change not allowed'
                        }
                    })
                end note
            end
        end
    end
    group <color #blue>DB TRANSACTION</color>
        group Bulk insert settlementParticipantCurrencyStateChange
            SSAPI -> SETTLE_DAO: Change settlement participant currency states\n<color #FF0000><b>Error code:</b> 2001</color>
            activate SETTLE_DAO
            SETTLE_DAO -> DB: Insert settlementParticipantCurrencyStateChange
            activate DB
            hnote over DB #lightyellow
                settlementParticipantCurrencyStateChange
            end hnote
            deactivate DB
            deactivate SETTLE_DAO
        end
        group Prepare and insert settlementWindowStateChange
            note right of SSAPI #lightgray
                let settlementWindowStateChange = []
                let settlementWindows = [] // response object
                let windowAccountsInit
                let windowAccounts
                let windowState
            end note

            loop let aw IN affectedWindows
                note right of SSAPI #lightgray
                    windowAccountsInit = windowAccountsInit[affectedWindows[aw]]
                    windowAccounts = windowsAccounts[affectedWindows[aw]]
                end note
                opt windowAccounts.pendingSettlementCount != windowAccountsInit.pendingSettlementCount\n|| windowAccounts.settledCount != windowAccountsInit.settledCount
                    opt windowAccounts.pendingSettlementCount == 0\n&& windowAccounts.notSettledCount == 0\n&& windowAccounts.settledCound > 0
                        note right of SSAPI #lightgray
                            allWindows[affectedWindows[aw]].state = 'SETTLED'
                            allWindows[affectedWindows[aw]].reason = 'All setlement accounts are settled'
                            allWindows[affectedWindows[aw]].createdDate = currentTimestamp
                            settlementWindowStateChange.push(allWindows[affectedWindows[aw]])
                        end note
                    end
                    note right of SSAPI #lightgray
                        settlementWindows.push(allWindows[affectedWindows[aw]])
                    end note
                end
            end

            SSAPI -> SETTLE_DAO: Change settlement windows states\n<color #FF0000><b>Error code:</b> 2001</color>
            activate SETTLE_DAO
            SETTLE_DAO -> DB: Insert settlementWindowStateChange
            activate DB
            hnote over DB #lightyellow
                settlementWindowStateChange
            end hnote
            deactivate DB
            deactivate SETTLE_DAO
        end

        group Prepare and insert settlementStateChange
            opt settlementAccounts.settledCount != settlementAccountsInit.settledCount\n&& settlementAccounts.pendingSettlementCount == 0\n&& settlementAccounts.notSettledCount == 0
                note right of SSAPI #lightgray
                    settlementData.state = 'SETTLED'
                    settlementData.reason = 'All setlement accounts are settled'
                    settlementData.createdDate = currentTimestamp
                    settlementStateChange.push(settlementData)
                end note
            end

            SSAPI -> SETTLE_DAO: Change settlement state\n<color #FF0000><b>Error code:</b> 2001</color>
            activate SETTLE_DAO
            SETTLE_DAO -> DB: Insert settlementStateChange
            activate DB
            hnote over DB #lightyellow
                settlementStateChange
            end hnote
            deactivate DB
            deactivate SETTLE_DAO
        end
    end
    SSAPI -> SSAPI: <color FF0000>**Release DB lock**</color> on settlementParticipantCurrencyStateChange,\nsettlementWindowStateChange and settlementStateChange

    note left of SSAPI #lightgray
        Samples:
        "**settlementWindows**": [
            {
                "id": 0,
                "state": <enum>,
                "reason": <string>,
                "createdDate": <date>
            }
        ]
        "**participants**": [
            {
                "id": 0,
                "accounts": [
                    {
                        "id": 1,
                        "state": "SETTLED",
                        "reason": <string>,
                        "createdDate": <date>,
                        "netSettlementAmount": {
                            "amount": 0,
                            "currency": <enum>
                        }
                    },
                    {
                        "id": 2,
                        "state": "PENDING_SETTLEMENT",
                        "reason": <string>,
                        "createdDate": <date>,
                        "netSettlementAmount": {
                            "amount": 0,
                            "currency": <enum>
                        },
                        "errorInformation": {
                            "errorCode": <integer>,
                            "errorDescription": <string>
                        }
                    }
                ]
            }
        ]
    end note

    note left of SSAPI #lightyellow
        [
          {
            "id": {id},
            "state": settlementData.state,
            "createdDate": settlementData.createdDate,
            "settlementWindows": settlementWindows,
            "participants": participants
          }
        ]
    end note

    SSAPI -> OPERATOR: Return response
    deactivate SSAPI
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>