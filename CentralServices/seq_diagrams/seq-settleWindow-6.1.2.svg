<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1114.8px" preserveAspectRatio="none" style="width:919px;height:1114px;" version="1.1" viewBox="0 0 919 1114" width="919.8px" zoomAndPan="magnify"><defs><filter height="300%" id="f1gcl2aedoy6b0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.2000000476837158"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.4000000953674316" dy="2.4000000953674316" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="8.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157.8" x="381.6" y="14.1211">Request to Close SettlementWindow</text><rect fill="#FFB6C1" height="1087.602" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="67.2" x="154.8" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48.6" x="164.1" y="28.234">Central HUB</text><rect fill="#90EE90" height="1087.602" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="350.1" x="287.1" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="424.95" y="28.234">Settlement Service</text><rect fill="#FFFFE0" height="1087.602" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="68.4" x="764.4" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="766.2" y="28.234">Central Services</text><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="948.6434" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="185.4" y="88.3723"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="707.6754" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="166.7039"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="136.077" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="900.9387"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="716.6485" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="597.6" y="184.2902"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="795.6" y="240.0492"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="795.6" y="367.5399"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="795.6" y="511.0442"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="953.6297" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="905.4" x="7.8" y="92.5723"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="848.5254" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="893.4" x="13.8" y="193.4766"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="553.2258" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="346.8" x="554.4" y="208.0629"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="231" x="560.4" y="314.9672"/><rect fill="#FFFFFF" height="162.6363" style="stroke: none; stroke-width: 0.6000000238418579;" width="893.4" x="13.8" y="879.3657"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="188.4" x2="188.4" y1="82.3723" y2="1056.402"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="336.3" x2="336.3" y1="82.3723" y2="1056.402"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="600.6" x2="600.6" y1="82.3723" y2="1056.402"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="798.6" x2="798.6" y1="82.3723" y2="1056.402"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="157.2" y="80.6004">Hub Employee</text><ellipse cx="188.4" cy="38.2793" fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M188.4,43.0793 L188.4,59.2793 M180.6,47.8793 L196.2,47.8793 M188.4,59.2793 L180.6,68.2793 M188.4,59.2793 L196.2,68.2793 " fill="none" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="157.2" y="1063.9231">Hub Employee</text><ellipse cx="188.4" cy="1071.695" fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M188.4,1076.495 L188.4,1092.695 M180.6,1081.295 L196.2,1081.295 M188.4,1092.695 L180.6,1101.695 M188.4,1092.695 L196.2,1101.695 " fill="none" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="289.5" y="80.6004">Settlement Service API</text><path d="M324.3,55.6793 L324.3,70.0793 M324.3,62.8793 L334.5,62.8793 " fill="none" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="341.7" cy="62.8793" fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="289.5" y="1063.9231">Settlement Service API</text><path d="M324.3,1068.095 L324.3,1082.495 M324.3,1075.295 L334.5,1075.295 " fill="none" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="341.7" cy="1075.295" fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="566.4" y="80.6004">Settlement DAO</text><ellipse cx="600.6" cy="62.8793" fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="593.4" x2="607.8" y1="71.2793" y2="71.2793"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="566.4" y="1063.9231">Settlement DAO</text><ellipse cx="600.6" cy="1075.295" fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="593.4" x2="607.8" y1="1083.695" y2="1083.695"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="769.8" y="80.6004">Central Store</text><path d="M787.8,50.8793 C787.8,44.8793 798.6,44.8793 798.6,44.8793 C798.6,44.8793 809.4,44.8793 809.4,50.8793 L809.4,66.4793 C809.4,72.4793 798.6,72.4793 798.6,72.4793 C798.6,72.4793 787.8,72.4793 787.8,66.4793 L787.8,50.8793 " fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M787.8,50.8793 C787.8,56.8793 798.6,56.8793 798.6,56.8793 C798.6,56.8793 809.4,56.8793 809.4,50.8793 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="769.8" y="1063.9231">Central Store</text><path d="M787.8,1071.695 C787.8,1065.695 798.6,1065.695 798.6,1065.695 C798.6,1065.695 809.4,1065.695 809.4,1071.695 L809.4,1087.295 C809.4,1093.295 798.6,1093.295 798.6,1093.295 C798.6,1093.295 787.8,1093.295 787.8,1087.295 L787.8,1071.695 " fill="#FEFECE" filter="url(#f1gcl2aedoy6b0)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M787.8,1071.695 C787.8,1077.695 798.6,1077.695 798.6,1077.695 C798.6,1077.695 809.4,1077.695 809.4,1071.695 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="948.6434" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="185.4" y="88.3723"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="707.6754" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="166.7039"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="136.077" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="900.9387"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="716.6485" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="597.6" y="184.2902"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="795.6" y="240.0492"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="795.6" y="367.5399"/><rect fill="#FFFFFF" filter="url(#f1gcl2aedoy6b0)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="795.6" y="511.0442"/><path d="M7.8,92.5723 L189.6,92.5723 L189.6,96.7723 L183.6,102.7723 L7.8,102.7723 L7.8,92.5723 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="953.6297" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="905.4" x="7.8" y="92.5723"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154.8" x="16.8" y="100.7133">Request closure of Settlement Window</text><path d="M194.4,105.9586 L194.4,148.5586 L340.2,148.5586 L340.2,111.9586 L334.2,105.9586 L194.4,105.9586 " fill="#FFFF00" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M334.2,105.9586 L334.2,111.9586 L340.2,111.9586 L334.2,105.9586 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="198" y="116.4996">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="62.4" x="202.8" y="125.6859">"state": "closed",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="128.4" x="202.8" y="134.8723">"reason": "motivation for closure."</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="198" y="144.0586">}</text><polygon fill="#A80036" points="326.4,164.3039,332.4,166.7039,326.4,169.1039,328.8,166.7039" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="191.4" x2="330" y1="166.7039" y2="166.7039"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="195.6" y="164.0449">1</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="123" x="203.4" y="164.0449">POST - /settlementWindows/{id}</text><polygon fill="#A80036" points="590.4,181.8902,596.4,184.2902,590.4,186.6902,592.8,184.2902" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="339.6" x2="594" y1="184.2902" y2="184.2902"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="343.8" y="181.6313">2</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="238.8" x="351.6" y="181.6313">Close settlementWindow&lt;id&gt; and open new settlementWindow</text><path d="M13.8,193.4766 L51,193.4766 L51,197.6766 L45,203.6766 L13.8,203.6766 L13.8,193.4766 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="848.5254" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="893.4" x="13.8" y="193.4766"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.2" x="22.8" y="201.6176">alt</text><path d="M554.4,208.0629 L653.4,208.0629 L653.4,212.2629 L647.4,218.2629 L554.4,218.2629 L554.4,208.0629 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="553.2258" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="346.8" x="554.4" y="208.0629"/><text fill="#0000FF" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="563.4" y="216.2039">DB TRANSACTION</text><polygon fill="#A80036" points="788.4,237.6492,794.4,240.0492,788.4,242.4492,790.8,240.0492" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="603.6" x2="792" y1="240.0492" y2="240.0492"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="607.8" y="232.9834">3</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="151.8" x="615.6" y="228.3902">Get state for settlementWindow from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="615.6" y="237.5766">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="661.8" y="237.5766">2001</text><polygon fill="#FFFFE0" filter="url(#f1gcl2aedoy6b0)" points="734.4,266.2219,862.8,266.2219,868.8,286.6219,862.8,307.6219,734.4,307.6219,728.4,286.6219,734.4,266.2219" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="735.6" y="276.1629">GET</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="735.6" y="285.3492">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="99.6" x="745.2" y="294.5356">settlementWindowId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="18.6" x="745.2" y="303.7219">state</text><path d="M560.4,314.9672 L676.2,314.9672 L676.2,319.1672 L670.2,325.1672 L560.4,325.1672 L560.4,314.9672 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="231" x="560.4" y="314.9672"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88.8" x="569.4" y="323.1082">Validate window state</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="603.6" x2="628.8" y1="338.1399" y2="338.1399"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="628.8" x2="628.8" y1="338.1399" y2="345.9399"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="604.2" x2="628.8" y1="345.9399" y2="345.9399"/><polygon fill="#A80036" points="610.2,343.5399,604.2,345.9399,610.2,348.3399,607.8,345.9399" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="607.8" y="335.2945">4</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="168.6" x="615.6" y="335.2945">Validate settlementWindowStateId == 'OPEN'</text><polygon fill="#A80036" points="788.4,365.1399,794.4,367.5399,788.4,369.9399,790.8,367.5399" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="603.6" x2="792" y1="367.5399" y2="367.5399"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="607.8" y="364.8809">5</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="169.8" x="615.6" y="364.8809">Insert settlementWindowStateId == 'CLOSED'</text><path d="M702,393.5262 L702,408.5262 L892.8,408.5262 L892.8,399.5262 L886.8,393.5262 L702,393.5262 " fill="#FFB6C1" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M886.8,393.5262 L886.8,399.5262 L892.8,399.5262 L886.8,393.5262 " fill="#FFB6C1" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="18" x="705.6" y="404.0672">Lock</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="726" y="404.0672">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="29.4" x="854.4" y="404.0672">for read</text><polygon fill="#FFFFE0" filter="url(#f1gcl2aedoy6b0)" points="734.4,417.1125,862.8,417.1125,868.8,442.3125,862.8,467.5125,734.4,467.5125,728.4,442.3125,734.4,417.1125" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="26.4" x="735.6" y="427.0535">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="735.6" y="436.2399">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="99.6" x="735.6" y="445.4262">settlementWindowId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="18.6" x="735.6" y="454.6125">state</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="735.6" y="463.7988">reason</text><polygon fill="#A80036" points="788.4,508.6442,794.4,511.0442,788.4,513.4442,790.8,511.0442" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="603.6" x2="792" y1="511.0442" y2="511.0442"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="607.8" y="494.5647">6</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="113.4" x="615.6" y="480.7852">Create new settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="618" y="489.9715">state == 'open'</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="148.8" x="618" y="499.1578">reason == 'motivation for new Window'</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="615.6" y="508.3442">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="661.8" y="508.3442">2001</text><polygon fill="#FFFFE0" filter="url(#f1gcl2aedoy6b0)" points="734.4,536.9895,862.8,536.9895,868.8,635.3895,862.8,734.3895,734.4,734.3895,728.4,635.3895,734.4,536.9895" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="26.4" x="735.6" y="546.9305">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="735.6" y="556.1168">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="745.2" y="565.3031">reason</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="574.4895"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="735.6" y="583.6758">GET</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="735.6" y="592.8621">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="52.2" x="745.2" y="602.0485">{new id}    "id"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="93.6" x="745.2" y="611.2348">createdDate "createDate"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="620.4211"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="26.4" x="735.6" y="629.6074">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="735.6" y="638.7938">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="29.4" x="745.2" y="647.9801">{new id}</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="18.6" x="745.2" y="657.1664">state</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="745.2" y="666.3528">reason</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="675.5391"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="735.6" y="684.7254">GET</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="735.6" y="693.9117">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="29.4" x="745.2" y="703.0981">{new id}</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="50.4" x="745.2" y="712.2844">state   "state"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="61.2" x="745.2" y="721.4707">reason  "reason"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="97.8" x="745.2" y="730.6571">createdDate "changeDate"</text><path d="M713.4,740.7024 L713.4,755.7024 L880.8,755.7024 L880.8,746.7024 L874.8,740.7024 L713.4,740.7024 " fill="#FFB6C1" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M874.8,740.7024 L874.8,746.7024 L880.8,746.7024 L874.8,740.7024 " fill="#FFB6C1" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="26.4" x="717" y="751.2434">Unlock</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="745.8" y="751.2434">settlementWindowStateChange</text><polygon fill="#A80036" points="346.2,775.6887,340.2,778.0887,346.2,780.4887,343.8,778.0887" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="342.6" x2="798" y1="778.0887" y2="778.0887"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="349.8" y="775.4297">7</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="128.4" x="357.6" y="775.4297">Operation successfully completed</text><path d="M222.6,786.075 L222.6,856.275 L328.2,856.275 L328.2,792.075 L322.2,786.075 L222.6,786.075 " fill="#FFFF00" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M322.2,786.075 L322.2,792.075 L328.2,792.075 L322.2,786.075 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="226.2" y="796.616">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="231" y="805.8024">"id": 0,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="66.6" x="231" y="814.9887">"reason": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="60" x="231" y="824.175">"state": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="231" y="833.3614">"createdDate": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="88.2" x="231" y="842.5477">"changedDate": "string"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="226.2" y="851.734">}</text><polygon fill="#A80036" points="198,871.9793,192,874.3793,198,876.7793,195.6,874.3793" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="194.4" x2="336" y1="874.3793" y2="874.3793"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="201.6" y="871.7203">8</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="209.4" y="871.7203">Return results</text><line style="stroke: #000000; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="13.8" x2="907.2" y1="879.9657" y2="879.9657"/><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="16.8" y="886.3465">[</text><text fill="#FF0000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="19.2" y="886.3465">settlementWindow not found or settlementWindow state 'open'</text><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="229.2" y="886.3465">]</text><polygon fill="#A80036" points="346.2,898.5387,340.2,900.9387,346.2,903.3387,343.8,900.9387" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="342.6" x2="600" y1="900.9387" y2="900.9387"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="349.8" y="898.2797">9</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="168.6" x="357.6" y="898.2797">settlementWindow not found - return ERROR</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="339.6" x2="364.8" y1="918.7114" y2="918.7114"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="364.8" x2="364.8" y1="918.7114" y2="926.5114"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="340.2" x2="364.8" y1="926.5114" y2="926.5114"/><polygon fill="#A80036" points="346.2,924.1114,340.2,926.5114,346.2,928.9114,343.8,926.5114" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="343.8" y="915.8661">10</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="63.6" x="357" y="915.8661">Update Event log</text><path d="M342.6,934.3114 L342.6,958.3114 L466.8,958.3114 L466.8,940.3114 L460.8,934.3114 L342.6,934.3114 " fill="#ADD8E6" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M460.8,934.3114 L460.8,940.3114 L466.8,940.3114 L460.8,934.3114 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="82.2" x="346.2" y="944.8524">Log ERROR Messages.</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="346.2" y="954.0387">Update Event log with ERROR.</text><path d="M19.8,967.084 L19.8,1018.684 L328.2,1018.684 L328.2,973.084 L322.2,967.084 L19.8,967.084 " fill="#FFFF00" filter="url(#f1gcl2aedoy6b0)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M322.2,967.084 L322.2,973.084 L328.2,973.084 L322.2,967.084 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="23.4" y="977.625">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="41.4" x="28.2" y="986.8114">"status": 0,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="281.4" x="37.8" y="995.9977">"code": "(ERROR response code eg. '404' - Defined in swagger definition))",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="72" x="37.8" y="1005.184">"message": "string"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="23.4" y="1014.3704">}</text><polygon fill="#A80036" points="195,1034.6157,189,1037.0157,195,1039.4157,192.6,1037.0157" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="191.4" x2="336" y1="1037.0157" y2="1037.0157"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="198.6" y="1034.3567">11</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="51.6" x="211.8" y="1034.3567">Return ERROR</text><!--
@startuml
title Request to Close SettlementWindow

autonumber

actor "Hub Employee" as OPERATOR

boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO

database "Central Store" as DB

box "Central HUB" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #LightYellow
    participant DB
end box

group Request closure of Settlement Window
    activate OPERATOR
    note right of OPERATOR #Yellow
        {
          "state": "closed",
          "reason": "motivation for closure."
        }
    end note
    OPERATOR -> SSAPI: POST - /settlementWindows/{id}
    activate SSAPI
    SSAPI -> SETTLE_DAO: Close settlementWindow<id> and open new settlementWindow
    activate SETTLE_DAO
    alt
        group <color #blue>DB TRANSACTION</color>
            SETTLE_DAO -> DB: Get state for settlementWindow from DB \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
            hnote over DB #LightYellow
                GET
                **settlementWindowStateChange**
                    settlementWindowId = {id}
                    state
            end hnote
            deactivate DB
            group Validate window state
                SETTLE_DAO <- -> SETTLE_DAO: Validate settlementWindowStateId == 'OPEN'
            end
            SETTLE_DAO -> DB: Insert settlementWindowStateId == 'CLOSED'
            note over DB #Lightpink
                Lock **settlementWindowStateChange** for read
            end note
            activate DB
            hnote over DB #LightYellow
                INSERT
                **settlementWindowStateChange**
                settlementWindowId = {id}
                state
                reason
            end hnote
            deactivate DB
            SETTLE_DAO -> DB: Create new settlementWindow \n state == 'open'\n reason == 'motivation for new Window' \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
            hnote over DB #LightYellow
                INSERT
                **settlementWindow**
                    reason

                GET
                **settlementWindow**
                    {new id}    "id"
                    createdDate "createDate"

                INSERT
                **settlementWindowStateChange**
                    {new id}
                    state
                    reason

                GET
                **settlementWindowStateChange**
                    {new id}
                    state   "state"
                    reason  "reason"
                    createdDate "changeDate"
            end hnote
            deactivate DB
            note over DB #Lightpink
            Unlock **settlementWindowStateChange**
            end note
        end
        SSAPI <- - DB: Operation successfully completed
        note left of SSAPI #Yellow
        {
          "id": 0,
          "reason": "string",
          "state": "string",
          "createdDate": "string",
          "changedDate": "string"
        }
        end note
        OPERATOR <- - SSAPI: Return results
        deactivate SSAPI
    else <color #FF0000><b>settlementWindow not found or settlementWindow state 'open'</b></color>

        SSAPI <- - SETTLE_DAO: settlementWindow not found - return ERROR
        deactivate SETTLE_DAO
        activate SSAPI
        SSAPI - -> SSAPI: Update Event log
        note right of SSAPI #LightBlue
        Log ERROR Messages.
        Update Event log with ERROR.
        end note
        note left of SSAPI #Yellow
        {
          "status": 0,
              "code": "(ERROR response code eg. '404' - Defined in swagger definition))",
              "message": "string"
        }
        end note
        OPERATOR <- - SSAPI: Return ERROR
        deactivate SSAPI
        deactivate OPERATOR
    end
end
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>