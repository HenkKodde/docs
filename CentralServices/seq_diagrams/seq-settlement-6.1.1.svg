<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="445.8px" preserveAspectRatio="none" style="width:882px;height:445px;" version="1.1" viewBox="0 0 882 445" width="882.6px" zoomAndPan="magnify"><defs><filter height="300%" id="fmflftz0ekafy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.2000000476837158"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.4000000953674316" dy="2.4000000953674316" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="8.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149.4" x="367.2" y="14.1211">6.1.1. Creation of Settlement Event</text><rect fill="#FFB6C1" height="419.0988" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="73.2" x="11.4" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51.6" x="22.2" y="28.234">Central Bank</text><rect fill="#90EE90" height="419.0988" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="363.9" x="85.8" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="230.55" y="28.234">Settlement Service</text><rect fill="#FFFFE0" height="419.0988" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="267.6" x="450.9" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="552.3" y="28.234">Central Services</text><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="293.5266" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="418.5" y="88.3723"/><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="285.1266" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="868.2" x="7.8" y="92.5723"/><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="64.3453" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="344.4" x="383.7" y="152.1176"/><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="27.9727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="332.4" x="389.7" y="184.2902"/><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="27.9727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="270.9" x="182.4" y="224.8629"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="48" x2="48" y1="82.3723" y2="387.8988"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="135" x2="135" y1="82.3723" y2="387.8988"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="229.2" x2="229.2" y1="82.3723" y2="387.8988"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="421.5" x2="421.5" y1="82.3723" y2="387.8988"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="493.5" x2="493.5" y1="82.3723" y2="387.8988"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="573.9" x2="573.9" y1="82.3723" y2="387.8988"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="687.3" x2="687.3" y1="82.3723" y2="387.8988"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="13.8" y="80.6004">Hub Operations</text><ellipse cx="48" cy="38.2793" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M48,43.0793 L48,59.2793 M40.2,47.8793 L55.8,47.8793 M48,59.2793 L40.2,68.2793 M48,59.2793 L55.8,68.2793 " fill="none" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="13.8" y="395.4199">Hub Operations</text><ellipse cx="48" cy="403.1918" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M48,407.9918 L48,424.1918 M40.2,412.7918 L55.8,412.7918 M48,424.1918 L40.2,433.1918 M48,424.1918 L55.8,433.1918 " fill="none" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="88.2" y="80.6004">Settlement Service API</text><path d="M123,55.6793 L123,70.0793 M123,62.8793 L133.2,62.8793 " fill="none" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="140.4" cy="62.8793" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="88.2" y="395.4199">Settlement Service API</text><path d="M123,399.5918 L123,413.9918 M123,406.7918 L133.2,406.7918 " fill="none" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="140.4" cy="406.7918" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="188.4" y="80.6004">Settlement Window</text><ellipse cx="229.5" cy="62.8793" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="227.1,55.6793,230.7,52.6793,229.5,55.6793,230.7,58.6793,227.1,55.6793" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="188.4" y="395.4199">Settlement Window</text><ellipse cx="229.5" cy="406.7918" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="227.1,399.5918,230.7,396.5918,229.5,399.5918,230.7,402.5918,227.1,399.5918" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="48" x="395.7" y="80.6004">Settlements</text><ellipse cx="421.5" cy="62.8793" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="419.1,55.6793,422.7,52.6793,421.5,55.6793,422.7,58.6793,419.1,55.6793" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="48" x="395.7" y="395.4199">Settlements</text><ellipse cx="421.5" cy="406.7918" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="419.1,399.5918,422.7,396.5918,421.5,399.5918,422.7,402.5918,419.1,399.5918" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="76.8" x="453.3" y="80.6004">Central Service API</text><path d="M481.2,55.6793 L481.2,70.0793 M481.2,62.8793 L491.4,62.8793 " fill="none" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="498.6" cy="62.8793" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="76.8" x="453.3" y="395.4199">Central Service API</text><path d="M481.2,399.5918 L481.2,413.9918 M481.2,406.7918 L491.4,406.7918 " fill="none" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="498.6" cy="406.7918" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="539.7" y="80.6004">Participant DAO</text><ellipse cx="573.9" cy="62.8793" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="566.7" x2="581.1" y1="71.2793" y2="71.2793"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="539.7" y="395.4199">Participant DAO</text><ellipse cx="573.9" cy="406.7918" fill="#FEFECE" filter="url(#fmflftz0ekafy)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="566.7" x2="581.1" y1="415.1918" y2="415.1918"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="658.5" y="80.6004">Central Store</text><path d="M676.5,50.8793 C676.5,44.8793 687.3,44.8793 687.3,44.8793 C687.3,44.8793 698.1,44.8793 698.1,50.8793 L698.1,66.4793 C698.1,72.4793 687.3,72.4793 687.3,72.4793 C687.3,72.4793 676.5,72.4793 676.5,66.4793 L676.5,50.8793 " fill="#FEFECE" filter="url(#fmflftz0ekafy)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M676.5,50.8793 C676.5,56.8793 687.3,56.8793 687.3,56.8793 C687.3,56.8793 698.1,56.8793 698.1,50.8793 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="658.5" y="395.4199">Central Store</text><path d="M676.5,403.1918 C676.5,397.1918 687.3,397.1918 687.3,397.1918 C687.3,397.1918 698.1,397.1918 698.1,403.1918 L698.1,418.7918 C698.1,424.7918 687.3,424.7918 687.3,424.7918 C687.3,424.7918 676.5,424.7918 676.5,418.7918 L676.5,403.1918 " fill="#FEFECE" filter="url(#fmflftz0ekafy)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M676.5,403.1918 C676.5,409.1918 687.3,409.1918 687.3,409.1918 C687.3,409.1918 698.1,409.1918 698.1,403.1918 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="293.5266" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="418.5" y="88.3723"/><path d="M7.8,92.5723 L196.2,92.5723 L196.2,96.7723 L190.2,102.7723 L7.8,102.7723 L7.8,92.5723 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="285.1266" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="868.2" x="7.8" y="92.5723"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161.4" x="16.8" y="100.7133">Settlement Trigger received from "HUB"</text><polygon fill="#A80036" points="411.3,113.1586,417.3,115.5586,411.3,117.9586,413.7,115.5586" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="48" x2="414.9" y1="115.5586" y2="115.5586"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="52.2" y="112.8996">1</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="60" y="112.8996">Settlement event trigger</text><rect fill="#FFFFFF" filter="url(#fmflftz0ekafy)" height="24.3727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="528.9" x="186.6" y="120.5449"/><polygon fill="#EEEEEE" points="186.6,120.5449,225,120.5449,225,124.7449,219,130.7449,186.6,130.7449,186.6,120.5449" style="stroke: #000000; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="11.4" x="194.4" y="129.2859">ref</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="249" x="327.75" y="140.6859">SETTLEMENT &lt;--&gt; DB: Get open settlementWindow as per {6.1.2}.</text><path d="M383.7,152.1176 L433.5,152.1176 L433.5,156.3176 L427.5,162.3176 L383.7,162.3176 L383.7,152.1176 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="64.3453" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="344.4" x="383.7" y="152.1176"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22.8" x="392.7" y="160.2586">Event</text><polygon fill="#A80036" points="431.1,172.7039,425.1,175.1039,431.1,177.5039,428.7,175.1039" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><polygon fill="#A80036" points="680.1,172.7039,686.1,175.1039,680.1,177.5039,682.5,175.1039" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="427.5" x2="683.7" y1="175.1039" y2="175.1039"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="434.7" y="172.4449">2</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="183" x="442.5" y="172.4449">Assign Settlement to settlementWindow Rule: ???</text><path d="M389.7,184.2902 L449.7,184.2902 L449.7,188.4902 L443.7,194.4902 L389.7,194.4902 L389.7,184.2902 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="27.9727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="332.4" x="389.7" y="184.2902"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="398.7" y="192.4313">Validate</text><polygon fill="#A80036" points="431.1,204.8766,425.1,207.2766,431.1,209.6766,428.7,207.2766" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><polygon fill="#A80036" points="680.1,204.8766,686.1,207.2766,680.1,209.6766,682.5,207.2766" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="427.5" x2="683.7" y1="207.2766" y2="207.2766"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="434.7" y="204.6176">3</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="240.6" x="442.5" y="204.6176">Assign Settlement are not already asigned to settlementWindow</text><path d="M182.4,224.8629 L387,224.8629 L387,229.0629 L381,235.0629 L182.4,235.0629 L182.4,224.8629 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="27.9727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="270.9" x="182.4" y="224.8629"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177.6" x="191.4" y="233.0039">Process settlementWindow and associations</text><polygon fill="#A80036" points="236.1,245.4492,230.1,247.8492,236.1,250.2492,233.7,247.8492" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><polygon fill="#A80036" points="411.3,245.4492,417.3,247.8492,411.3,250.2492,413.7,247.8492" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="232.5" x2="414.9" y1="247.8492" y2="247.8492"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="239.7" y="245.1902">4</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="166.8" x="247.5" y="245.1902">- Allocate settlement to settlementWindows</text><path d="M427.2,260.0356 L427.2,320.6356 L867.6,320.6356 L867.6,266.0356 L861.6,260.0356 L427.2,260.0356 " fill="#ADD8E6" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M861.6,260.0356 L861.6,266.0356 L867.6,266.0356 L861.6,260.0356 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="148.2" x="430.8" y="270.5766">Create settlement in settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="433.2" y="279.7629"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="190.8" x="430.8" y="288.9492">Cross reference for associated settlementWindows</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="427.8" x="430.8" y="298.1356">Calculate the net settlement amount for all participants with pending transfers(settlements) in settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="433.2" y="307.3219"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="237" x="430.8" y="316.5082">Return dataset - the net settlements for the settlementWindow</text><path d="M427.2,329.5535 L427.2,372.1535 L637.2,372.1535 L637.2,335.5535 L631.2,329.5535 L427.2,329.5535 " fill="#ADD8E6" filter="url(#fmflftz0ekafy)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M631.2,329.5535 L631.2,335.5535 L637.2,335.5535 L631.2,329.5535 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="430.8" y="340.0945">Create settlement in settlementWindow ERROR</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="433.2" y="349.2809"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="197.4" x="430.8" y="358.4672">settlementWindows already in process - not 'closed'</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="151.8" x="430.8" y="367.6535">no settlement for the settlementWindow</text><!--
@startuml
title 6.1.1. Creation of Settlement Event

autonumber



actor "Hub Operations" as OPERATOR

boundary "Settlement Service API" as SSAPI
control "Settlements" as SETTLEMENT
control "Settlement Window" as SETTLEWINDOW

boundary "Central Service API" as CSAPI
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Bank" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLEWINDOW
    participant SETTLEMENT
end box

box "Central Services" #LightYellow
    participant CSAPI
    participant PARTICIPANT_DAO
    participant DB
end box

activate SETTLEMENT

group Settlement Trigger received from "HUB"
    OPERATOR -> SETTLEMENT: Settlement event trigger
    ref over SETTLEWINDOW, DB
    SETTLEMENT <- -> DB: Get open settlementWindow as per {6.1.2}.
    end

    group Event
        SETTLEMENT <- -> DB: Assign Settlement to settlementWindow Rule: ???
        group Validate
            SETTLEMENT <- -> DB: Assign Settlement are not already asigned to settlementWindow
        end
    end

    group Process settlementWindow and associations
    SETTLEWINDOW <- -> SETTLEMENT: - Allocate settlement to settlementWindows
    end
    note right of SETTLEMENT #lightblue
        Create settlement in settlementWindow

        Cross reference for associated settlementWindows
        Calculate the net settlement amount for all participants with pending transfers(settlements) in settlementWindow

        Return dataset - the net settlements for the settlementWindow
    end note
    note right of SETTLEMENT #lightblue
        Create settlement in settlementWindow ERROR

        settlementWindows already in process - not 'closed'
        no settlement for the settlementWindow
    end note

end
deactivate SETTLEMENT
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>