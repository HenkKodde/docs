<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="948.8px" preserveAspectRatio="none" style="width:1080px;height:948px;" version="1.1" viewBox="0 0 1080 948" width="1080px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xa4fhpjey3kn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235.2" x="423.4" y="18.8281">5.1.1. Notification Handler for Rejections</text><rect fill="#D3D3D3" height="912.8156" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="148.8" x="3.2" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="5.6" y="37.6453">Financial Service Providers</text><rect fill="#ADD8E6" height="912.8156" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="192.8" x="224" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125.6" x="257.6" y="37.6453">ML API Adapter Service</text><rect fill="#FFFFE0" height="912.8156" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="239.2" x="827.6" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80.8" x="906.8" y="37.6453">Central Service</text><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="719.8047" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="316.4" y="131.0203"/><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1000.8" y="179.2688"/><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="707.8047" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1029.6" x="42" y="136.6203"/><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="555.1141" style="stroke: #000000; stroke-width: 1.600000023841858;" width="896" x="50" y="283.7109"/><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="665.2" x="219.2" y="303.1594"/><rect fill="#FFFFFF" height="197.0969" style="stroke: none; stroke-width: 0.800000011920929;" width="896" x="50" y="641.7281"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="77.2" x2="77.2" y1="123.0203" y2="858.025"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="320" x2="320" y1="123.0203" y2="858.025"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="884.4" x2="884.4" y1="123.0203" y2="858.025"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1004.4" x2="1004.4" y1="123.0203" y2="858.025"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="34.4" x="58" y="107.4672">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="29.6" x="60.4" y="120.6578">Payer</text><ellipse cx="77.6" cy="51.0391" fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" rx="6.4" ry="6.4" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><path d="M77.6,57.4391 L77.6,79.0391 M67.2,63.8391 L88,63.8391 M77.6,79.0391 L67.2,91.0391 M77.6,79.0391 L88,91.0391 " fill="none" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="34.4" x="58" y="868.0531">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="29.6" x="60.4" y="881.2438">Payer</text><ellipse cx="77.6" cy="891.6063" fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" rx="6.4" ry="6.4" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><path d="M77.6,898.0063 L77.6,919.6063 M67.2,904.4063 L88,904.4063 M77.6,919.6063 L67.2,931.6063 M77.6,919.6063 L88,931.6063 " fill="none" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="181.6" x="227.2" y="120.6578">ML API Notification Event Handler</text><ellipse cx="320.4" cy="97.0297" fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="317.2,87.4297,322,83.4297,320.4,87.4297,322,91.4297,317.2,87.4297" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="181.6" x="227.2" y="868.0531">ML API Notification Event Handler</text><ellipse cx="320.4" cy="883.2156" fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="317.2,873.6156,322,869.6156,320.4,873.6156,322,877.6156,317.2,873.6156" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="102.4" x="830.8" y="120.6578">Central Service API</text><path d="M868,87.4297 L868,106.6297 M868,97.0297 L881.6,97.0297 " fill="none" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="891.2" cy="97.0297" fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="102.4" x="830.8" y="868.0531">Central Service API</text><path d="M868,873.6156 L868,892.8156 M868,883.2156 L881.6,883.2156 " fill="none" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="891.2" cy="883.2156" fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><rect fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="949.2" y="91.4297"/><rect fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="946" y="94.6297"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="951.6" y="111.0578">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="949.2" y="857.225"/><rect fill="#FEFECE" filter="url(#f1xa4fhpjey3kn)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="946" y="860.425"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="951.6" y="876.8531">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="719.8047" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="316.4" y="131.0203"/><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1000.8" y="179.2688"/><path d="M42,136.6203 L215.6,136.6203 L215.6,142.2203 L207.6,150.2203 L42,150.2203 L42,136.6203 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="707.8047" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1029.6" x="42" y="136.6203"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137.6" x="54" y="147.475">DFSP Notified of Rejection</text><polygon fill="#A80036" points="991.2,176.0688,999.2,179.2688,991.2,182.4688,994.4,179.2688" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="324.4" x2="996" y1="179.2688" y2="179.2688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="330" y="169.8477">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="188" x="340.4" y="163.7234">Consume Notification event message</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="343.6" y="175.9719"/><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="343.6" y="175.9719">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="405.2" y="175.9719">2001</text><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="32.4969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="712.4" x="224.8" y="210.1656"/><polygon fill="#EEEEEE" points="224.8,210.1656,276,210.1656,276,215.7656,268,223.7656,224.8,223.7656,224.8,210.1656" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="235.2" y="221.8203">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="530.2" y="237.0203">Event Handler {9.1.0}</text><path d="M328,250.6625 L328,270.6625 L704.8,270.6625 L704.8,258.6625 L696.8,250.6625 L328,250.6625 " fill="#ADD8E6" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M696.8,250.6625 L696.8,258.6625 L704.8,258.6625 L696.8,250.6625 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="360" x="332.8" y="264.7172">Update Event log upon consuming the notification (still to be designed)</text><path d="M50,283.7109 L99.6,283.7109 L99.6,289.3109 L91.6,297.3109 L50,297.3109 L50,283.7109 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="555.1141" style="stroke: #000000; stroke-width: 1.600000023841858;" width="896" x="50" y="283.7109"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="62" y="294.5656">alt</text><path d="M219.2,303.1594 L332.8,303.1594 L332.8,308.7594 L324.8,316.7594 L219.2,316.7594 L219.2,303.1594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="665.2" x="219.2" y="303.1594"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="231.2" y="314.0141">Validate Event</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="324.4" x2="358" y1="346.3047" y2="346.3047"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="358" x2="358" y1="346.3047" y2="356.7047"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="325.2" x2="358" y1="356.7047" y2="356.7047"/><polygon fill="#A80036" points="333.2,353.5047,325.2,356.7047,333.2,359.9047,330,356.7047" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="330" y="336.3867">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="531.2" x="340.4" y="330.2625">Validate event - Rule: type == 'notification' &amp;&amp; [action IN ['reject', 'timeout-received', 'timeout-reserved']]</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="343.6" y="342.5109"/><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="343.6" y="342.5109">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="405.2" y="342.5109">2001</text><polygon fill="#A80036" points="874.8,394.3047,882.8,397.5047,874.8,400.7047,878,397.5047" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="324.4" x2="879.6" y1="397.5047" y2="397.5047"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="330" y="388.0836">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="180" x="340.4" y="381.9594">Request Participant Callback details</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="343.6" y="394.2078"/><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="343.6" y="394.2078">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="405.2" y="394.2078">3201</text><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="32.4969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="712.4" x="224.8" y="404.4016"/><polygon fill="#EEEEEE" points="224.8,404.4016,276,404.4016,276,410.0016,268,418.0016,224.8,418.0016,224.8,404.4016" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="235.2" y="416.0563">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="193.6" x="485.8" y="431.2563">Get Participant Callback Details {3.1.0}</text><polygon fill="#A80036" points="333.2,454.4984,325.2,457.6984,333.2,460.8984,330,457.6984" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="328.4" x2="883.6" y1="457.6984" y2="457.6984"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="338" y="454.1531">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="172.8" x="348.4" y="454.1531">Return Participant Callback details</text><path d="M328,468.3469 L328,598.7469 L575.2,598.7469 L575.2,476.3469 L567.2,468.3469 L328,468.3469 " fill="#FFFF00" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M567.2,468.3469 L567.2,476.3469 L575.2,476.3469 L567.2,468.3469 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="46.4" x="332.8" y="482.4016">Message:</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="332.8" y="494.65">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="46.4" x="345.6" y="506.8984">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="206.4" x="345.6" y="519.1469">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="217.6" x="345.6" y="531.3953">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="114.4" x="345.6" y="543.6438">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="48" x="345.6" y="555.8922">content: {</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="144" x="358.4" y="568.1406">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="6.4" x="345.6" y="580.3891">},</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="332.8" y="592.6375">}</text><polygon fill="#A80036" points="86.4,631.6313,78.4,634.8313,86.4,638.0313,83.2,634.8313" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="81.6" x2="315.6" y1="634.8313" y2="634.8313"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="91.2" y="625.4102">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="133.6" x="101.6" y="619.2859">Send Callback Notification</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="104.8" y="631.5344"/><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="104.8" y="631.5344">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="89.6" x="166.4" y="631.5344">1000, 1001, 3002</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="50" x2="946" y1="642.5281" y2="642.5281"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="54" y="651.0359">[Validate rule type != 'notification' / Error]</text><path d="M328,657.6922 L328,751.2922 L553.6,751.2922 L553.6,665.6922 L545.6,657.6922 L328,657.6922 " fill="#FFFF00" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M545.6,657.6922 L545.6,665.6922 L553.6,665.6922 L545.6,657.6922 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="46.4" x="332.8" y="671.7469">Message:</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="332.8" y="683.9953">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="100.8" x="345.6" y="696.2438">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="132.8" x="358.4" y="708.4922">"errorCode": &lt;errorCode&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="183.2" x="358.4" y="720.7406">"errorDescription": &lt;ErrorMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="345.6" y="732.9891">}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="332.8" y="745.2375">}</text><rect fill="#FFFFFF" filter="url(#f1xa4fhpjey3kn)" height="32.4969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="712.4" x="224.8" y="758.6313"/><polygon fill="#EEEEEE" points="224.8,758.6313,276,758.6313,276,764.2313,268,772.2313,224.8,772.2313,224.8,758.6313" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="235.2" y="770.2859">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="530.2" y="785.4859">Event Handler {9.1.0}</text><path d="M328,799.1281 L328,831.1281 L662.4,831.1281 L662.4,807.1281 L654.4,799.1281 L328,799.1281 " fill="#ADD8E6" filter="url(#f1xa4fhpjey3kn)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M654.4,799.1281 L654.4,807.1281 L662.4,807.1281 L654.4,799.1281 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="106.4" x="332.8" y="813.1828">Log ERROR Messages</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="317.6" x="332.8" y="825.4313">Update Event log upon ERROR notification (still to be designed)</text><!--
@startuml
title 5.1.1. Notification Handler for Rejections

autonumber


actor "DFSP1\nPayer" as DFSP1
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
end box

box "ML API Adapter Service" #LightBlue
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER

group DFSP Notified of Rejection
    NOTIFY_HANDLER -> TOPIC_NOTIFICATIONS: Consume Notification event message \n <color #FF0000><b>Error code:</b> 2001 </color>
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS
        ref over NOTIFY_HANDLER, CSAPI: Event Handler {9.1.0}
            note right of NOTIFY_HANDLER #lightblue
                Update Event log upon consuming the notification (still to be designed)
            end note

        alt
        group Validate Event
            NOTIFY_HANDLER <-> NOTIFY_HANDLER: Validate event - Rule: type == 'notification' && [action IN ['reject', 'timeout-received', 'timeout-reserved']] \n <color #FF0000><b>Error code:</b> 2001 </color>
        end
        NOTIFY_HANDLER -> CSAPI: Request Participant Callback details \n <color #FF0000><b>Error code:</b> 3201 </color>
        ref over NOTIFY_HANDLER, CSAPI: Get Participant Callback Details {3.1.0}
        NOTIFY_HANDLER <- - CSAPI: Return Participant Callback details
        note right of NOTIFY_HANDLER #yellow
            Message:
            {
                id: <ID>,
                from: <transferHeaders.FSPIOP-Source>,
                to: <transferHeaders.FSPIOP-Destination>,
                type: application/json,
                content: {
                    payload: <transferMessage>
                },
            }
        end note

        NOTIFY_HANDLER - -> DFSP1: Send Callback Notification \n <color #FF0000><b>Error code:</b> 1000, 1001, 3002 </color>
    else Validate rule type != 'notification' / Error
        note right of NOTIFY_HANDLER #yellow
            Message:
            {
                "errorInformation": {
                    "errorCode": <errorCode>,
                    "errorDescription": <ErrorMessage>,
                }
            }
        end note
        ref over NOTIFY_HANDLER, CSAPI: Event Handler {9.1.0}
            note right of NOTIFY_HANDLER #lightblue
            Log ERROR Messages
            Update Event log upon ERROR notification (still to be designed)
            end note
    end
end
deactivate TOPIC_NOTIFICATIONS

@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>