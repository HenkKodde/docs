<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2393px" preserveAspectRatio="none" style="width:1631px;height:2393px;" version="1.1" viewBox="0 0 1631 2393" width="1631px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nzz7h6vg9qg3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="282" x="675.5" y="23.5352">2.1.1. Fulfil Handler Consume (Success)</text><rect fill="#FFFFE0" height="2348.4883" style="stroke: #A80036; stroke-width: 1.0;" width="1515.5" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="736.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="2181.2012" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="386" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854" y="2088.6465"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1137.5" y="2187.2227"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="521.6348"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="943.6719"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="1126.2246"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="1363.3984"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="1513.9512"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="550.9453"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="972.9824"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="1155.5352"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="1392.709"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="1543.2617"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="2167.2012" style="stroke: #000000; stroke-width: 2.0;" width="1607" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="2135.8906" style="stroke: #000000; stroke-width: 2.0;" width="1587" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="513.5" x="301.5" y="241.2188"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="493.5" x="311.5" y="265.5293"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="757.5" x="311.5" y="361.4609"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="198.4844" style="stroke: #000000; stroke-width: 2.0;" width="1239" x="311.5" y="467.7031"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="186.5527" style="stroke: #000000; stroke-width: 2.0;" width="547.5" x="311.5" y="680.1875"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="1351.4824" style="stroke: #000000; stroke-width: 2.0;" width="1298.5" x="301.5" y="880.7402"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1266.5" x="311.5" y="905.0508"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1239" x="311.5" y="1087.6035"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="398.7266" style="stroke: #000000; stroke-width: 2.0;" width="1278.5" x="311.5" y="1270.1563"/><rect fill="#FFFFFF" height="105.5762" style="stroke: none; stroke-width: 1.0;" width="1298.5" x="301.5" y="2126.6465"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="76.6211" style="stroke: #000000; stroke-width: 2.0;" width="914.5" x="311.5" y="2148.6016"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="1587" x="23" y="2239.2227"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="84" x2="84" y1="116.2871" y2="2317.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="390.5" x2="390.5" y1="116.2871" y2="2317.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="859" x2="859" y1="116.2871" y2="2317.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1006" x2="1006" y1="116.2871" y2="2317.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1142" x2="1142" y1="116.2871" y2="2317.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1275" x2="1275" y1="116.2871" y2="2317.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1492.5" x2="1492.5" y1="116.2871" y2="2317.4883"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="37" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="33" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="40" y="101.334">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="37" y="2316.4883"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="33" y="2320.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="40" y="2341.0234">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="321.5" y="113.334">Fulfil Event Handler</text><ellipse cx="391" cy="83.7988" fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="387,71.7988,393,66.7988,391,71.7988,393,76.7988,387,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="321.5" y="2330.0234">Fulfil Event Handler</text><ellipse cx="391" cy="2348.9766" fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="387,2336.9766,393,2331.9766,391,2336.9766,393,2341.9766,387,2336.9766" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="778" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="774" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="781" y="101.334">Position-Topic-dfsp2</text><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="778" y="2316.4883"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="774" y="2320.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="781" y="2341.0234">Position-Topic-dfsp2</text><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="958" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="954" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="961" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="958" y="2316.4883"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="954" y="2320.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="961" y="2341.0234">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1073" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1069" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1076" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1073" y="2316.4883"/><rect fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1069" y="2320.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1076" y="2341.0234">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1226" y="113.334">Transfer DAO</text><ellipse cx="1275.5" cy="83.7988" fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1263.5" x2="1287.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1226" y="2330.0234">Transfer DAO</text><ellipse cx="1275.5" cy="2348.9766" fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1263.5" x2="1287.5" y1="2362.9766" y2="2362.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1444.5" y="113.334">Central Store</text><path d="M1474.5,63.7988 C1474.5,53.7988 1492.5,53.7988 1492.5,53.7988 C1492.5,53.7988 1510.5,53.7988 1510.5,63.7988 L1510.5,89.7988 C1510.5,99.7988 1492.5,99.7988 1492.5,99.7988 C1492.5,99.7988 1474.5,99.7988 1474.5,89.7988 L1474.5,63.7988 " fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1474.5,63.7988 C1474.5,73.7988 1492.5,73.7988 1492.5,73.7988 C1492.5,73.7988 1510.5,73.7988 1510.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1444.5" y="2330.0234">Central Store</text><path d="M1474.5,2342.9766 C1474.5,2332.9766 1492.5,2332.9766 1492.5,2332.9766 C1492.5,2332.9766 1510.5,2332.9766 1510.5,2342.9766 L1510.5,2368.9766 C1510.5,2378.9766 1492.5,2378.9766 1492.5,2378.9766 C1492.5,2378.9766 1474.5,2378.9766 1474.5,2368.9766 L1474.5,2342.9766 " fill="#FEFECE" filter="url(#f1nzz7h6vg9qg3)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1474.5,2342.9766 C1474.5,2352.9766 1492.5,2352.9766 1492.5,2352.9766 C1492.5,2352.9766 1510.5,2352.9766 1510.5,2342.9766 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="2181.2012" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="386" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854" y="2088.6465"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1137.5" y="2187.2227"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="521.6348"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="943.6719"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="1126.2246"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="1363.3984"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1270.5" y="1513.9512"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="550.9453"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="972.9824"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="1155.5352"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="1392.709"/><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1487.5" y="1543.2617"/><path d="M13,133.2871 L282,133.2871 L282,140.2871 L272,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2167.2012" style="stroke: #000000; stroke-width: 2.0;" width="1607" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="28" y="146.8555">Fulfil Handler Consume (Success)</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2135.8906" style="stroke: #000000; stroke-width: 2.0;" width="1587" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="100,192.2188,90,196.2188,100,200.2188,96,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="385" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="106" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="119" y="191.4766">Consume Prepare event message for Payer</text><path d="M301.5,241.2188 L385.5,241.2188 L385.5,248.2188 L375.5,258.2188 L301.5,258.2188 L301.5,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="513.5" x="301.5" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="316.5" y="254.7871">break</text><path d="M311.5,265.5293 L453.5,265.5293 L453.5,272.5293 L443.5,282.5293 L311.5,282.5293 L311.5,265.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="493.5" x="311.5" y="265.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="326.5" y="279.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="438" y1="319.4609" y2="319.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="438" y1="319.4609" y2="332.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397" x2="438" y1="332.4609" y2="332.4609"/><polygon fill="#A80036" points="407,328.4609,397,332.4609,407,336.4609,403,332.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403" y="307.0635">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="416" y="299.4082">Validate event - Rule: type == 'fulfil' &amp;&amp; action == 'commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="416" y="314.7188">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="500" y="314.7188">2001</text><path d="M311.5,361.4609 L526.5,361.4609 L526.5,368.4609 L516.5,378.4609 L311.5,378.4609 L311.5,361.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="757.5" x="311.5" y="361.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="326.5" y="375.0293">Persist Event Information</text><polygon fill="#A80036" points="994.5,396.082,1004.5,400.082,994.5,404.082,998.5,400.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1000.5" y1="400.082" y2="400.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403" y="395.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="416" y="395.3398">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1nzz7h6vg9qg3)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="739.5" x="318.5" y="408.082"/><polygon fill="#EEEEEE" points="318.5,408.082,382.5,408.082,382.5,415.082,372.5,425.082,318.5,425.082,318.5,408.082" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="331.5" y="422.6504">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="591.25" y="441.6504">Event Handler Consume {9.1.0.}</text><path d="M311.5,467.7031 L524.5,467.7031 L524.5,474.7031 L514.5,484.7031 L311.5,484.7031 L311.5,467.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="198.4844" style="stroke: #000000; stroke-width: 2.0;" width="1239" x="311.5" y="467.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="326.5" y="481.2715">Retrieve Transfer Details</text><polygon fill="#A80036" points="1258.5,517.6348,1268.5,521.6348,1258.5,525.6348,1262.5,521.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1264.5" y1="521.6348" y2="521.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403" y="509.2373">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="416" y="501.582">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="416" y="516.8926">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="493" y="516.8926">2001</text><polygon fill="#A80036" points="1475.5,546.9453,1485.5,550.9453,1475.5,554.9453,1479.5,550.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1280.5" x2="1481.5" y1="550.9453" y2="550.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1287.5" y="546.2031">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1300.5" y="546.2031">Fetch from database</text><polygon fill="#A80036" points="1291.5,576.2559,1281.5,580.2559,1291.5,584.2559,1287.5,580.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1285.5" x2="1491.5" y1="580.2559" y2="580.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1297.5" y="575.5137">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1314.5" y="575.5137"/><polygon fill="#FFFFE0" filter="url(#f1nzz7h6vg9qg3)" points="1466,593.2559,1519,593.2559,1529,612.2559,1519,631.2559,1466,631.2559,1456,612.2559,1466,593.2559" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1468" y="609.8242">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="1468" y="625.1348">ilp</text><polygon fill="#A80036" points="407,654.1875,397,658.1875,407,662.1875,403,658.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401" x2="1274.5" y1="658.1875" y2="658.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413" y="653.4453">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="426" y="653.4453">Return transfer &amp; ilp</text><path d="M311.5,680.1875 L510.5,680.1875 L510.5,687.1875 L500.5,697.1875 L311.5,697.1875 L311.5,680.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="186.5527" style="stroke: #000000; stroke-width: 2.0;" width="547.5" x="311.5" y="680.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="326.5" y="693.7559">Validate Fulfil Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="438" y1="718.8086" y2="718.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="438" y1="718.8086" y2="731.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397" x2="438" y1="731.8086" y2="731.8086"/><polygon fill="#A80036" points="407,727.8086,397,731.8086,407,735.8086,403,731.8086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403" y="714.0664">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="416" y="714.0664">Check existing transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="438" y1="761.1191" y2="761.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="438" y1="761.1191" y2="774.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397" x2="438" y1="774.1191" y2="774.1191"/><polygon fill="#A80036" points="407,770.1191,397,774.1191,407,778.1191,403,774.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403" y="756.377">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="416" y="756.377">Validate fulfilment against condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="438" y1="803.4297" y2="803.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="438" y1="803.4297" y2="816.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397" x2="438" y1="816.4297" y2="816.4297"/><polygon fill="#A80036" points="407,812.4297,397,816.4297,407,820.4297,403,816.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="798.6875">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="425" y="798.6875">Validate duplicate check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="438" y1="845.7402" y2="845.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="438" y1="845.7402" y2="858.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397" x2="438" y1="858.7402" y2="858.7402"/><polygon fill="#A80036" points="407,854.7402,397,858.7402,407,862.7402,403,858.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="840.998">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="425" y="840.998">Validate message signature (to be confirmed in future requirement)</text><path d="M301.5,880.7402 L363.5,880.7402 L363.5,887.7402 L353.5,897.7402 L301.5,897.7402 L301.5,880.7402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1351.4824" style="stroke: #000000; stroke-width: 2.0;" width="1298.5" x="301.5" y="880.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="316.5" y="894.3086">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="378.5" y="893.375">[Validate successful]</text><path d="M311.5,905.0508 L767.5,905.0508 L767.5,912.0508 L757.5,922.0508 L311.5,922.0508 L311.5,905.0508 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1266.5" x="311.5" y="905.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="411" x="326.5" y="918.6191">Persist Transfer State (with transferState='RECEIVED-FULFIL')</text><polygon fill="#A80036" points="1258.5,939.6719,1268.5,943.6719,1258.5,947.6719,1262.5,943.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1264.5" y1="943.6719" y2="943.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="938.9297">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="425" y="938.9297">Request to persist transfer state</text><polygon fill="#A80036" points="1475.5,968.9824,1485.5,972.9824,1475.5,976.9824,1479.5,972.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1280.5" x2="1481.5" y1="972.9824" y2="972.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1287.5" y="968.2402">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1309.5" y="968.2402">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f1nzz7h6vg9qg3)" points="1427,1015.9824,1558,1015.9824,1568,1026.9824,1558,1038.9824,1427,1038.9824,1417,1026.9824,1427,1015.9824" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1429" y="1032.5508">transferStateChange</text><polygon fill="#A80036" points="407,1061.6035,397,1065.6035,407,1069.6035,403,1065.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401" x2="1274.5" y1="1065.6035" y2="1065.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413" y="1060.8613">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="435" y="1060.8613">Return success</text><path d="M311.5,1087.6035 L471.5,1087.6035 L471.5,1094.6035 L461.5,1104.6035 L311.5,1104.6035 L311.5,1087.6035 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1239" x="311.5" y="1087.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="326.5" y="1101.1719">Persist fulfilment</text><polygon fill="#A80036" points="1258.5,1122.2246,1268.5,1126.2246,1258.5,1130.2246,1262.5,1126.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1264.5" y1="1126.2246" y2="1126.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="1121.4824">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="425" y="1121.4824">Persist fulfilment</text><polygon fill="#A80036" points="1475.5,1151.5352,1485.5,1155.5352,1475.5,1159.5352,1479.5,1155.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1280.5" x2="1481.5" y1="1155.5352" y2="1155.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1287.5" y="1150.793">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1309.5" y="1150.793">Persist to database</text><polygon fill="#FFFFE0" filter="url(#f1nzz7h6vg9qg3)" points="1482,1198.5352,1502,1198.5352,1512,1209.5352,1502,1221.5352,1482,1221.5352,1472,1209.5352,1482,1198.5352" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="1484" y="1215.1035">ilp</text><polygon fill="#A80036" points="407,1244.1563,397,1248.1563,407,1252.1563,403,1248.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401" x2="1274.5" y1="1248.1563" y2="1248.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413" y="1243.4141">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="435" y="1243.4141">Return success</text><path d="M311.5,1270.1563 L560.5,1270.1563 L560.5,1277.1563 L550.5,1287.1563 L311.5,1287.1563 L311.5,1270.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="398.7266" style="stroke: #000000; stroke-width: 2.0;" width="1278.5" x="311.5" y="1270.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="326.5" y="1283.7246">Append to Settlement Window</text><path d="M401,1292.4668 L401,1332.4668 L803,1332.4668 L803,1302.4668 L793,1292.4668 L401,1292.4668 " fill="#D3D3D3" filter="url(#f1nzz7h6vg9qg3)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M793,1292.4668 L793,1302.4668 L803,1302.4668 L793,1292.4668 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="407" y="1310.0352">To be considered</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="524" y="1310.0352">: Retrieve current settlement window from</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="407" y="1325.3457">Position-Topic (message 1) instead of querying the DB.</text><polygon fill="#A80036" points="1258.5,1359.3984,1268.5,1363.3984,1258.5,1367.3984,1262.5,1363.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1264.5" y1="1363.3984" y2="1363.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="1358.6563">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="425" y="1358.6563">Request to retrieve current/latest transfer settlement window</text><polygon fill="#A80036" points="1475.5,1388.709,1485.5,1392.709,1475.5,1396.709,1479.5,1392.709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1280.5" x2="1481.5" y1="1392.709" y2="1392.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1287.5" y="1387.9668">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1309.5" y="1387.9668">Fetch settlementWindowId</text><polygon fill="#A80036" points="1291.5,1418.0195,1281.5,1422.0195,1291.5,1426.0195,1287.5,1422.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1285.5" x2="1491.5" y1="1422.0195" y2="1422.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1297.5" y="1417.2773">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1323.5" y="1417.2773"/><polygon fill="#FFFFE0" filter="url(#f1nzz7h6vg9qg3)" points="1432,1435.0195,1552,1435.0195,1562,1446.0195,1552,1458.0195,1432,1458.0195,1422,1446.0195,1432,1435.0195" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1434" y="1451.5879">settlementWindow</text><polygon fill="#A80036" points="407,1480.6406,397,1484.6406,407,1488.6406,403,1484.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401" x2="1274.5" y1="1484.6406" y2="1484.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413" y="1479.8984">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="435" y="1479.8984">Return settlementWindowId to be appended</text><polygon fill="#A80036" points="1258.5,1509.9512,1268.5,1513.9512,1258.5,1517.9512,1262.5,1513.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1264.5" y1="1513.9512" y2="1513.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="1509.209">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="478" x="425" y="1509.209">Request to append the transfer to current/latest transfer settlement window</text><polygon fill="#A80036" points="1475.5,1539.2617,1485.5,1543.2617,1475.5,1547.2617,1479.5,1543.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1280.5" x2="1481.5" y1="1543.2617" y2="1543.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1287.5" y="1538.5195">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="1309.5" y="1538.5195">Append transfer</text><polygon fill="#FFFFE0" filter="url(#f1nzz7h6vg9qg3)" points="1415,1586.2617,1570,1586.2617,1580,1597.2617,1570,1609.2617,1415,1609.2617,1405,1597.2617,1415,1586.2617" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1417" y="1602.8301">settlementWindowIndex</text><polygon fill="#A80036" points="407,1631.8828,397,1635.8828,407,1639.8828,403,1635.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401" x2="1274.5" y1="1635.8828" y2="1635.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413" y="1631.1406">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="435" y="1631.1406">Return success</text><path d="M401,1680.8828 L401,2057.8828 L710,2057.8828 L710,1690.8828 L700,1680.8828 L401,1680.8828 " fill="#FFFF00" filter="url(#f1nzz7h6vg9qg3)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M700,1680.8828 L700,1690.8828 L710,1690.8828 L700,1680.8828 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="407" y="1698.4512">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="407" y="1713.7617">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="423" y="1729.0723">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="423" y="1744.3828">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="423" y="1759.6934">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="423" y="1775.0039">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="423" y="1790.3145">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="439" y="1805.625">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="439" y="1820.9355">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="423" y="1836.2461">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="423" y="1851.5566">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="439" y="1866.8672">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="455" y="1882.1777">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="455" y="1897.4883">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="455" y="1912.7988">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="455" y="1928.1094">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="455" y="1943.4199">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="455" y="1958.7305">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="471" y="1974.041">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="471" y="1989.3516">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="455" y="2004.6621">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="439" y="2019.9727">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="423" y="2035.2832">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="407" y="2050.5938">}</text><polygon fill="#A80036" points="842,2084.6465,852,2088.6465,842,2092.6465,846,2088.6465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="848" y1="2088.6465" y2="2088.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="2083.9043">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="425" y="2083.9043">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="301.5" x2="1600" y1="2127.6465" y2="2127.6465"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="306.5" y="2138.2813">[Validate Fulfil Transfer not successful]</text><path d="M311.5,2148.6016 L395.5,2148.6016 L395.5,2155.6016 L385.5,2165.6016 L311.5,2165.6016 L311.5,2148.6016 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="76.6211" style="stroke: #000000; stroke-width: 2.0;" width="914.5" x="311.5" y="2148.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="326.5" y="2162.1699">break</text><polygon fill="#A80036" points="1125.5,2183.2227,1135.5,2187.2227,1125.5,2191.2227,1129.5,2187.2227" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="1131.5" y1="2187.2227" y2="2187.2227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="403" y="2182.4805">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="425" y="2182.4805">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1610" y1="2240.2227" y2="2240.2227"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="2250.8574">[Consume Batch Messages]</text><path d="M163,2259.1777 L163,2284.1777 L377,2284.1777 L377,2269.1777 L367,2259.1777 L163,2259.1777 " fill="#ADD8E6" filter="url(#f1nzz7h6vg9qg3)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M367,2259.1777 L367,2269.1777 L377,2269.1777 L367,2259.1777 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="169" y="2276.7461">To be delivered by future story</text><!--
@startuml
title 2.1.1. Fulfil Handler Consume (Success)

autonumber


collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "Event-Topic" as TOPIC_EVENT
collections "Position-Topic-dfsp2" as TOPIC_POSITION_DFSP2
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_POSITION_DFSP2
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box

activate FULF_HANDLER
group Fulfil Handler Consume (Success)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Prepare event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL

        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type == 'fulfil' && action == 'commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end

        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
	        ref over FULF_HANDLER, TOPIC_EVENT :  Event Handler Consume {9.1.0.} 
        end

        group Retrieve Transfer Details
            FULF_HANDLER -> TRANS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2001</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Fetch from database
            activate DB
            DB - -> TRANS_DAO
            deactivate DB
            hnote over DB #lightyellow
                transfer
                ilp
            end note
            FULF_HANDLER <- - TRANS_DAO: Return transfer & ilp
            deactivate TRANS_DAO
        end

        group Validate Fulfil Transfer
            FULF_HANDLER <-> FULF_HANDLER: Check existing transfer
            FULF_HANDLER <-> FULF_HANDLER: Validate fulfilment against condition
            FULF_HANDLER <-> FULF_HANDLER: Validate duplicate check
            FULF_HANDLER <-> FULF_HANDLER: Validate message signature (to be confirmed in future requirement)
        end

        alt Validate successful
            group Persist Transfer State (with transferState='RECEIVED-FULFIL')
                FULF_HANDLER -> TRANS_DAO: Request to persist transfer state
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer state
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    transferStateChange
                end note
                TRANS_DAO - -> FULF_HANDLER: Return success
                deactivate TRANS_DAO
            end

            group Persist fulfilment
                FULF_HANDLER -> TRANS_DAO: Persist fulfilment
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    ilp
                end note
                FULF_HANDLER <- - TRANS_DAO: Return success
                deactivate TRANS_DAO
            end

            group Append to Settlement Window
                note right of FULF_HANDLER #lightgray
                    <color #FF0000>**To be considered**: Retrieve current settlement window from</color>
                    <color #FF0000>Position-Topic (message 1) instead of querying the DB.</color>
                end note
                FULF_HANDLER -> TRANS_DAO: Request to retrieve current/latest transfer settlement window
                activate TRANS_DAO
                TRANS_DAO -> DB: Fetch settlementWindowId
                activate DB
                DB - -> TRANS_DAO
                deactivate DB
                hnote over DB #lightyellow
                    settlementWindow
                end note
                FULF_HANDLER <- - TRANS_DAO: Return settlementWindowId to be appended
                deactivate TRANS_DAO

                FULF_HANDLER -> TRANS_DAO: Request to append the transfer to current/latest transfer settlement window
                activate TRANS_DAO
                TRANS_DAO -> DB: Append transfer
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    settlementWindowIndex
                end note
                FULF_HANDLER <- - TRANS_DAO: Return success
                deactivate TRANS_DAO
                |||
            end

            note right of FULF_HANDLER #yellow
                Message:
                {
                    id: <ID>,
                    from: <transferHeaders.FSPIOP-Source>,
                    to: <transferHeaders.FSPIOP-Destination>,
                    type: application/json,
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: position,
                            action: commit,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            FULF_HANDLER -> TOPIC_POSITION_DFSP2: Route & Publish Position event for Payee
            activate TOPIC_POSITION_DFSP2
            deactivate TOPIC_POSITION_DFSP2
        else Validate Fulfil Transfer not successful
            break
                FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                activate TOPIC_NOTIFICATIONS
                deactivate TOPIC_NOTIFICATIONS
            end
        end

    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end
deactivate FULF_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>