<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="8482px" preserveAspectRatio="none" style="width:1550px;height:8482px;" version="1.1" viewBox="0 0 1550 8482" width="1550px" zoomAndPan="magnify"><defs><filter height="300%" id="f13keaapvflui6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="638" y="23.5352">1.3.3 Abort Position Handler Consume</text><rect fill="#FFFFE0" height="8437.3496" style="stroke: #A80036; stroke-width: 1.0;" width="1426.5" x="49" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="711.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="8270.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="825.5" y="5104.9492"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="5919.0156"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="6725.127"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="7531.2383"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="8337.3496"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="220.5293"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="437.7031"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="645.877"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="1501.2988"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="1718.4727"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="1926.6465"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="2782.0684"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="2999.2422"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="3207.416"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="3955.6641"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="4172.8379"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="4381.0117"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="5203.5254"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="6009.6367"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="6815.748"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="7621.8594"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="828.4297"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="2109.1992"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="3389.9688"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="4563.5645"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="249.8398"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="467.0137"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="675.1875"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="857.7402"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="1530.6094"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="1747.7832"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="1955.957"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="2138.5098"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="2811.3789"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3028.5527"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3236.7266"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3419.2793"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3984.9746"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="4202.1484"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="4410.3223"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="4592.875"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="5232.8359"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="6038.9473"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="6845.0586"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="7651.1699"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="8256.0625" style="stroke: #000000; stroke-width: 2.0;" width="1526" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="8224.752" style="stroke: #000000; stroke-width: 2.0;" width="1506" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="1266.7695" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="181.9082"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="399.082"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="789.8086"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="1266.7695" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="1462.6777"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="1679.8516"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="2070.5781"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="1159.5957" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="2743.4473"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="2960.6211"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="3351.3477"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="1159.5957" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="3917.043"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="4134.2168"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="4524.9434"/><rect fill="#FFFFFF" height="3239.4004" style="stroke: none; stroke-width: 1.0;" width="1506" x="23" y="5142.9492"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="5164.9043"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="5971.0156"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="6777.127"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="7583.2383"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="112" x2="112" y1="116.2871" y2="8406.3496"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="830.5" x2="830.5" y1="116.2871" y2="8406.3496"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="976.5" x2="976.5" y1="116.2871" y2="8406.3496"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1108.5" x2="1108.5" y1="116.2871" y2="8406.3496"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1215.5" x2="1215.5" y1="116.2871" y2="8406.3496"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1423.5" x2="1423.5" y1="116.2871" y2="8406.3496"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="53" y="113.334">Position Handler</text><ellipse cx="112.5" cy="83.7988" fill="#FEFECE" filter="url(#f13keaapvflui6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="108.5,71.7988,114.5,66.7988,112.5,71.7988,114.5,76.7988,108.5,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="53" y="8418.8848">Position Handler</text><ellipse cx="112.5" cy="8437.8379" fill="#FEFECE" filter="url(#f13keaapvflui6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="108.5,8425.8379,114.5,8420.8379,112.5,8425.8379,114.5,8430.8379,108.5,8425.8379" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="771.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="767.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="774.5" y="101.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="771.5" y="8405.3496"/><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="767.5" y="8409.3496"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="774.5" y="8429.8848">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="907.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="903.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="910.5" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="907.5" y="8405.3496"/><rect fill="#FEFECE" filter="url(#f13keaapvflui6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="903.5" y="8409.3496"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="910.5" y="8429.8848">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1060.5" y="113.334">Position DAO</text><ellipse cx="1108.5" cy="83.7988" fill="#FEFECE" filter="url(#f13keaapvflui6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1096.5" x2="1120.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1060.5" y="8418.8848">Position DAO</text><ellipse cx="1108.5" cy="8437.8379" fill="#FEFECE" filter="url(#f13keaapvflui6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1096.5" x2="1120.5" y1="8451.8379" y2="8451.8379"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1166.5" y="113.334">Transfer DAO</text><ellipse cx="1216" cy="83.7988" fill="#FEFECE" filter="url(#f13keaapvflui6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1204" x2="1228" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1166.5" y="8418.8848">Transfer DAO</text><ellipse cx="1216" cy="8437.8379" fill="#FEFECE" filter="url(#f13keaapvflui6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1204" x2="1228" y1="8451.8379" y2="8451.8379"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1375.5" y="113.334">Central Store</text><path d="M1405.5,63.7988 C1405.5,53.7988 1423.5,53.7988 1423.5,53.7988 C1423.5,53.7988 1441.5,53.7988 1441.5,63.7988 L1441.5,89.7988 C1441.5,99.7988 1423.5,99.7988 1423.5,99.7988 C1423.5,99.7988 1405.5,99.7988 1405.5,89.7988 L1405.5,63.7988 " fill="#FEFECE" filter="url(#f13keaapvflui6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1405.5,63.7988 C1405.5,73.7988 1423.5,73.7988 1423.5,73.7988 C1423.5,73.7988 1441.5,73.7988 1441.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1375.5" y="8418.8848">Central Store</text><path d="M1405.5,8431.8379 C1405.5,8421.8379 1423.5,8421.8379 1423.5,8421.8379 C1423.5,8421.8379 1441.5,8421.8379 1441.5,8431.8379 L1441.5,8457.8379 C1441.5,8467.8379 1423.5,8467.8379 1423.5,8467.8379 C1423.5,8467.8379 1405.5,8467.8379 1405.5,8457.8379 L1405.5,8431.8379 " fill="#FEFECE" filter="url(#f13keaapvflui6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1405.5,8431.8379 C1405.5,8441.8379 1423.5,8441.8379 1423.5,8441.8379 C1423.5,8441.8379 1441.5,8441.8379 1441.5,8431.8379 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="8270.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="825.5" y="5104.9492"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="5919.0156"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="6725.127"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="7531.2383"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="972" y="8337.3496"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="220.5293"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="437.7031"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="645.877"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="1501.2988"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="1718.4727"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="1926.6465"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="2782.0684"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="2999.2422"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="3207.416"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="3955.6641"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="4172.8379"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="4381.0117"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="5203.5254"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="6009.6367"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="6815.748"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1103.5" y="7621.8594"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="828.4297"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="2109.1992"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="3389.9688"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1211" y="4563.5645"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="249.8398"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="467.0137"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="675.1875"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="857.7402"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="1530.6094"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="1747.7832"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="1955.957"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="2138.5098"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="2811.3789"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3028.5527"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3236.7266"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3419.2793"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="3984.9746"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="4202.1484"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="4410.3223"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="4592.875"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="5232.8359"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="6038.9473"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="6845.0586"/><rect fill="#FFFFFF" filter="url(#f13keaapvflui6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1418.5" y="7651.1699"/><path d="M13,133.2871 L278,133.2871 L278,140.2871 L268,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="8256.0625" style="stroke: #000000; stroke-width: 2.0;" width="1526" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="28" y="146.8555">Abort Position Handler Consume</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="8224.752" style="stroke: #000000; stroke-width: 2.0;" width="1506" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="100" y="170.2324">[Calculate &amp; Validate Latest Position Abort (success)]</text><path d="M33,181.9082 L100,181.9082 L100,188.9082 L90,198.9082 L33,198.9082 L33,181.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1266.7695" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="181.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="195.4766">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="115" y="194.543">[type == 'position' &amp;&amp; action == 'timeout-received']</text><polygon fill="#A80036" points="1091.5,216.5293,1101.5,220.5293,1091.5,224.5293,1095.5,220.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="220.5293" y2="220.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="215.7871">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="137.5" y="215.7871">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,245.8398,1416.5,249.8398,1406.5,253.8398,1410.5,249.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="249.8398" y2="249.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1120.5" y="245.0977">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1133.5" y="245.0977">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,262.8398,1489,262.8398,1499,273.8398,1489,285.8398,1358,285.8398,1348,273.8398,1358,262.8398" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="279.4082">transferStateChange</text><polygon fill="#A80036" points="1124.5,308.4609,1114.5,312.4609,1124.5,316.4609,1120.5,312.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="312.4609" y2="312.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1130.5" y="307.7188">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1143.5" y="307.7188">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,337.7715,118.5,341.7715,128.5,345.7715,124.5,341.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="341.7715" y2="341.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="134.5" y="337.0293">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="147.5" y="337.0293">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="371.082" y2="371.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="371.082" y2="384.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="384.082" y2="384.082"/><polygon fill="#A80036" points="128.5,380.082,118.5,384.082,128.5,388.082,124.5,384.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="366.3398">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="137.5" y="366.3398">Validate current state (transferStateChange.transferStateId == 'EXPIRED')</text><path d="M43,399.082 L342,399.082 L342,406.082 L332,416.082 L43,416.082 L43,399.082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="399.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="58" y="412.6504">Calculate position and persist change</text><polygon fill="#A80036" points="1091.5,433.7031,1101.5,437.7031,1091.5,441.7031,1095.5,437.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="437.7031" y2="437.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="432.9609">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="137.5" y="432.9609">Request latest position from DB for Payer</text><polygon fill="#A80036" points="1406.5,463.0137,1416.5,467.0137,1406.5,471.0137,1410.5,467.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="467.0137" y2="467.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1120.5" y="462.2715">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1133.5" y="462.2715">Retrieve latest position from DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,480.0137,1485,480.0137,1495,499.0137,1485,518.0137,1362,518.0137,1352,499.0137,1362,480.0137" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1364" y="496.582">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="511.8926">participantPosition</text><polygon fill="#A80036" points="1124.5,540.9453,1114.5,544.9453,1124.5,548.9453,1120.5,544.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="544.9453" y2="544.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1130.5" y="540.2031">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1143.5" y="540.2031">Retrieve latest position from DB for Payer</text><polygon fill="#A80036" points="128.5,570.2559,118.5,574.2559,128.5,578.2559,124.5,574.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="574.2559" y2="574.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="134.5" y="569.5137">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="147.5" y="569.5137">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="603.5664" y2="603.5664"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="603.5664" y2="616.5664"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="616.5664" y2="616.5664"/><polygon fill="#A80036" points="128.5,612.5664,118.5,616.5664,128.5,620.5664,124.5,616.5664" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="598.8242">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="672" x="146.5" y="598.8242">Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)</text><polygon fill="#A80036" points="1091.5,641.877,1101.5,645.877,1091.5,649.877,1095.5,645.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="645.877" y2="645.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="641.1348">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="146.5" y="641.1348">Request to persist latest position for Payer</text><polygon fill="#A80036" points="1406.5,671.1875,1416.5,675.1875,1406.5,679.1875,1410.5,675.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="675.1875" y2="675.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="670.4453">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1142.5" y="670.4453">Persist latest position to DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,718.1875,1485,718.1875,1495,729.1875,1485,741.1875,1362,741.1875,1352,729.1875,1362,718.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="734.7559">participantPosition</text><polygon fill="#A80036" points="128.5,763.8086,118.5,767.8086,128.5,771.8086,124.5,767.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="767.8086" y2="767.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="763.0664">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="763.0664">Return success</text><path d="M43,789.8086 L604,789.8086 L604,796.8086 L594,806.8086 L43,806.8086 L43,789.8086 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="789.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="516" x="58" y="803.377">Persist Transfer State (with transferState='ABORTED' on position check pass)</text><polygon fill="#A80036" points="1199,824.4297,1209,828.4297,1199,832.4297,1203,828.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1205" y1="828.4297" y2="828.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="823.6875">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="146.5" y="823.6875">Request to persist transfer</text><polygon fill="#A80036" points="1406.5,853.7402,1416.5,857.7402,1406.5,861.7402,1410.5,857.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1221" x2="1412.5" y1="857.7402" y2="857.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1228" y="852.998">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1250" y="852.998">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,900.7402,1489,900.7402,1499,911.7402,1489,923.7402,1358,923.7402,1348,911.7402,1358,900.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="917.3086">transferStateChange</text><polygon fill="#A80036" points="128.5,946.3613,118.5,950.3613,128.5,954.3613,124.5,950.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1215" y1="950.3613" y2="950.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="945.6191">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="945.6191">Return success</text><path d="M122,970.3613 L122,1439.3613 L536,1439.3613 L536,980.3613 L526,970.3613 L122,970.3613 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M526,970.3613 L526,980.3613 L536,980.3613 L526,970.3613 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="987.9297">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="1003.2402">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="1018.5508">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="1033.8613">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="1049.1719">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="1064.4824">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="1079.793">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="1095.1035">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="180" y="1110.4141">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="196" y="1125.7246">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="325" x="196" y="1141.0352">"errorDescription": "Payer FSP insufficient liquidity",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="196" y="1156.3457">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="180" y="1171.6563">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="164" y="1186.9668">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="1202.2773">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="1217.5879">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="1232.8984">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="1248.209">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="1263.5195">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="176" y="1278.8301">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="1294.1406">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="1309.4512">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="1324.7617">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="1340.0723">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="1355.3828">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="1370.6934">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="1386.0039">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="1401.3145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="1416.625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="1431.9355">}</text><path d="M33,1462.6777 L100,1462.6777 L100,1469.6777 L90,1479.6777 L33,1479.6777 L33,1462.6777 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1266.7695" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="1462.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="1476.2461">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="297" x="115" y="1475.3125">[type == 'position' &amp;&amp; action == 'timeout-reserved']</text><polygon fill="#A80036" points="1091.5,1497.2988,1101.5,1501.2988,1091.5,1505.2988,1095.5,1501.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="1501.2988" y2="1501.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="1496.5566">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="1496.5566">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,1526.6094,1416.5,1530.6094,1406.5,1534.6094,1410.5,1530.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="1530.6094" y2="1530.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="1525.8672">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="1525.8672">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,1543.6094,1489,1543.6094,1499,1554.6094,1489,1566.6094,1358,1566.6094,1348,1554.6094,1358,1543.6094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="1560.1777">transferStateChange</text><polygon fill="#A80036" points="1124.5,1589.2305,1114.5,1593.2305,1124.5,1597.2305,1120.5,1593.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="1593.2305" y2="1593.2305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="1588.4883">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="1588.4883">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,1618.541,118.5,1622.541,128.5,1626.541,124.5,1622.541" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="1622.541" y2="1622.541"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="1617.7988">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="1617.7988">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="1651.8516" y2="1651.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="1651.8516" y2="1664.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="1664.8516" y2="1664.8516"/><polygon fill="#A80036" points="128.5,1660.8516,118.5,1664.8516,128.5,1668.8516,124.5,1664.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="1647.1094">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="146.5" y="1647.1094">Validate current state (transferStateChange.transferStateId == 'EXPIRED')</text><path d="M43,1679.8516 L342,1679.8516 L342,1686.8516 L332,1696.8516 L43,1696.8516 L43,1679.8516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="1679.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="58" y="1693.4199">Calculate position and persist change</text><polygon fill="#A80036" points="1091.5,1714.4727,1101.5,1718.4727,1091.5,1722.4727,1095.5,1718.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="1718.4727" y2="1718.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="1713.7305">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="1713.7305">Request latest position from DB for Payer</text><polygon fill="#A80036" points="1406.5,1743.7832,1416.5,1747.7832,1406.5,1751.7832,1410.5,1747.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="1747.7832" y2="1747.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="1743.041">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="1142.5" y="1743.041">Retrieve latest position from DB for Payee</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,1760.7832,1485,1760.7832,1495,1779.7832,1485,1798.7832,1362,1798.7832,1352,1779.7832,1362,1760.7832" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1364" y="1777.3516">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="1792.6621">participantPosition</text><polygon fill="#A80036" points="1124.5,1821.7148,1114.5,1825.7148,1124.5,1829.7148,1120.5,1825.7148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="1825.7148" y2="1825.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="1820.9727">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1152.5" y="1820.9727">Retrieve latest position from DB for Payer</text><polygon fill="#A80036" points="128.5,1851.0254,118.5,1855.0254,128.5,1859.0254,124.5,1855.0254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="1855.0254" y2="1855.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="1850.2832">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="156.5" y="1850.2832">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="1884.3359" y2="1884.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="1884.3359" y2="1897.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="1897.3359" y2="1897.3359"/><polygon fill="#A80036" points="128.5,1893.3359,118.5,1897.3359,128.5,1901.3359,124.5,1897.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="1879.5938">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="672" x="146.5" y="1879.5938">Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)</text><polygon fill="#A80036" points="1091.5,1922.6465,1101.5,1926.6465,1091.5,1930.6465,1095.5,1926.6465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="1926.6465" y2="1926.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="1921.9043">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="146.5" y="1921.9043">Request to persist latest position for Payer</text><polygon fill="#A80036" points="1406.5,1951.957,1416.5,1955.957,1406.5,1959.957,1410.5,1955.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="1955.957" y2="1955.957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="1951.2148">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1142.5" y="1951.2148">Persist latest position to DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,1998.957,1485,1998.957,1495,2009.957,1485,2021.957,1362,2021.957,1352,2009.957,1362,1998.957" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="2015.5254">participantPosition</text><polygon fill="#A80036" points="128.5,2044.5781,118.5,2048.5781,128.5,2052.5781,124.5,2048.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="2048.5781" y2="2048.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="2043.8359">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="2043.8359">Return success</text><path d="M43,2070.5781 L604,2070.5781 L604,2077.5781 L594,2087.5781 L43,2087.5781 L43,2070.5781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="2070.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="516" x="58" y="2084.1465">Persist Transfer State (with transferState='ABORTED' on position check pass)</text><polygon fill="#A80036" points="1199,2105.1992,1209,2109.1992,1199,2113.1992,1203,2109.1992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1205" y1="2109.1992" y2="2109.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2104.457">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="146.5" y="2104.457">Request to persist transfer</text><polygon fill="#A80036" points="1406.5,2134.5098,1416.5,2138.5098,1406.5,2142.5098,1410.5,2138.5098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1221" x2="1412.5" y1="2138.5098" y2="2138.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1228" y="2133.7676">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1250" y="2133.7676">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,2181.5098,1489,2181.5098,1499,2192.5098,1489,2204.5098,1358,2204.5098,1348,2192.5098,1358,2181.5098" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="2198.0781">transferStateChange</text><polygon fill="#A80036" points="128.5,2227.1309,118.5,2231.1309,128.5,2235.1309,124.5,2231.1309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1215" y1="2231.1309" y2="2231.1309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="2226.3887">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="2226.3887">Return success</text><path d="M122,2251.1309 L122,2720.1309 L532,2720.1309 L532,2261.1309 L522,2251.1309 L122,2251.1309 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M522,2251.1309 L522,2261.1309 L532,2261.1309 L522,2251.1309 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="2268.6992">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="2284.0098">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="2299.3203">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="2314.6309">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="2329.9414">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="2345.252">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="2360.5625">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="2375.873">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="2391.1836">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="2406.4941">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="325" x="192" y="2421.8047">"errorDescription": "Payer FSP insufficient liquidity",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="2437.1152">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="2452.4258">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="2467.7363">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="2483.0469">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="2498.3574">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="2513.668">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="2528.9785">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="2544.2891">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="176" y="2559.5996">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="2574.9102">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="2590.2207">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="2605.5313">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="2620.8418">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="2636.1523">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="2651.4629">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="2666.7734">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="2682.084">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="2697.3945">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="2712.7051">}</text><path d="M33,2743.4473 L100,2743.4473 L100,2750.4473 L90,2760.4473 L33,2760.4473 L33,2743.4473 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1159.5957" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="2743.4473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="2757.0156">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="230" x="115" y="2756.082">[type == 'position' &amp;&amp; action == 'reject']</text><polygon fill="#A80036" points="1091.5,2778.0684,1101.5,2782.0684,1091.5,2786.0684,1095.5,2782.0684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="2782.0684" y2="2782.0684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2777.3262">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="2777.3262">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,2807.3789,1416.5,2811.3789,1406.5,2815.3789,1410.5,2811.3789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="2811.3789" y2="2811.3789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="2806.6367">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="2806.6367">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,2824.3789,1489,2824.3789,1499,2835.3789,1489,2847.3789,1358,2847.3789,1348,2835.3789,1358,2824.3789" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="2840.9473">transferStateChange</text><polygon fill="#A80036" points="1124.5,2870,1114.5,2874,1124.5,2878,1120.5,2874" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="2874" y2="2874"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="2869.2578">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="2869.2578">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,2899.3105,118.5,2903.3105,128.5,2907.3105,124.5,2903.3105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="2903.3105" y2="2903.3105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="2898.5684">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="2898.5684">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="2932.6211" y2="2932.6211"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="2932.6211" y2="2945.6211"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="2945.6211" y2="2945.6211"/><polygon fill="#A80036" points="128.5,2941.6211,118.5,2945.6211,128.5,2949.6211,124.5,2945.6211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2927.8789">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463" x="146.5" y="2927.8789">Validate current state (transferStateChange.transferStateId == 'REJECTED')</text><path d="M43,2960.6211 L342,2960.6211 L342,2967.6211 L332,2977.6211 L43,2977.6211 L43,2960.6211 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="2960.6211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="58" y="2974.1895">Calculate position and persist change</text><polygon fill="#A80036" points="1091.5,2995.2422,1101.5,2999.2422,1091.5,3003.2422,1095.5,2999.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="2999.2422" y2="2999.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2994.5">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="2994.5">Request latest position from DB for Payer</text><polygon fill="#A80036" points="1406.5,3024.5527,1416.5,3028.5527,1406.5,3032.5527,1410.5,3028.5527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="3028.5527" y2="3028.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="3023.8105">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="3023.8105">Retrieve latest position from DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,3041.5527,1485,3041.5527,1495,3060.5527,1485,3079.5527,1362,3079.5527,1352,3060.5527,1362,3041.5527" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1364" y="3058.1211">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="3073.4316">participantPosition</text><polygon fill="#A80036" points="1124.5,3102.4844,1114.5,3106.4844,1124.5,3110.4844,1120.5,3106.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="3106.4844" y2="3106.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="3101.7422">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1152.5" y="3101.7422">Retrieve latest position from DB for Payer</text><polygon fill="#A80036" points="128.5,3131.7949,118.5,3135.7949,128.5,3139.7949,124.5,3135.7949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="3135.7949" y2="3135.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="3131.0527">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="156.5" y="3131.0527">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="3165.1055" y2="3165.1055"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="3165.1055" y2="3178.1055"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="3178.1055" y2="3178.1055"/><polygon fill="#A80036" points="128.5,3174.1055,118.5,3178.1055,128.5,3182.1055,124.5,3178.1055" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="3160.3633">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="672" x="146.5" y="3160.3633">Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)</text><polygon fill="#A80036" points="1091.5,3203.416,1101.5,3207.416,1091.5,3211.416,1095.5,3207.416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="3207.416" y2="3207.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="3202.6738">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="146.5" y="3202.6738">Request to persist latest position for Payer</text><polygon fill="#A80036" points="1406.5,3232.7266,1416.5,3236.7266,1406.5,3240.7266,1410.5,3236.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="3236.7266" y2="3236.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="3231.9844">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1142.5" y="3231.9844">Persist latest position to DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,3279.7266,1485,3279.7266,1495,3290.7266,1485,3302.7266,1362,3302.7266,1352,3290.7266,1362,3279.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="3296.2949">participantPosition</text><polygon fill="#A80036" points="128.5,3325.3477,118.5,3329.3477,128.5,3333.3477,124.5,3329.3477" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="3329.3477" y2="3329.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="3324.6055">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="3324.6055">Return success</text><path d="M43,3351.3477 L604,3351.3477 L604,3358.3477 L594,3368.3477 L43,3368.3477 L43,3351.3477 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="3351.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="516" x="58" y="3364.916">Persist Transfer State (with transferState='ABORTED' on position check pass)</text><polygon fill="#A80036" points="1199,3385.9688,1209,3389.9688,1199,3393.9688,1203,3389.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1205" y1="3389.9688" y2="3389.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="3385.2266">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="146.5" y="3385.2266">Request to persist transfer</text><polygon fill="#A80036" points="1406.5,3415.2793,1416.5,3419.2793,1406.5,3423.2793,1410.5,3419.2793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1221" x2="1412.5" y1="3419.2793" y2="3419.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1228" y="3414.5371">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1250" y="3414.5371">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,3462.2793,1489,3462.2793,1499,3473.2793,1489,3485.2793,1358,3485.2793,1348,3473.2793,1358,3462.2793" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="3478.8477">transferStateChange</text><polygon fill="#A80036" points="128.5,3507.9004,118.5,3511.9004,128.5,3515.9004,124.5,3511.9004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1215" y1="3511.9004" y2="3511.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="3507.1582">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="3507.1582">Return success</text><path d="M122,3531.9004 L122,3893.9004 L384,3893.9004 L384,3541.9004 L374,3531.9004 L122,3531.9004 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M374,3531.9004 L374,3541.9004 L384,3541.9004 L374,3531.9004 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="3549.4688">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="3564.7793">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="3580.0898">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="3595.4004">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="3610.7109">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="3626.0215">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="3641.332">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="160" y="3656.6426">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="3671.9531">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="3687.2637">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="3702.5742">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="3717.8848">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="3733.1953">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="176" y="3748.5059">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="3763.8164">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="3779.127">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="3794.4375">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="192" y="3809.748">status: "rejected",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="192" y="3825.0586">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="3840.3691">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="3855.6797">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="3870.9902">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="3886.3008">}</text><path d="M33,3917.043 L100,3917.043 L100,3924.043 L90,3934.043 L33,3934.043 L33,3917.043 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1159.5957" style="stroke: #000000; stroke-width: 2.0;" width="1486" x="33" y="3917.043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="3930.6113">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="468" x="115" y="3929.6777">[type == 'position' &amp;&amp; action == 'failed' (Unable to currently trigger this scenario)]</text><polygon fill="#A80036" points="1091.5,3951.6641,1101.5,3955.6641,1091.5,3959.6641,1095.5,3955.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="3955.6641" y2="3955.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="3950.9219">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="3950.9219">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,3980.9746,1416.5,3984.9746,1406.5,3988.9746,1410.5,3984.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="3984.9746" y2="3984.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="3980.2324">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="3980.2324">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,3997.9746,1489,3997.9746,1499,4008.9746,1489,4020.9746,1358,4020.9746,1348,4008.9746,1358,3997.9746" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="4014.543">transferStateChange</text><polygon fill="#A80036" points="1124.5,4043.5957,1114.5,4047.5957,1124.5,4051.5957,1120.5,4047.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="4047.5957" y2="4047.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="4042.8535">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="4042.8535">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,4072.9063,118.5,4076.9063,128.5,4080.9063,124.5,4076.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="4076.9063" y2="4076.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="4072.1641">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="4072.1641">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="4106.2168" y2="4106.2168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="4106.2168" y2="4119.2168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="4119.2168" y2="4119.2168"/><polygon fill="#A80036" points="128.5,4115.2168,118.5,4119.2168,128.5,4123.2168,124.5,4119.2168" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4101.4746">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="146.5" y="4101.4746">Validate current state (transferStateChange.transferStateId == 'FAILED')</text><path d="M43,4134.2168 L342,4134.2168 L342,4141.2168 L332,4151.2168 L43,4151.2168 L43,4134.2168 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="376.7266" style="stroke: #000000; stroke-width: 2.0;" width="1462" x="43" y="4134.2168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="58" y="4147.7852">Calculate position and persist change</text><polygon fill="#A80036" points="1091.5,4168.8379,1101.5,4172.8379,1091.5,4176.8379,1095.5,4172.8379" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="4172.8379" y2="4172.8379"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4168.0957">54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="4168.0957">Request latest position from DB for Payer</text><polygon fill="#A80036" points="1406.5,4198.1484,1416.5,4202.1484,1406.5,4206.1484,1410.5,4202.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="4202.1484" y2="4202.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="4197.4063">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="4197.4063">Retrieve latest position from DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,4215.1484,1485,4215.1484,1495,4234.1484,1485,4253.1484,1362,4253.1484,1352,4234.1484,1362,4215.1484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1364" y="4231.7168">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="4247.0273">participantPosition</text><polygon fill="#A80036" points="1124.5,4276.0801,1114.5,4280.0801,1124.5,4284.0801,1120.5,4280.0801" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="4280.0801" y2="4280.0801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="4275.3379">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1152.5" y="4275.3379">Retrieve latest position from DB for Payer</text><polygon fill="#A80036" points="128.5,4305.3906,118.5,4309.3906,128.5,4313.3906,124.5,4309.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="4309.3906" y2="4309.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="4304.6484">57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="156.5" y="4304.6484">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="4338.7012" y2="4338.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="4338.7012" y2="4351.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="4351.7012" y2="4351.7012"/><polygon fill="#A80036" points="128.5,4347.7012,118.5,4351.7012,128.5,4355.7012,124.5,4351.7012" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4333.959">58</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="672" x="146.5" y="4333.959">Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)</text><polygon fill="#A80036" points="1091.5,4377.0117,1101.5,4381.0117,1091.5,4385.0117,1095.5,4381.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="4381.0117" y2="4381.0117"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4376.2695">59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="146.5" y="4376.2695">Request to persist latest position for Payer</text><polygon fill="#A80036" points="1406.5,4406.3223,1416.5,4410.3223,1406.5,4414.3223,1410.5,4410.3223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="4410.3223" y2="4410.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="4405.5801">60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1142.5" y="4405.5801">Persist latest position to DB for Payer</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1362,4453.3223,1485,4453.3223,1495,4464.3223,1485,4476.3223,1362,4476.3223,1352,4464.3223,1362,4453.3223" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1364" y="4469.8906">participantPosition</text><polygon fill="#A80036" points="128.5,4498.9434,118.5,4502.9434,128.5,4506.9434,124.5,4502.9434" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="4502.9434" y2="4502.9434"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="4498.2012">61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="4498.2012">Return success</text><path d="M43,4524.9434 L604,4524.9434 L604,4531.9434 L594,4541.9434 L43,4541.9434 L43,4524.9434 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="4524.9434"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="516" x="58" y="4538.5117">Persist Transfer State (with transferState='ABORTED' on position check pass)</text><polygon fill="#A80036" points="1199,4559.5645,1209,4563.5645,1199,4567.5645,1203,4563.5645" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1205" y1="4563.5645" y2="4563.5645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4558.8223">62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="146.5" y="4558.8223">Request to persist transfer</text><polygon fill="#A80036" points="1406.5,4588.875,1416.5,4592.875,1406.5,4596.875,1410.5,4592.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1221" x2="1412.5" y1="4592.875" y2="4592.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1228" y="4588.1328">63</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1250" y="4588.1328">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,4635.875,1489,4635.875,1499,4646.875,1489,4658.875,1358,4658.875,1348,4646.875,1358,4635.875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="4652.4434">transferStateChange</text><polygon fill="#A80036" points="128.5,4681.4961,118.5,4685.4961,128.5,4689.4961,124.5,4685.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1215" y1="4685.4961" y2="4685.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="4680.7539">64</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="4680.7539">Return success</text><path d="M122,4705.4961 L122,5067.4961 L384,5067.4961 L384,4715.4961 L374,4705.4961 L122,4705.4961 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M374,4705.4961 L374,4715.4961 L384,4715.4961 L374,4705.4961 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="4723.0645">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="4738.375">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="4753.6855">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="4768.9961">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="4784.3066">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="4799.6172">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="4814.9277">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="160" y="4830.2383">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="4845.5488">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="4860.8594">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="4876.1699">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="4891.4805">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="4906.791">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="176" y="4922.1016">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="4937.4121">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="4952.7227">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="4968.0332">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="192" y="4983.3438">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="192" y="4998.6543">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="5013.9648">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5029.2754">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="5044.5859">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="5059.8965">}</text><polygon fill="#A80036" points="813.5,5100.9492,823.5,5104.9492,813.5,5108.9492,817.5,5104.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="819.5" y1="5104.9492" y2="5104.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="5100.207">65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="146.5" y="5100.207">Publish Transfer event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1529" y1="5143.9492" y2="5143.9492"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="290" x="28" y="5154.584">[Calculate &amp; Validate Latest Position Abort (failure)]</text><path d="M43,5164.9043 L110,5164.9043 L110,5171.9043 L100,5181.9043 L43,5181.9043 L43,5164.9043 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="5164.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="58" y="5178.4727">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="125" y="5177.5391">[type == 'position' &amp;&amp; action == 'timeout-received']</text><polygon fill="#A80036" points="1091.5,5199.5254,1101.5,5203.5254,1091.5,5207.5254,1095.5,5203.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="5203.5254" y2="5203.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="5198.7832">66</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="5198.7832">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,5228.8359,1416.5,5232.8359,1406.5,5236.8359,1410.5,5232.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="5232.8359" y2="5232.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="5228.0938">67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="5228.0938">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,5245.8359,1489,5245.8359,1499,5256.8359,1489,5268.8359,1358,5268.8359,1348,5256.8359,1358,5245.8359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="5262.4043">transferStateChange</text><polygon fill="#A80036" points="1124.5,5291.457,1114.5,5295.457,1124.5,5299.457,1120.5,5295.457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="5295.457" y2="5295.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="5290.7148">68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="5290.7148">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,5320.7676,118.5,5324.7676,128.5,5328.7676,124.5,5324.7676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="5324.7676" y2="5324.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="5320.0254">69</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="5320.0254">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="5354.0781" y2="5354.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="5354.0781" y2="5367.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="5367.0781" y2="5367.0781"/><polygon fill="#A80036" points="128.5,5363.0781,118.5,5367.0781,128.5,5371.0781,124.5,5367.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="5349.3359">70</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="146.5" y="5349.3359">Validate current state (transferStateChange.transferStateId == 'EXPIRED')</text><path d="M122,5380.0781 L122,5405.0781 L254,5405.0781 L254,5390.0781 L244,5380.0781 L122,5380.0781 " fill="#FF0000" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M244,5380.0781 L244,5390.0781 L254,5390.0781 L244,5380.0781 " fill="#FF0000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="128" y="5397.6465">Validation failure!</text><path d="M122,5419.3887 L122,5888.3887 L571,5888.3887 L571,5429.3887 L561,5419.3887 L122,5419.3887 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561,5419.3887 L561,5429.3887 L571,5429.3887 L561,5419.3887 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="128" y="5436.957">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="5452.2676">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="5467.5781">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="144" y="5482.8887">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="5498.1992">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="5513.5098">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="5528.8203">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="5544.1309">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="5559.4414">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="5574.752">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="5590.0625">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="192" y="5605.373">"errorDescription": "Unable to abort transfer in this state",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="5620.6836">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5635.9941">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="5651.3047">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="5666.6152">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="5681.9258">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="5697.2363">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="5712.5469">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="5727.8574">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="176" y="5743.168">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="5758.4785">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="5773.7891">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="5789.0996">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="5804.4102">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="5819.7207">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="5835.0313">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5850.3418">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="5865.6523">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="5880.9629">}</text><polygon fill="#A80036" points="960,5915.0156,970,5919.0156,960,5923.0156,964,5919.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="966" y1="5919.0156" y2="5919.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="5914.2734">71</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="146.5" y="5914.2734">Publish Notification (failure) event for Payer</text><path d="M43,5971.0156 L110,5971.0156 L110,5978.0156 L100,5988.0156 L43,5988.0156 L43,5971.0156 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="5971.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="58" y="5984.584">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="297" x="125" y="5983.6504">[type == 'position' &amp;&amp; action == 'timeout-reserved']</text><polygon fill="#A80036" points="1091.5,6005.6367,1101.5,6009.6367,1091.5,6013.6367,1095.5,6009.6367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="6009.6367" y2="6009.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="6004.8945">72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="6004.8945">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,6034.9473,1416.5,6038.9473,1406.5,6042.9473,1410.5,6038.9473" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="6038.9473" y2="6038.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="6034.2051">73</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="6034.2051">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,6051.9473,1489,6051.9473,1499,6062.9473,1489,6074.9473,1358,6074.9473,1348,6062.9473,1358,6051.9473" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="6068.5156">transferStateChange</text><polygon fill="#A80036" points="1124.5,6097.5684,1114.5,6101.5684,1124.5,6105.5684,1120.5,6101.5684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="6101.5684" y2="6101.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="6096.8262">74</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="6096.8262">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,6126.8789,118.5,6130.8789,128.5,6134.8789,124.5,6130.8789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="6130.8789" y2="6130.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="6126.1367">75</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="6126.1367">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="6160.1895" y2="6160.1895"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="6160.1895" y2="6173.1895"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="6173.1895" y2="6173.1895"/><polygon fill="#A80036" points="128.5,6169.1895,118.5,6173.1895,128.5,6177.1895,124.5,6173.1895" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="6155.4473">76</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="146.5" y="6155.4473">Validate current state (transferStateChange.transferStateId == 'EXPIRED')</text><path d="M122,6186.1895 L122,6211.1895 L254,6211.1895 L254,6196.1895 L244,6186.1895 L122,6186.1895 " fill="#FF0000" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M244,6186.1895 L244,6196.1895 L254,6196.1895 L244,6186.1895 " fill="#FF0000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="128" y="6203.7578">Validation failure!</text><path d="M122,6225.5 L122,6694.5 L571,6694.5 L571,6235.5 L561,6225.5 L122,6225.5 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561,6225.5 L561,6235.5 L571,6235.5 L561,6225.5 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="128" y="6243.0684">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="6258.3789">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="6273.6895">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="144" y="6289">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="6304.3105">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="6319.6211">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="6334.9316">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="6350.2422">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="6365.5527">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="6380.8633">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="6396.1738">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="192" y="6411.4844">"errorDescription": "Unable to abort transfer in this state",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="6426.7949">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="6442.1055">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="6457.416">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="6472.7266">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="6488.0371">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="6503.3477">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="6518.6582">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="6533.9688">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="176" y="6549.2793">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="6564.5898">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="6579.9004">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="6595.2109">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="6610.5215">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="6625.832">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="6641.1426">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="6656.4531">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="6671.7637">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="6687.0742">}</text><polygon fill="#A80036" points="960,6721.127,970,6725.127,960,6729.127,964,6725.127" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="966" y1="6725.127" y2="6725.127"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="6720.3848">77</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="146.5" y="6720.3848">Publish Notification (failure) event for Payee</text><path d="M43,6777.127 L110,6777.127 L110,6784.127 L100,6794.127 L43,6794.127 L43,6777.127 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="6777.127"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="58" y="6790.6953">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="230" x="125" y="6789.7617">[type == 'position' &amp;&amp; action == 'reject']</text><polygon fill="#A80036" points="1091.5,6811.748,1101.5,6815.748,1091.5,6819.748,1095.5,6815.748" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="6815.748" y2="6815.748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="6811.0059">78</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="6811.0059">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,6841.0586,1416.5,6845.0586,1406.5,6849.0586,1410.5,6845.0586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="6845.0586" y2="6845.0586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="6840.3164">79</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="6840.3164">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,6858.0586,1489,6858.0586,1499,6869.0586,1489,6881.0586,1358,6881.0586,1348,6869.0586,1358,6858.0586" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="6874.627">transferStateChange</text><polygon fill="#A80036" points="1124.5,6903.6797,1114.5,6907.6797,1124.5,6911.6797,1120.5,6907.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="6907.6797" y2="6907.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="6902.9375">80</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="6902.9375">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,6932.9902,118.5,6936.9902,128.5,6940.9902,124.5,6936.9902" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="6936.9902" y2="6936.9902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="6932.248">81</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="6932.248">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="6966.3008" y2="6966.3008"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="6966.3008" y2="6979.3008"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="6979.3008" y2="6979.3008"/><polygon fill="#A80036" points="128.5,6975.3008,118.5,6979.3008,128.5,6983.3008,124.5,6979.3008" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="6961.5586">82</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463" x="146.5" y="6961.5586">Validate current state (transferStateChange.transferStateId == 'REJECTED')</text><path d="M122,6992.3008 L122,7017.3008 L254,7017.3008 L254,7002.3008 L244,6992.3008 L122,6992.3008 " fill="#FF0000" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M244,6992.3008 L244,7002.3008 L254,7002.3008 L244,6992.3008 " fill="#FF0000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="128" y="7009.8691">Validation failure!</text><path d="M122,7031.6113 L122,7500.6113 L571,7500.6113 L571,7041.6113 L561,7031.6113 L122,7031.6113 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561,7031.6113 L561,7041.6113 L571,7041.6113 L561,7031.6113 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="128" y="7049.1797">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="7064.4902">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="7079.8008">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="144" y="7095.1113">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="7110.4219">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="7125.7324">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="7141.043">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="7156.3535">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="7171.6641">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="7186.9746">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="7202.2852">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="192" y="7217.5957">"errorDescription": "Unable to abort transfer in this state",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="7232.9063">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="7248.2168">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="7263.5273">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="7278.8379">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="7294.1484">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="7309.459">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="7324.7695">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="7340.0801">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="176" y="7355.3906">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="7370.7012">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="7386.0117">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="7401.3223">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="7416.6328">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="7431.9434">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="7447.2539">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="7462.5645">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="7477.875">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="7493.1855">}</text><polygon fill="#A80036" points="960,7527.2383,970,7531.2383,960,7535.2383,964,7531.2383" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="966" y1="7531.2383" y2="7531.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="7526.4961">83</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="146.5" y="7526.4961">Publish Notification (failure) event for Payee</text><path d="M43,7583.2383 L110,7583.2383 L110,7590.2383 L100,7600.2383 L43,7600.2383 L43,7583.2383 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="792.1113" style="stroke: #000000; stroke-width: 2.0;" width="1466" x="43" y="7583.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="58" y="7596.8066">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="231" x="125" y="7595.873">[type == 'position' &amp;&amp; action == 'failed']</text><polygon fill="#A80036" points="1091.5,7617.8594,1101.5,7621.8594,1091.5,7625.8594,1095.5,7621.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="1097.5" y1="7621.8594" y2="7621.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="7617.1172">84</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="7617.1172">Request current state of transfer from DB</text><polygon fill="#A80036" points="1406.5,7647.1699,1416.5,7651.1699,1406.5,7655.1699,1410.5,7651.1699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1412.5" y1="7651.1699" y2="7651.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1120.5" y="7646.4277">85</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1142.5" y="7646.4277">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#f13keaapvflui6)" points="1358,7664.1699,1489,7664.1699,1499,7675.1699,1489,7687.1699,1358,7687.1699,1348,7675.1699,1358,7664.1699" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1360" y="7680.7383">transferStateChange</text><polygon fill="#A80036" points="1124.5,7709.791,1114.5,7713.791,1124.5,7717.791,1120.5,7713.791" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1118.5" x2="1422.5" y1="7713.791" y2="7713.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1130.5" y="7709.0488">86</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1152.5" y="7709.0488">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,7739.1016,118.5,7743.1016,128.5,7747.1016,124.5,7743.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="1107.5" y1="7743.1016" y2="7743.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="7738.3594">87</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="7738.3594">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="7772.4121" y2="7772.4121"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="7772.4121" y2="7785.4121"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="7785.4121" y2="7785.4121"/><polygon fill="#A80036" points="128.5,7781.4121,118.5,7785.4121,128.5,7789.4121,124.5,7785.4121" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="7767.6699">88</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="146.5" y="7767.6699">Validate current state (transferStateChange.transferStateId == 'FAILED')</text><path d="M122,7798.4121 L122,7823.4121 L254,7823.4121 L254,7808.4121 L244,7798.4121 L122,7798.4121 " fill="#FF0000" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M244,7798.4121 L244,7808.4121 L254,7808.4121 L244,7798.4121 " fill="#FF0000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="128" y="7815.9805">Validation failure!</text><path d="M122,7837.7227 L122,8306.7227 L571,8306.7227 L571,7847.7227 L561,7837.7227 L122,7837.7227 " fill="#FFFF00" filter="url(#f13keaapvflui6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561,7837.7227 L561,7847.7227 L571,7847.7227 L561,7837.7227 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="128" y="7855.291">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="7870.6016">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="7885.9121">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="144" y="7901.2227">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="7916.5332">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="7931.8438">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="7947.1543">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="7962.4648">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="7977.7754">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="7993.0859">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="8008.3965">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="192" y="8023.707">"errorDescription": "Unable to abort transfer in this state",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="8039.0176">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="8054.3281">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="8069.6387">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="8084.9492">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="8100.2598">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="8115.5703">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="8130.8809">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="8146.1914">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="176" y="8161.502">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="8176.8125">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="8192.123">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="8207.4336">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="8222.7441">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="8238.0547">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="8253.3652">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="8268.6758">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="8283.9863">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="8299.2969">}</text><polygon fill="#A80036" points="960,8333.3496,970,8337.3496,960,8341.3496,964,8337.3496" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="966" y1="8337.3496" y2="8337.3496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="8332.6074">89</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="146.5" y="8332.6074">Publish Notification (failure) event for Payer</text><!--
@startuml
title 1.3.3 Abort Position Handler Consume

autonumber


control "Position Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
entity "Position DAO" as POS_DAO
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant TRANS_DAO
    participant DB
end box

activate POS_HANDLER
group Abort Position Handler Consume
   alt Calculate & Validate Latest Position Abort (success)
        opt type == 'position' && action == 'timeout-received'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'EXPIRED')

            group Calculate position and persist change
                POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
                activate POS_DAO
                POS_DAO -> DB: Retrieve latest position from DB for Payer
                activate DB
                hnote over DB #lightyellow
                    participant
                    participantPosition
                end note
                DB - -> POS_DAO: Retrieve latest position from DB for Payer
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return latest position
                deactivate POS_DAO
                POS_HANDLER <-> POS_HANDLER: Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)
                POS_HANDLER -> POS_DAO: Request to persist latest position for Payer
                activate POS_DAO
                POS_DAO -> DB: Persist latest position to DB for Payer
                hnote over DB #lightyellow
                    participantPosition
                end note
                activate DB
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return success
                deactivate POS_DAO
            end

            group Persist Transfer State (with transferState='ABORTED' on position check pass)
                POS_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer state
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> POS_HANDLER: Return success
                deactivate TRANS_DAO
            end
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                             "errorInformation": {
                                 "errorCode": 4001,
                                 "errorDescription": "Payer FSP insufficient liquidity",
                                 "extensionList": <transferMessage.extensionList>
                             }
                         }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: transfer,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
        end
        opt type == 'position' && action == 'timeout-reserved'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'EXPIRED')

            group Calculate position and persist change
                POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
                activate POS_DAO
                POS_DAO -> DB: Retrieve latest position from DB for Payee
                activate DB
                hnote over DB #lightyellow
                    participant
                    participantPosition
                end note
                DB - -> POS_DAO: Retrieve latest position from DB for Payer
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return latest position
                deactivate POS_DAO
                POS_HANDLER <-> POS_HANDLER: Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)
                POS_HANDLER -> POS_DAO: Request to persist latest position for Payer
                activate POS_DAO
                POS_DAO -> DB: Persist latest position to DB for Payer
                hnote over DB #lightyellow
                    participantPosition
                end note
                activate DB
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return success
                deactivate POS_DAO
            end
            group Persist Transfer State (with transferState='ABORTED' on position check pass)
                POS_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer state
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> POS_HANDLER: Return success
                deactivate TRANS_DAO
            end
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 4001,
                                "errorDescription": "Payer FSP insufficient liquidity",
                                "extensionList": <transferMessage.extensionList>
                            }
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: transfer,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
        end
        opt type == 'position' && action == 'reject'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'REJECTED')

            group Calculate position and persist change
                POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
                activate POS_DAO
                POS_DAO -> DB: Retrieve latest position from DB for Payer
                activate DB
                hnote over DB #lightyellow
                    participant
                    participantPosition
                end note
                DB - -> POS_DAO: Retrieve latest position from DB for Payer
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return latest position
                deactivate POS_DAO
                POS_HANDLER <-> POS_HANDLER: Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)
                POS_HANDLER -> POS_DAO: Request to persist latest position for Payer
                activate POS_DAO
                POS_DAO -> DB: Persist latest position to DB for Payer
                hnote over DB #lightyellow
                    participantPosition
                end note
                activate DB
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return success
                deactivate POS_DAO
            end

            group Persist Transfer State (with transferState='ABORTED' on position check pass)
                POS_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer state
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> POS_HANDLER: Return success
                deactivate TRANS_DAO
            end
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: transfer,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: "rejected",
                                code: 0
                            }
                        }
                    }
                }
            end note
        end
        opt type == 'position' && action == 'failed' (Unable to currently trigger this scenario)
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'FAILED')

            group Calculate position and persist change
                POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
                activate POS_DAO
                POS_DAO -> DB: Retrieve latest position from DB for Payer
                activate DB
                hnote over DB #lightyellow
                    participant
                    participantPosition
                end note
                DB - -> POS_DAO: Retrieve latest position from DB for Payer
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return latest position
                deactivate POS_DAO
                POS_HANDLER <-> POS_HANDLER: Calculate latest position ($latestPosition = participantPosition.reservedAmount - payload.amount.amount)
                POS_HANDLER -> POS_DAO: Request to persist latest position for Payer
                activate POS_DAO
                POS_DAO -> DB: Persist latest position to DB for Payer
                hnote over DB #lightyellow
                    participantPosition
                end note
                activate DB
                deactivate DB
                POS_DAO - -> POS_HANDLER: Return success
                deactivate POS_DAO
            end

            group Persist Transfer State (with transferState='ABORTED' on position check pass)
                POS_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer state
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> POS_HANDLER: Return success
                deactivate TRANS_DAO
            end
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: transfer,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
        end
        POS_HANDLER -> TOPIC_TRANSFERS: Publish Transfer event
        activate TOPIC_TRANSFERS
        deactivate TOPIC_TRANSFERS
   else Calculate & Validate Latest Position Abort (failure)
        opt type == 'position' && action == 'timeout-received'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'EXPIRED')
            note right of POS_HANDLER #red: Validation failure!

            note right of POS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <ledgerName>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 4001,
                                "errorDescription": "Unable to abort transfer in this state",
                                "extensionList": <transferMessage.extensionList>
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end
        opt type == 'position' && action == 'timeout-reserved'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'EXPIRED')
            note right of POS_HANDLER #red: Validation failure!

            note right of POS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <ledgerName>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 4001,
                                "errorDescription": "Unable to abort transfer in this state",
                                "extensionList": <transferMessage.extensionList>
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payee
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end
        opt type == 'position' && action == 'reject'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'REJECTED')
            note right of POS_HANDLER #red: Validation failure!
            note right of POS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <ledgerName>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 4001,
                                "errorDescription": "Unable to abort transfer in this state",
                                "extensionList": <transferMessage.extensionList>
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payee
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end
        opt type == 'position' && action == 'failed'
            POS_HANDLER -> POS_DAO: Request current state of transfer from DB
            activate POS_DAO
            POS_DAO -> DB: Retrieve current state of transfer from DB
            activate DB
            hnote over DB #lightyellow
                transferStateChange
            end note
            DB - -> POS_DAO: Return current state of transfer from DB
            deactivate DB
            POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
            deactivate POS_DAO
            POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'FAILED')
            note right of POS_HANDLER #red: Validation failure!
            note right of POS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <ledgerName>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 4001,
                                "errorDescription": "Unable to abort transfer in this state",
                                "extensionList": <transferMessage.extensionList>
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end

   end
end
deactivate POS_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>